<?xml version="1.0" encoding="UTF-8"?>
<unload unload_date="2015-09-08 18:29:52">
<sys_remote_update_set action="INSERT_OR_UPDATE">
<collisions/>
<commit_date/>
<deleted/>
<description>PagerDuty is a third-party system used to alerts individuals/teams when an important issue requires attention.  The integration with ServiceNow focuses on finding an owner (assignee) for high priority incidents.  

Integration is supported in both directions allowing incidents to be acknowledged, delegated (assigned to another group) and resolved in either system. The following work models are supported:
1.	User uses PagerDuty for notification only.  Once notified, he/she uses ServiceNow to assign, investigate, resolve the incident.
2.	User gets notification from PagerDuty and takes incident ownership via PagerDuty (by acknowledging).  Then, uses ServiceNow for investigation and resolution.
3.	User uses PagerDuty to get notification, take incident ownership (via Ack), and resolve the incident.  This model is expected only for very simple incidents.
</description>
<inserted/>
<name>PagerDuty-ng</name>
<origin_sys_id/>
<release_date/>
<remote_sys_id>0d0cc73e6f524200095acd9c5d3ee492</remote_sys_id>
<state>loaded</state>
<summary/>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>37365f7e6f524200095acd9c5d3ee449</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<update_set display_value=""/>
<update_source display_value=""/>
<updated/>
</sys_remote_update_set>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_app_module_ee061e24c6112281013e55db2a952739</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_app_module"><sys_app_module action="INSERT_OR_UPDATE"><active>true</active><application display_value="System Definition">c7fd1762c0a80166015926d15731965d</application><assessment/><content_page/><device_type/><filter/><hint/><homepage/><image>images/icons/public_page.gif</image><link_type>LIST</link_type><map_page/><mobile_title>Public Pages</mobile_title><mobile_view_name>Mobile</mobile_view_name><name>sys_public</name><order>180</order><query/><report/><roles>admin</roles><survey/><survey_overwrite>true</survey_overwrite><sys_created_by>glide.maint</sys_created_by><sys_created_on>2005-12-03 00:29:37</sys_created_on><sys_domain>global</sys_domain><sys_id>ee061e24c6112281013e55db2a952739</sys_id><sys_mod_count>8</sys_mod_count><sys_overrides/><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-13 22:43:22</sys_updated_on><timeline_page/><title>Public Pages</title><uncancelable>false</uncancelable><view_name/><window_name/></sys_app_module><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app display_value="System (glidesoft)">6e4f41d26fb54600095acd9c5d3ee477</sys_app><sys_code>!!14H/</sys_code><sys_created_by>glide.maint</sys_created_by><sys_created_on>2005-12-03 00:29:37</sys_created_on><sys_id>e51d0d9e6f754600095acd9c5d3ee447</sys_id><sys_mod_count>1</sys_mod_count><sys_name>Public Pages</sys_name><sys_parent/><sys_path>!!14H/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>ee061e24c6112281013e55db2a952739</sys_source_id><sys_source_table>sys_app_module</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_app_module_ee061e24c6112281013e55db2a952739</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-13 22:43:22</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>33365f7e6f524200095acd9c5d3ee44a</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>sys_public</table>
<target_name>Public Pages</target_name>
<type>Module</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_assigned_to_user</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_assigned_to_user" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_assigned_to_user</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Assigned To User</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_assigned_to_user</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>100</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>c23d5e4c4d176100c33a943ecf043ef4</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:39</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3Q&lt;/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>d77700606f428600095acd9c5d3ee4ae</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Assigned To User</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3Q&lt;/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_assigned_to_user" name="u_pagerduty" sys_source_table="sys_dictionary">c23d5e4c4d176100c33a943ecf043ef4</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_assigned_to_user</sys_update_name><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:39</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>33365f7e6f524200095acd9c5d3ee44b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Assigned To User</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_resolved_by_user</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_resolved_by_user" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_resolved_by_user</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Resolved By User</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_resolved_by_user</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>100</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>d63d5a8c4d176100c33a943ecf043ed1</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:41</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QE/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>679a30bd6f210600095acd9c5d3ee4fd</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Resolved By User</sys_name><sys_parent display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_parent><sys_path>!!3Q4/!!3QE/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_resolved_by_user" name="u_pagerduty" sys_source_table="sys_dictionary">d63d5a8c4d176100c33a943ecf043ed1</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_resolved_by_user</sys_update_name><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:41</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>33365f7e6f524200095acd9c5d3ee44c</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Resolved By User</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_documentation_incident_u_pagerduty_id_en</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_documentation element="u_pagerduty_id" label="PagerDuty ID" language="en" table="incident"><sys_documentation action="INSERT_OR_UPDATE"><element>u_pagerduty_id</element><help/><hint>Unique incident id used by the PagerDuty REST API</hint><label>PagerDuty ID</label><language>en</language><name>incident</name><plural>PagerDuty IDs</plural><sys_created_by>jschraith</sys_created_by><sys_created_on>2014-10-15 19:44:42</sys_created_on><sys_id>d2ed129d65bb294033f3979d4c1e91f1</sys_id><sys_mod_count>5</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:14:39</sys_updated_on><url/><url_target/></sys_documentation></sys_documentation><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9O?/</sys_code><sys_created_by>jschraith</sys_created_by><sys_created_on>2014-10-15 19:44:42</sys_created_on><sys_id>16ed129d65bb294033f3979d4c1e91f2</sys_id><sys_mod_count>0</sys_mod_count><sys_name>PagerDuty ID</sys_name><sys_parent display_value="PagerDuty ID">5ded129d65bb294033f3979d4c1e91b6</sys_parent><sys_path>!!(WU/!!9O0/!!9O?/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_pagerduty_id" language="en" name="incident" sys_source_table="sys_documentation">d2ed129d65bb294033f3979d4c1e91f1</sys_source_id><sys_source_table>sys_documentation</sys_source_table><sys_type/><sys_update_name>sys_documentation_incident_u_pagerduty_id_en</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:14:39</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>33365f7e6f524200095acd9c5d3ee44d</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>incident</table>
<target_name>Incident.PagerDuty ID</target_name>
<type>Field Label</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_headers_233baf604ddb6100c33a943ecf043eec</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn_headers"><sys_rest_message_fn_headers action="INSERT_OR_UPDATE"><name>Authorization</name><rest_message_function display_value="put">a3e06fac4d9b6100c33a943ecf043ed1</rest_message_function><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:56:15</sys_created_on><sys_id>233baf604ddb6100c33a943ecf043eec</sys_id><sys_mod_count>3</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:11:20</sys_updated_on><value>${token}</value></sys_rest_message_fn_headers><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9L[/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:56:15</sys_created_on><sys_id>ee0f12c3656b254033f3979d4c1e911b</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Authorization</sys_name><sys_parent display_value="put">6e0f12c3656b254033f3979d4c1e9117</sys_parent><sys_path>!!9LQ/!!9LU/!!9L[/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>233baf604ddb6100c33a943ecf043eec</sys_source_id><sys_source_table>sys_rest_message_fn_headers</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_headers_233baf604ddb6100c33a943ecf043eec</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:11:20</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>33365f7e6f524200095acd9c5d3ee44e</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>Authorization</target_name>
<type>REST Message Function Headers</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_script_275a4b684d9b6100c33a943ecf043e43</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update sys_domain="global" table="sys_script"&gt;&lt;sys_script action="INSERT_OR_UPDATE"&gt;&lt;abort_action&gt;false&lt;/abort_action&gt;&lt;action_delete&gt;false&lt;/action_delete&gt;&lt;action_insert&gt;true&lt;/action_insert&gt;&lt;action_label/&gt;&lt;action_name/&gt;&lt;action_query&gt;false&lt;/action_query&gt;&lt;action_run_at&gt;server&lt;/action_run_at&gt;&lt;action_update&gt;true&lt;/action_update&gt;&lt;active&gt;true&lt;/active&gt;&lt;add_message&gt;false&lt;/add_message&gt;&lt;advanced&gt;true&lt;/advanced&gt;&lt;application/&gt;&lt;client_callable&gt;false&lt;/client_callable&gt;&lt;collection&gt;incident&lt;/collection&gt;&lt;condition/&gt;&lt;description/&gt;&lt;filter_condition table="incident"&gt;u_pagerdutyISNOTEMPTY^assigned_toVALCHANGES^assigned_toISNOTEMPTY^u_pagerduty_idISNOTEMPTY^EQ&lt;item endquery="false" field="u_pagerduty" goto="false" newquery="false" operator="ISNOTEMPTY" or="false" value=""/&gt;&lt;item endquery="false" field="assigned_to" goto="false" newquery="false" operator="VALCHANGES" or="false" value=""/&gt;&lt;item endquery="false" field="assigned_to" goto="false" newquery="false" operator="ISNOTEMPTY" or="false" value=""/&gt;&lt;item endquery="false" field="u_pagerduty_id" goto="false" newquery="false" operator="ISNOTEMPTY" or="false" value=""/&gt;&lt;item endquery="true" field="" goto="false" newquery="false" operator="" or="false" value=""/&gt;&lt;/filter_condition&gt;&lt;message/&gt;&lt;name&gt;Assign PagerDuty Incident&lt;/name&gt;&lt;onclick/&gt;&lt;order&gt;100&lt;/order&gt;&lt;priority&gt;100&lt;/priority&gt;&lt;read_access_action&gt;false&lt;/read_access_action&gt;&lt;role_conditions/&gt;&lt;script&gt;&lt;![CDATA[// Re-assign PagerDuty incident to specified user. Match user by email address.
var debug = true;
if (debug) gs.log("Entered", "BR:Assign PagerDuty Incident");

var pd = new PagerDuty_REST();

// Assign PD incident
var resp_message = pd.assignIncident(current.u_pagerduty_id.toString(), current.assigned_to.email.toString(), gs.getUser().getEmail().toString());

if (!pd.hasError) {
	if (debug) gs.log("resp_message=" + resp_message, "BR:Assign PagerDuty Incident");
	
	
} else {
	gs.addErrorMessage("PagerDuty integration error -- " + pd.errMsg + ". PagerDuty will not be able to notify the user; check to see if user is configured properly in PagerDuty.");
	gs.logError("PagerDuty integration failed: incident=" + current.number + ", message=" + pd.errMsg, "BR:Assign PagerDuty Incident");
	current.work_notes = "PagerDuty integration error -- " + pd.errMsg + ". PagerDuty will not be able to notify the user; check to see if user is configured properly in PagerDuty.";
	current.update();
}

if (debug) gs.log("Exiting", "BR:Assign PagerDuty Incident");]]&gt;&lt;/script&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-18 18:32:06&lt;/sys_created_on&gt;&lt;sys_domain&gt;global&lt;/sys_domain&gt;&lt;sys_id&gt;275a4b684d9b6100c33a943ecf043e43&lt;/sys_id&gt;&lt;sys_mod_count&gt;20&lt;/sys_mod_count&gt;&lt;sys_overrides/&gt;&lt;sys_updated_by&gt;jwilson&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2014-11-21 20:28:30&lt;/sys_updated_on&gt;&lt;template/&gt;&lt;when&gt;after&lt;/when&gt;&lt;/sys_script&gt;&lt;sys_app_file action="INSERT_OR_UPDATE"&gt;&lt;customer_update&gt;true&lt;/customer_update&gt;&lt;publish_override/&gt;&lt;replace_on_upgrade&gt;false&lt;/replace_on_upgrade&gt;&lt;restore/&gt;&lt;sys_app/&gt;&lt;sys_code&gt;!!9M)/&lt;/sys_code&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-18 18:32:06&lt;/sys_created_on&gt;&lt;sys_id&gt;760f12c3656b254033f3979d4c1e9171&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;Assign PagerDuty Incident&lt;/sys_name&gt;&lt;sys_parent display_value="Incident"&gt;42fdf901a440110056d5b5bdb2273fa2&lt;/sys_parent&gt;&lt;sys_path&gt;!!(WU/!!9M)/&lt;/sys_path&gt;&lt;sys_policy/&gt;&lt;sys_source_deleted&gt;false&lt;/sys_source_deleted&gt;&lt;sys_source_id&gt;275a4b684d9b6100c33a943ecf043e43&lt;/sys_source_id&gt;&lt;sys_source_table&gt;sys_script&lt;/sys_source_table&gt;&lt;sys_type&gt;code&lt;/sys_type&gt;&lt;sys_update_name&gt;sys_script_275a4b684d9b6100c33a943ecf043e43&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;jwilson&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2014-11-21 20:28:30&lt;/sys_updated_on&gt;&lt;/sys_app_file&gt;&lt;/record_update&gt;</payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>3336df7e6f524200095acd9c5d3ee4a4</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>incident</table>
<target_name>Assign PagerDuty Incident</target_name>
<type>Business Rule</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_db_object_91d51a4c4d176100c33a943ecf043e7a</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_db_object"><sys_db_object action="INSERT_OR_UPDATE"><create_access_controls>false</create_access_controls><extension_model/><is_extendable>false</is_extendable><label>Pagerduty1</label><live_feed_enabled>false</live_feed_enabled><name>u_pagerduty</name><number_ref/><provider_class/><super_class display_value="Import Set Row" name="sys_import_set_row">152bd8906fce4600095acd9c5d3ee466</super_class><sys_app_file display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_app_file><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:25:37</sys_created_on><sys_id>91d51a4c4d176100c33a943ecf043e7a</sys_id><sys_mod_count>1</sys_mod_count><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 17:24:38</sys_updated_on><user_role/></sys_db_object><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3Q5/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:25:37</sys_created_on><sys_id>2a7700606f428600095acd9c5d3ee49f</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Pagerduty</sys_name><sys_parent/><sys_path>!!3Q5/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id name="u_pagerduty" sys_source_table="sys_db_object">91d51a4c4d176100c33a943ecf043e7a</sys_source_id><sys_source_table>sys_db_object</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_db_object_91d51a4c4d176100c33a943ecf043e7a</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 17:24:38</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>37365f7e6f524200095acd9c5d3ee44a</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1</target_name>
<type>Table</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_escalation_policy_id</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_escalation_policy_id" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_escalation_policy_id</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Escalation Policy Id</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_escalation_policy_id</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 21:08:38</sys_created_on><sys_id>8d97bb97fda36100c33aa767053a3500</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 21:08:38</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3Q@/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 21:08:38</sys_created_on><sys_id>df7700606f428600095acd9c5d3ee4b1</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Escalation Policy Id</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3Q@/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_escalation_policy_id" name="u_pagerduty" sys_source_table="sys_dictionary">8d97bb97fda36100c33aa767053a3500</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_escalation_policy_id</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 21:08:38</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>37365f7e6f524200095acd9c5d3ee44b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Escalation Policy Id</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_service_id</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_service_id" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_service_id</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Service ID</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_service_id</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:45:29</sys_created_on><sys_id>350a1ca06f428600095acd9c5d3ee422</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:45:29</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3RU/</sys_code><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:45:29</sys_created_on><sys_id>790a1ca06f428600095acd9c5d3ee422</sys_id><sys_mod_count>1</sys_mod_count><sys_name>Service ID</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3RU/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_service_id" name="u_pagerduty" sys_source_table="sys_dictionary">350a1ca06f428600095acd9c5d3ee422</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_service_id</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:45:30</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>37365f7e6f524200095acd9c5d3ee44c</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Service ID</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_documentation_sys_user_group_u_pagerduty_service_en</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_documentation element="u_pagerduty_service" label="PagerDuty Service" language="en" table="sys_user_group"><sys_documentation action="INSERT_OR_UPDATE"><element>u_pagerduty_service</element><help/><hint>Unique service identifier, used by the API. Required to trigger, ack and resolve incidents for this service via the API.</hint><label>PagerDuty Service</label><language>en</language><name>sys_user_group</name><plural>PagerDuty Services</plural><sys_created_by>jschraith</sys_created_by><sys_created_on>2014-10-15 19:45:05</sys_created_on><sys_id>f3fd129d65bb294033f3979d4c1e91f5</sys_id><sys_mod_count>1</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:10:19</sys_updated_on><url/><url_target/></sys_documentation></sys_documentation><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9OA/</sys_code><sys_created_by>jschraith</sys_created_by><sys_created_on>2014-10-15 19:45:05</sys_created_on><sys_id>3bfd129d65bb294033f3979d4c1e91f5</sys_id><sys_mod_count>1</sys_mod_count><sys_name>PagerDuty Service</sys_name><sys_parent display_value="PagerDuty Service">91ed129d65bb294033f3979d4c1e91bb</sys_parent><sys_path>!!(~K/!!9O3/!!9OA/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_pagerduty_service" language="en" name="sys_user_group" sys_source_table="sys_documentation">f3fd129d65bb294033f3979d4c1e91f5</sys_source_id><sys_source_table>sys_documentation</sys_source_table><sys_type/><sys_update_name>sys_documentation_sys_user_group_u_pagerduty_service_en</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:10:19</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>37365f7e6f524200095acd9c5d3ee44d</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>sys_user_group</table>
<target_name>Group.PagerDuty Service</target_name>
<type>Field Label</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_parameters_09158e55240b210012e7b8d269ce7d9a</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn_parameters"><sys_rest_message_fn_parameters action="INSERT_OR_UPDATE"><name>key</name><rest_message_function display_value="post">2dfdd2775576210012e79621ec424be5</rest_message_function><sys_created_by>admin.jwilson</sys_created_by><sys_created_on>2014-09-08 11:09:13</sys_created_on><sys_id>09158e55240b210012e7b8d269ce7d9a</sys_id><sys_mod_count>2</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:27:34</sys_updated_on><type>string</type><value/></sys_rest_message_fn_parameters><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9L{/</sys_code><sys_created_by>admin.jwilson</sys_created_by><sys_created_on>2014-09-08 11:09:13</sys_created_on><sys_id>f20f12c3656b254033f3979d4c1e911f</sys_id><sys_mod_count>0</sys_mod_count><sys_name>key</sys_name><sys_parent display_value="post">e20f12c3656b254033f3979d4c1e9116</sys_parent><sys_path>!!9LP/!!9LS/!!9L{/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>09158e55240b210012e7b8d269ce7d9a</sys_source_id><sys_source_table>sys_rest_message_fn_parameters</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_parameters_09158e55240b210012e7b8d269ce7d9a</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:27:34</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>37365f7e6f524200095acd9c5d3ee44e</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>key</target_name>
<type>REST Message Function Parameters</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_script_d742e8484dd36100c33a943ecf043e82</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update sys_domain="global" table="sys_script"&gt;&lt;sys_script action="INSERT_OR_UPDATE"&gt;&lt;abort_action&gt;false&lt;/abort_action&gt;&lt;action_delete&gt;false&lt;/action_delete&gt;&lt;action_insert&gt;true&lt;/action_insert&gt;&lt;action_query&gt;false&lt;/action_query&gt;&lt;action_update&gt;true&lt;/action_update&gt;&lt;active&gt;true&lt;/active&gt;&lt;add_message&gt;false&lt;/add_message&gt;&lt;advanced&gt;true&lt;/advanced&gt;&lt;client_callable&gt;false&lt;/client_callable&gt;&lt;collection&gt;incident&lt;/collection&gt;&lt;condition&gt;current.priority.changes() || current.assignment_group.changes() || current.isNewRecord() || current.operation() == 'insert'&lt;/condition&gt;&lt;description/&gt;&lt;filter_condition table="incident"&gt;assigned_toISEMPTY^priorityIN1,2^u_pagerdutyISEMPTY^EQ&lt;item endquery="false" field="assigned_to" goto="false" newquery="false" operator="ISEMPTY" or="false" value=""/&gt;&lt;item endquery="false" field="priority" goto="false" newquery="false" operator="IN" or="false" value="1,2"/&gt;&lt;item endquery="false" field="u_pagerduty" goto="false" newquery="false" operator="ISEMPTY" or="false" value=""/&gt;&lt;item endquery="true" field="" goto="false" newquery="false" operator="" or="false" value=""/&gt;&lt;/filter_condition&gt;&lt;message/&gt;&lt;name&gt;Trigger PagerDuty Incident&lt;/name&gt;&lt;order&gt;100&lt;/order&gt;&lt;priority&gt;100&lt;/priority&gt;&lt;role_conditions/&gt;&lt;script&gt;&lt;![CDATA[// High priority incident escalated - use PagerDuty to find Assigned to

// To support auto-escalated incidents, needed to add Advanced Script Condition
// Evaluates Filter conditions and then advanced conditions (not either/or)
//   1. changes() is not respected on a record insert
//   2. evaluates filter conditions (on When to run pane) before script conditions
//   3. auto-escalated events trap on current.operation() == insert
//   4. also needed to change into an 'after' event



// Create an incident in PagerDuty for this service (lookup based on Escalation Group)
var debug = true;
if (debug) gs.log("Entered for " + current.number, "BR:Trigger PagerDuty Incident");
	
if (true ) {
	var pd = new PagerDuty_REST();
	
	// Lookup service key
	var key = current.assignment_group.u_pagerduty_service.toString();
	if (debug) gs.log("key=" + key, "BR:Trigger PagerDuty Incident");
		
	// Construct JSON object
	var body = current.number + ":" + current.short_description;
	var details = {AssignmentGroup: current.assignment_group.name.toString(),
	Priority: current.priority.getDisplayValue(),
	WorkNote: current.work_notes.toString()};
	if (debug) JSUtil.logObject(details, "BR:Trigger PagerDuty Incident");
		
	// Create PD incident
	var pd_incident = pd.triggerIncident(key, current.sys_id.toString(), current.number, body, details);
	
	if (!pd.hasError) {
		gs.addInfoMessage("PagerDuty incident created: " + pd_incident);
		current.u_pagerduty = pd_incident;
		current.update();
	} else {
		gs.addErrorMessage("PagerDuty integration error: " + pd.errMsg + ". Re-escalate or contact the ServiceNow system administrators.");
		gs.logError("PagerDuty integration failed: incident=" + current.number + ", key=" + key, "BR:Trigger PagerDuty Incident");
		current.work_notes = "PagerDuty integration error: " + pd.errMsg + ". Re-escalate or contact the ServiceNow system administrators.";
		current.update();
	}
	
	
}

if (debug) gs.log("Exiting", "BR:Trigger PagerDuty Incident");
	]]&gt;&lt;/script&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-16 17:02:33&lt;/sys_created_on&gt;&lt;sys_domain&gt;global&lt;/sys_domain&gt;&lt;sys_id&gt;d742e8484dd36100c33a943ecf043e82&lt;/sys_id&gt;&lt;sys_mod_count&gt;50&lt;/sys_mod_count&gt;&lt;sys_overrides/&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-08-18 17:55:32&lt;/sys_updated_on&gt;&lt;template/&gt;&lt;when&gt;after&lt;/when&gt;&lt;/sys_script&gt;&lt;sys_app_file action="INSERT_OR_UPDATE"&gt;&lt;customer_update&gt;true&lt;/customer_update&gt;&lt;publish_override/&gt;&lt;replace_on_upgrade&gt;false&lt;/replace_on_upgrade&gt;&lt;restore/&gt;&lt;sys_app/&gt;&lt;sys_code&gt;!!3RS/&lt;/sys_code&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-16 17:02:33&lt;/sys_created_on&gt;&lt;sys_id&gt;60ab95166fb54600095acd9c5d3ee4fe&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;Trigger PagerDuty Incident&lt;/sys_name&gt;&lt;sys_parent display_value="Incident"&gt;a65345966f754600095acd9c5d3ee4ae&lt;/sys_parent&gt;&lt;sys_path&gt;!!$A./!!3RS/&lt;/sys_path&gt;&lt;sys_policy/&gt;&lt;sys_source_deleted&gt;false&lt;/sys_source_deleted&gt;&lt;sys_source_id&gt;d742e8484dd36100c33a943ecf043e82&lt;/sys_source_id&gt;&lt;sys_source_table&gt;sys_script&lt;/sys_source_table&gt;&lt;sys_type&gt;code&lt;/sys_type&gt;&lt;sys_update_name&gt;sys_script_d742e8484dd36100c33a943ecf043e82&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-08-18 17:55:32&lt;/sys_updated_on&gt;&lt;/sys_app_file&gt;&lt;/record_update&gt;</payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>3736df7e6f524200095acd9c5d3ee4a4</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>incident</table>
<target_name>Trigger PagerDuty Incident</target_name>
<type>Business Rule</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_app_module_5ca4fc559964310012e7cc5206158461</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_app_module"><sys_app_module action="INSERT_OR_UPDATE"><active>true</active><application display_value="Integration - PagerDuy">cf52bc159964310012e7cc52061584d2</application><assessment/><content_page/><device_type/><filter/><hint/><homepage/><image/><link_type>DIRECT</link_type><map_page/><mobile_title>Inbound Web Service</mobile_title><mobile_view_name>Mobile</mobile_view_name><name/><order>150</order><query>/v_ws_editor.do?sysparm_query=name=u_pagerduty^element=</query><report/><roles/><survey/><survey_overwrite>true</survey_overwrite><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 18:52:16</sys_created_on><sys_domain>global</sys_domain><sys_id>5ca4fc559964310012e7cc5206158461</sys_id><sys_mod_count>2</sys_mod_count><sys_overrides/><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:31:27</sys_updated_on><timeline_page/><title>Inbound Web Service</title><uncancelable>false</uncancelable><view_name/><window_name/></sys_app_module><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!:)|/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 18:52:16</sys_created_on><sys_id>0bb4bc159964310012e7cc5206158465</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Inbound Web Service</sys_name><sys_parent/><sys_path>!!:)|/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>5ca4fc559964310012e7cc5206158461</sys_source_id><sys_source_table>sys_app_module</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_app_module_5ca4fc559964310012e7cc5206158461</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:31:27</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>3b365f7e6f524200095acd9c5d3ee449</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table/>
<target_name>Inbound Web Service</target_name>
<type>Module</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_incident_u_pagerduty_key</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_pagerduty_key" table="incident"><active>true</active><array>false</array><attributes/><audit>false</audit><calculation/><choice/><choice_field/><choice_table/><column_label>PagerDuty Key</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_pagerduty_key</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>incident</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:52:37</sys_created_on><sys_id>763b5ca06f428600095acd9c5d3ee4ca</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:52:37</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3RY/</sys_code><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:52:37</sys_created_on><sys_id>d2abdca06f428600095acd9c5d3ee4ba</sys_id><sys_mod_count>1</sys_mod_count><sys_name>PagerDuty Key</sys_name><sys_parent display_value="Incident">b73cdcd06fce4600095acd9c5d3ee4f2</sys_parent><sys_path>!!$A./!!3RY/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_pagerduty_key" name="incident" sys_source_table="sys_dictionary">763b5ca06f428600095acd9c5d3ee4ca</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_incident_u_pagerduty_key</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:52:38</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>3b365f7e6f524200095acd9c5d3ee44a</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>incident</table>
<target_name>Incident.PagerDuty Key</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_incident_key</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_incident_key" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_incident_key</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Incident Key</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_incident_key</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>da3d5a8c4d176100c33a943ecf043ed2</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:40</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QB/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>e77700606f428600095acd9c5d3ee4b5</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Incident Key</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3QB/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_incident_key" name="u_pagerduty" sys_source_table="sys_dictionary">da3d5a8c4d176100c33a943ecf043ed2</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_incident_key</sys_update_name><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:40</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>3b365f7e6f524200095acd9c5d3ee44b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Incident Key</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_status</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_status" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_status</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Status</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_status</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>c23d5a8c4d176100c33a943ecf043ed0</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:41</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QF/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>739a30bd6f210600095acd9c5d3ee4ff</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Status</sys_name><sys_parent display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_parent><sys_path>!!3Q4/!!3QF/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_status" name="u_pagerduty" sys_source_table="sys_dictionary">c23d5a8c4d176100c33a943ecf043ed0</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_status</sys_update_name><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:41</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>3b365f7e6f524200095acd9c5d3ee44c</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Status</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category>customer</category>
<comments/>
<name>sys_processor_5c994695240b210012e7b8d269ce7dc6</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_processor"&gt;&lt;sys_processor action="INSERT_OR_UPDATE"&gt;&lt;active&gt;true&lt;/active&gt;&lt;class_name/&gt;&lt;description&gt;Inbound processor that can consume PagerDuty webhook payload.  Writes message data to the PagerDuty inbound web service.&amp;#13;
&amp;#13;
Webhook API: http://developer.pagerduty.com/documentation/rest/webhooks&lt;/description&gt;&lt;name&gt;Inbound PagerDuty Processor&lt;/name&gt;&lt;parameters/&gt;&lt;path&gt;pagerduty2sn&lt;/path&gt;&lt;roles/&gt;&lt;script&gt;&lt;![CDATA[/*
 * We could create logic around what to do if this request is
 * a GET, PUT, POST, or DELETE request.  To get that HTTP Method,
 * we use the getMethod() function on the request.
 * In this example, we just log it to a string variable.ssss
 */
var debug = true;
if (debug) gs.log("Entered Inbound PagerDuty Processor", "Processor:Inbound PagerDuty");
    
// Need array functions later
var arrayUtil = new ArrayUtil();
// List of webhook message types handled -- currently ALL types handled
var EVENTS = ["incident.trigger", "incident.acknowledge", "incident.unacknowledge", "incident.resolve", "incident.assign", "incident.escalate", "incident.delegate"];


var methodMsg = "Method string: "+g_request.getMethod()+"\n";

/*
 * We could iterate through all of the headers to make
 * intelligent decisions about how to handle this request,
 * but in this example, we will just write each header
 * and its value to a logging string
 */
var headerList = g_request.getHeaderNames();
var headerMsg = ""; //we're going to log header info here
while(headerList.hasMoreElements()){
    var header = headerList.nextElement();
    var value = g_request.getHeader(header);
    headerMsg += ("Header: ["+header+"] has a value of: "+value+"\n");
}

/*
 * We could iterate through all of the URL parameters to make
 * intelligent decisions about how to handle this request,
 * but in this example, we will just write each URL parameter
 * and its value to a logging string
 */
var urlParamList = g_request.getParameterNames();
var paramMsg = ""; //we're going to log parameter info here
while(urlParamList.hasMoreElements()){
    var param = urlParamList.nextElement();
    var value = g_request.getParameter(param);
    paramMsg += ("Parameter: ["+param+"] has a value of: "+value+"\n");
}

/*
 * Now we would normally process the request given the data posted to
 * us.  However, for this example, we are going to simply build out
 * a text response that is tailored to the information given to us
 */
var returnMessage = "";
returnMessage += "We received a Request from you with the following information:\n";
returnMessage += methodMsg;
returnMessage += "\nWITH INCOMING HEADERS\n";
returnMessage += headerMsg;
returnMessage += "\nWITH URL PARAMETERS OF\n";
returnMessage += paramMsg;
returnMessage += "\n\n";

//if (debug) gs.log("OTHER DATA: " + returnMessage, "Processor: Inbound PagerDuty");
    


/*** Get payload and put into a JSON object ***/
var is = g_request.getInputStream();
var sb = GlideStringUtil.getStringFromStream(is);
if (debug) gs.log(sb, "Processor: Inbound PagerDuty");
    
var parser = new JSONParser();
var parsed = parser.parse(sb);
//if (debug) JSUtil.logObject(parsed);
    

// PagerDuty body is an array of 'messages'
if (debug) gs.log("Number of messages: " + parsed.messages.length, "Processor: Inbound PagerDuty");

// Process each message
for (var i=0; i &lt; parsed.messages.length; i++) {
// Each item in array is a JSON object
// Get message type
var message_type = parsed.messages[i].type;
if (debug) gs.log("type="+message_type,  "Processor: Inbound PagerDuty");

// PROCESS incident.acknowledge, incident.assign, incident.delegate, incident.resolve, incident.unacknowledge
// IGNORE incident.trigger
if (arrayUtil.contains(EVENTS, message_type)) {
    var pd = new GlideRecord("u_pagerduty");
    pd.initialize();

    // Which ServiceNow group did we pass along via the query string?
    pd.u_servicenow_group = g_request.getParameter("group");
	
	// PD Service Name
    pd.u_service_name = parsed.messages[i].data.incident.service.name;
	pd.u_service_id = parsed.messages[i].data.incident.service.id;
	
	// Assigned To User
    if (parsed.messages[i].data.incident.assigned_to_user) {
        pd.u_assigned_to_user = parsed.messages[i].data.incident.assigned_to_user.email;
        pd.u_assigned_to_name = parsed.messages[i].data.incident.assigned_to_user.name;
    }
    
    // Incident Key
    pd.u_incident_key = parsed.messages[i].data.incident.incident_key;
    
    // Message Type
    pd.u_message_type = message_type;
    
    // Resolved By User
    if (parsed.messages[i].data.incident.resolved_by_user) {
        pd.u_resolved_by_user = parsed.messages[i].data.incident.resolved_by_user.email;
        pd.u_resolved_by_name = parsed.messages[i].data.incident.resolved_by_user.name;
    }
    
    // Status
    pd.u_status = parsed.messages[i].data.incident.status;

    // URL
    pd.u_url = parsed.messages[i].data.incident.html_url;

    // PD Incident Id (not the key, not the number)
    pd.u_id = parsed.messages[i].data.incident.id;

    // PD Incident #
    pd.u_number = parsed.messages[i].data.incident.incident_number;
    
    // Last status changed By User
    if (parsed.messages[i].data.incident.last_status_change_by) {
        pd.u_updated_by_user = parsed.messages[i].data.incident.last_status_change_by.email;
        pd.u_updated_by_name = parsed.messages[i].data.incident.last_status_change_by.name;
    }

    // Escalation policy
    if (parsed.messages[i].data.incident.escalation_policy) {
        pd.u_escalation_policy = parsed.messages[i].data.incident.escalation_policy.name;
        pd.u_escalation_policy_id = parsed.messages[i].data.incident.escalation_policy.id;
    }
    
    pd.insert();
    
} else {
    if (debug) gs.log("Skip creating u_pagerduty record", "Processor: Inbound PagerDuty");

}
    
    
}]]&gt;&lt;/script&gt;&lt;sys_created_by&gt;admin.jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-08 11:28:44&lt;/sys_created_on&gt;&lt;sys_id&gt;5c994695240b210012e7b8d269ce7dc6&lt;/sys_id&gt;&lt;sys_mod_count&gt;38&lt;/sys_mod_count&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-09-08 18:09:45&lt;/sys_updated_on&gt;&lt;type&gt;script&lt;/type&gt;&lt;/sys_processor&gt;&lt;sys_app_file action="INSERT_OR_UPDATE"&gt;&lt;customer_update&gt;true&lt;/customer_update&gt;&lt;publish_override/&gt;&lt;replace_on_upgrade&gt;false&lt;/replace_on_upgrade&gt;&lt;restore/&gt;&lt;sys_app/&gt;&lt;sys_code&gt;!!3OD/&lt;/sys_code&gt;&lt;sys_created_by&gt;admin.jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-08 11:28:44&lt;/sys_created_on&gt;&lt;sys_id&gt;0c2c8f3e6f524200095acd9c5d3ee4fb&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;Inbound PagerDuty Processor&lt;/sys_name&gt;&lt;sys_parent/&gt;&lt;sys_path&gt;!!3OD/&lt;/sys_path&gt;&lt;sys_policy/&gt;&lt;sys_source_deleted&gt;false&lt;/sys_source_deleted&gt;&lt;sys_source_id&gt;5c994695240b210012e7b8d269ce7dc6&lt;/sys_source_id&gt;&lt;sys_source_table&gt;sys_processor&lt;/sys_source_table&gt;&lt;sys_type&gt;code&lt;/sys_type&gt;&lt;sys_update_name&gt;sys_processor_5c994695240b210012e7b8d269ce7dc6&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-09-08 18:09:45&lt;/sys_updated_on&gt;&lt;/sys_app_file&gt;&lt;/record_update&gt;</payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>3b365f7e6f524200095acd9c5d3ee44d</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>Inbound PagerDuty Processor</target_name>
<type>Processor</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_parameters_952b1c60547c7100c33a40b7789e63fb</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn_parameters"><sys_rest_message_fn_parameters action="INSERT_OR_UPDATE"><name>instance</name><rest_message_function display_value="get">a3e06fac4d9b6100c33a943ecf043ed0</rest_message_function><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-12-01 19:20:57</sys_created_on><sys_id>952b1c60547c7100c33a40b7789e63fb</sys_id><sys_mod_count>1</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:21:18</sys_updated_on><type>string</type><value/></sys_rest_message_fn_parameters><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!:*@/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-12-01 19:20:57</sys_created_on><sys_id>a83b5860547c7100c33a40b7789e6368</sys_id><sys_mod_count>0</sys_mod_count><sys_name>instance</sys_name><sys_parent display_value="get">220f12c3656b254033f3979d4c1e9117</sys_parent><sys_path>!!9LQ/!!9LT/!!:*@/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>952b1c60547c7100c33a40b7789e63fb</sys_source_id><sys_source_table>sys_rest_message_fn_parameters</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_parameters_952b1c60547c7100c33a40b7789e63fb</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:21:18</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>3b365f7e6f524200095acd9c5d3ee44e</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>instance</target_name>
<type>REST Message Function Parameters</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_transform_map_25d55a4c4d176100c33a943ecf043e78</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_transform_map"&gt;&lt;sys_transform_map action="INSERT_OR_UPDATE"&gt;&lt;active&gt;true&lt;/active&gt;&lt;copy_empty_fields&gt;false&lt;/copy_empty_fields&gt;&lt;enforce_mandatory_fields&gt;No&lt;/enforce_mandatory_fields&gt;&lt;name&gt;PagerDuty&lt;/name&gt;&lt;order&gt;100&lt;/order&gt;&lt;run_business_rules&gt;true&lt;/run_business_rules&gt;&lt;run_script&gt;true&lt;/run_script&gt;&lt;script&gt;&lt;![CDATA[var debug = true;

/***********************************************************************************************
Event: incident.trigger
Add work note re: trigger + URL, save Incident Id
Event: incident.acknowledge ==&gt; Update Assigned To on SN incident
Add work note, set Assigned to
Event: incident.unacknowledge -- timeout
Do nothing
Event: incident.resolve ==&gt; Mark incident = Resolved, retrieve PD Note
Mark incident resolved with generic Close Note/Code, Resolved by
Event: incident.assign -- manually re-assigned to another user in different escalation chain ==&gt; Work Note
Add work note, set Assigned to
Event: incident.escalate -- reassigned (in PD sense) to another person in escalation chain ==&gt; Work Note
Add work note
Do NOT set Assigned to since user did not ack
Event: incident.delegate -- reassigned to another group/service ==&gt; Work Note
Add work note, clear Assigned to, set Assignment Group (lookup group via ???)
 *************************************************************************************************/

var note;


if (action == "insert") {
	// Do not create an incident from the PagerDuty event
	//ignore = true;
	//if (debug) log.info("Ignore incident.trigger because ServiceNow incident was not found.");
	
	if (JSUtil.nil(source.u_servicenow_group)) {
		ignore = true;
		if (debug) log.info("Ignore inserting a new row because ServiceNow group wasn't specified in the URL query.");
	}
	
	if (source.u_message_type != "incident.trigger") {
		ignore = true;
		if (debug) log.info("Ignore inserting a new row because this isn't a trigger.");
	}
	
	// Here we need to set all the various fields to some value that makes sense. Depending on the requirements, more fields may need to be set.
	target.impact = 1;
	target.urgency = 1;
	target.priority = 1;
	target.assignment_group.setDisplayValue(source.u_servicenow_group);
	target.u_pagerduty_id = source.u_id;
	target.category = "request";
	target.short_description = "PagerDuty incident #" + Math.round(source.u_number) + " was opened on " + source.u_service_name;
	target.work_notes = "PagerDuty: URL: " + source.u_url + "; Assigning to group; " + source.u_servicenow_group;
	
} else {
	if (source.u_message_type == "incident.trigger") {
		if (debug) log.info("In incident.trigger logic");
			
		// Document who currently is being notified PD incident
		note = "PagerDuty: Attempting to notify " + source.u_assigned_to_name + "\n";
		note = note + "Go to the URL to see the PagerDuty log -- " + source.u_url;
		
		// Set PagerDuty incident ID -- needed for SN re-assignments
		if (JSUtil.nil(target.u_pagerduty_id)) {
			target.u_pagerduty_id = source.u_id;
		}
		target.work_notes = note;
		
	} else if (source.u_message_type == "incident.acknowledge") {
		if (debug) log.info("In incident.acknowledge logic");
			
		note = "PagerDuty: Acknowledged by " + source.u_assigned_to_name;
		
		// Treat acknowledge as assignment
		var usr = getUser(source.u_assigned_to_user);
		if (JSUtil.notNil(usr)) {
			target.assigned_to = usr;
		} else {
			note = note + "\n\nERROR: Could not set Assigned to field -- unable to find user with email = " + source.u_assigned_to_user;
		}
		
		target.work_notes = note;
		
		
		
	} else if (source.u_message_type == "incident.unacknowledge") {
		ignore = true;
		if (debug) log.info("Ignore incident.unacknowledge -- there should not be an ACK timeout");
			
	} else if (source.u_message_type == "incident.resolve") {
		if (debug) log.info("In incident.resolve logic");
			
		if (target.state != 6 &amp;&amp; target.state != 7) {
			if (debug) log.info("Set closure fields");
				
			target.state = 6;
			target.u_close_notes = "The incident has been marked Resolved by an external system.";
			target.close_code = "solved";
			target.resolved_by = getUser(source.u_resolved_by_user);
			target.work_notes = "PagerDuty: Resolved by " + source.u_resolved_by_name;
			
			// If Assgined to is blank, set it
			if (JSUtil.nil(target.assigned_to)) {
				target.assigned_to = getUser(source.u_resolved_by_user);
			}
		} else {
			// SN incident is already resolved or closed, do not set closure fields
			target.work_notes = "PagerDuty: Ignore incident.resolve event because incident is already Resolved or Closed.";
		}
		
		// Always sever relationship between SN and PD
		target.u_pagerduty = '';
		
		
	} else if (source.u_message_type == "incident.assign") {
		if (debug) log.info("In incident.assign logic");
			
		note = "PagerDuty: Manually assigned to " + source.u_assigned_to_name;
		
		// Treat acknowledge as assignment
		var usr = getUser(source.u_assigned_to_user);
		if (JSUtil.notNil(usr)) {
			target.assigned_to = usr;
		} else {
			note = note + "\n\nERROR: Could not set Assigned to field -- unable to find user with email = " + source.u_assigned_to_user;
		}
		
		target.work_notes = note;
		
	} else if (source.u_message_type == "incident.escalate") {
		if (debug) log.info("In incident.escalate logic");
			
		// Document who currently is being notified PD incident
		target.work_notes = "PagerDuty: Escalated within the specified policy -- attempting to notify " + source.u_assigned_to_name;
		
	} else if (source.u_message_type == "incident.delegate") {
		if (debug) log.info("In incident.delegate logic");
			
		note = "PagerDuty: Delegated to " + source.u_escalation_policy + " -- attempting to notify  " + source.u_assigned_to_name;
		
		// Delegated to another group
		// Clear out Assigned to field
		target.assigned_to = '';
		
		// Get new group
		var grp = getGroup(source.u_escalation_policy_id);
		if (JSUtil.notNil(grp)) {
			target.assignment_group = grp;
		} else {
			note = note + "\n\nERROR: Could not set Assignment Group field -- unable to find group with escalation polciy = " + source.u_escalation_policy_id;
		}
		
		target.work_notes = note;
		
		
	}
}
	
	function getUser(email) {
		// Get user sys_id given email address
		
		var usr = new GlideRecord('sys_user');
		usr.addQuery('email', email);
		usr.query();
		if (usr.next()) {
			return usr.sys_id.toString();
		}  else {
			log.warn('Unable to find user that matched email=' + email,'Map:PagerDuty');
		}
		
	}
	
	function getGroup(policy) {
		// Get group sys_id given policy id
		
		var grp = new GlideRecord('sys_user_group');
		grp.addQuery('u_pagerduty_policy', policy);
		grp.query();
		if (grp.next()) {
			return grp.sys_id.toString();
		} else {
			log.warn('Unable to find Level 2 group that matched escalation policy id=' + policy,'Map:PagerDuty');
		}
	}]]&gt;&lt;/script&gt;&lt;source_table&gt;u_pagerduty&lt;/source_table&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-17 01:25:54&lt;/sys_created_on&gt;&lt;sys_id&gt;25d55a4c4d176100c33a943ecf043e78&lt;/sys_id&gt;&lt;sys_mod_count&gt;45&lt;/sys_mod_count&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-08-13 00:14:32&lt;/sys_updated_on&gt;&lt;target_table&gt;incident&lt;/target_table&gt;&lt;/sys_transform_map&gt;&lt;sys_app_file action="INSERT_OR_UPDATE"&gt;&lt;customer_update&gt;true&lt;/customer_update&gt;&lt;publish_override/&gt;&lt;replace_on_upgrade&gt;false&lt;/replace_on_upgrade&gt;&lt;restore/&gt;&lt;sys_app/&gt;&lt;sys_code&gt;!!3RV/&lt;/sys_code&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-17 01:25:54&lt;/sys_created_on&gt;&lt;sys_id&gt;3cabd5166fb54600095acd9c5d3ee400&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;PagerDuty&lt;/sys_name&gt;&lt;sys_parent/&gt;&lt;sys_path&gt;!!3RV/&lt;/sys_path&gt;&lt;sys_policy/&gt;&lt;sys_source_deleted&gt;false&lt;/sys_source_deleted&gt;&lt;sys_source_id&gt;25d55a4c4d176100c33a943ecf043e78&lt;/sys_source_id&gt;&lt;sys_source_table&gt;sys_transform_map&lt;/sys_source_table&gt;&lt;sys_type/&gt;&lt;sys_update_name&gt;sys_transform_map_25d55a4c4d176100c33a943ecf043e78&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-08-13 00:14:32&lt;/sys_updated_on&gt;&lt;/sys_app_file&gt;&lt;/record_update&gt;</payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>3b36df7e6f524200095acd9c5d3ee4a4</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>PagerDuty</target_name>
<type>Table Transform Map</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_app_module_886ebcd59964310012e7cc5206158473</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_app_module"><sys_app_module action="INSERT_OR_UPDATE"><active>true</active><application display_value="Integration - PagerDuy">cf52bc159964310012e7cc52061584d2</application><assessment/><content_page/><device_type/><filter table="incident">u_pagerdutyISNOTEMPTY^EQ<item endquery="false" field="u_pagerduty" goto="false" newquery="false" operator="ISNOTEMPTY" or="false" value=""/><item endquery="true" field="" goto="false" newquery="false" operator="" or="false" value=""/></filter><hint/><homepage/><image/><link_type>LIST</link_type><map_page/><mobile_title>Incidents w PD</mobile_title><mobile_view_name>Mobile</mobile_view_name><name>incident</name><order>10</order><query/><report/><roles/><survey/><survey_overwrite>true</survey_overwrite><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 19:35:07</sys_created_on><sys_domain>global</sys_domain><sys_id>886ebcd59964310012e7cc5206158473</sys_id><sys_mod_count>5</sys_mod_count><sys_overrides/><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:45:36</sys_updated_on><timeline_page/><title>PD Incidents</title><uncancelable>false</uncancelable><view_name/><window_name/></sys_app_module><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!:*#/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 19:35:07</sys_created_on><sys_id>ea8e7cd59964310012e7cc520615848d</sys_id><sys_mod_count>0</sys_mod_count><sys_name>PD Incidents</sys_name><sys_parent/><sys_path>!!:*#/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>886ebcd59964310012e7cc5206158473</sys_source_id><sys_source_table>sys_app_module</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_app_module_886ebcd59964310012e7cc5206158473</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:45:36</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>3f365f7e6f524200095acd9c5d3ee449</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>incident</table>
<target_name>PD Incidents</target_name>
<type>Module</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_null</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="" table="u_pagerduty"><active>true</active><array>false</array><attributes/><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label/><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element/><element_reference>false</element_reference><foreign_database/><internal_type display_value="Collection">collection</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:25:38</sys_created_on><sys_id>59d51a4c4d176100c33a943ecf043e7a</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:45:08</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QO/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:25:38</sys_created_on><sys_id>a0aa70bd6f210600095acd9c5d3ee417</sys_id><sys_mod_count>0</sys_mod_count><sys_name>u_pagerduty</sys_name><sys_parent display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_parent><sys_path>!!3Q4/!!3QO/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="NULL" name="u_pagerduty" sys_source_table="sys_dictionary">59d51a4c4d176100c33a943ecf043e7a</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_null</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-09-17 01:25:38</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>3f365f7e6f524200095acd9c5d3ee44a</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_number</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_number" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_number</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Number</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_number</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:25</sys_created_on><sys_id>1d303f57fda36100c33aa767053a353b</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:25</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QD/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:25</sys_created_on><sys_id>ef7700606f428600095acd9c5d3ee4b8</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Number</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3QD/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_number" name="u_pagerduty" sys_source_table="sys_dictionary">1d303f57fda36100c33aa767053a353b</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_number</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:25</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>3f365f7e6f524200095acd9c5d3ee44b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Number</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_updated_by_user</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_updated_by_user" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_updated_by_user</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Updated By User</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_updated_by_user</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:26</sys_created_on><sys_id>11303f57fda36100c33aa767053a353d</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:26</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QK/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:26</sys_created_on><sys_id>408700606f428600095acd9c5d3ee4de</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Updated By User</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3QK/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_updated_by_user" name="u_pagerduty" sys_source_table="sys_dictionary">11303f57fda36100c33aa767053a353d</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_updated_by_user</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:26</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>3f365f7e6f524200095acd9c5d3ee44c</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Updated By User</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_2dfdd2775576210012e79621ec424be5</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn"><sys_rest_message_fn action="INSERT_OR_UPDATE"><basic_auth_password/><basic_auth_user/><content>${payload}</content><function_name>post</function_name><lock>false</lock><rest_endpoint>https://events.pagerduty.com/generic/2010-04-15/create_event.json</rest_endpoint><rest_message display_value="PagerDuty">08eddab75576210012e79621ec424b62</rest_message><sys_created_by>admin.jwilson</sys_created_by><sys_created_on>2014-09-03 21:06:58</sys_created_on><sys_id>2dfdd2775576210012e79621ec424be5</sys_id><sys_mod_count>7</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:40:55</sys_updated_on><use_basic_auth>false</use_basic_auth><use_mid_server/></sys_rest_message_fn><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9LS/</sys_code><sys_created_by>admin.jwilson</sys_created_by><sys_created_on>2014-09-03 21:06:58</sys_created_on><sys_id>e20f12c3656b254033f3979d4c1e9116</sys_id><sys_mod_count>0</sys_mod_count><sys_name>post</sys_name><sys_parent display_value="PagerDuty">aa0fde83656b254033f3979d4c1e91ee</sys_parent><sys_path>!!9LP/!!9LS/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>2dfdd2775576210012e79621ec424be5</sys_source_id><sys_source_table>sys_rest_message_fn</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_2dfdd2775576210012e79621ec424be5</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:40:55</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>3f365f7e6f524200095acd9c5d3ee44d</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>post</target_name>
<type>REST Message Function</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_parameters_d8a11c7ffd276100c33aa767053a355b</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn_parameters"><sys_rest_message_fn_parameters action="INSERT_OR_UPDATE"><name>token</name><rest_message_function display_value="put">a3e06fac4d9b6100c33a943ecf043ed1</rest_message_function><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-10 17:41:00</sys_created_on><sys_id>d8a11c7ffd276100c33aa767053a355b</sys_id><sys_mod_count>4</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:26:09</sys_updated_on><type>string</type><value/></sys_rest_message_fn_parameters><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9OM/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-10 17:41:00</sys_created_on><sys_id>950e529d65bb294033f3979d4c1e91a8</sys_id><sys_mod_count>0</sys_mod_count><sys_name>token</sys_name><sys_parent display_value="put">6e0f12c3656b254033f3979d4c1e9117</sys_parent><sys_path>!!9LQ/!!9LU/!!9OM/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>d8a11c7ffd276100c33aa767053a355b</sys_source_id><sys_source_table>sys_rest_message_fn_parameters</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_parameters_d8a11c7ffd276100c33aa767053a355b</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:26:09</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>3f36df7e6f524200095acd9c5d3ee4a3</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>token</target_name>
<type>REST Message Function Parameters</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_ui_section_0e58739fc0a8016400e2e29c13e3798d</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_ui_section section_id="0e58739fc0a8016400e2e29c13e3798d" sys_domain="global" table="sys_user_group" version="2"><sys_ui_element action="INSERT_OR_UPDATE"><element>name</element><position>0</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-14 21:27:40</sys_created_on><sys_id>3c3fc3326f794600095acd9c5d3ee4a2</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">0e58739fc0a8016400e2e29c13e3798d</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-14 21:27:40</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>manager</element><position>1</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-14 21:27:41</sys_created_on><sys_id>7c3fc3326f794600095acd9c5d3ee4a2</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">0e58739fc0a8016400e2e29c13e3798d</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-14 21:27:41</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>.split</element><position>2</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-14 21:27:41</sys_created_on><sys_id>bc3fc3326f794600095acd9c5d3ee4a2</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">0e58739fc0a8016400e2e29c13e3798d</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-14 21:27:41</sys_updated_on><sys_user/><type>.split</type></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>email</element><position>3</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-14 21:27:41</sys_created_on><sys_id>fc3fc3326f794600095acd9c5d3ee4a2</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">0e58739fc0a8016400e2e29c13e3798d</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-14 21:27:41</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>parent</element><position>4</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-14 21:27:41</sys_created_on><sys_id>303fc3326f794600095acd9c5d3ee4a3</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">0e58739fc0a8016400e2e29c13e3798d</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-14 21:27:41</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>.end_split</element><position>5</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-14 21:27:41</sys_created_on><sys_id>703fc3326f794600095acd9c5d3ee4a3</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">0e58739fc0a8016400e2e29c13e3798d</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-14 21:27:41</sys_updated_on><sys_user/><type>.end_split</type></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>description</element><position>6</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-14 21:27:41</sys_created_on><sys_id>b03fc3326f794600095acd9c5d3ee4a3</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">0e58739fc0a8016400e2e29c13e3798d</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-14 21:27:41</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>u_pagerduty_policy</element><position>7</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-14 21:27:41</sys_created_on><sys_id>f03fc3326f794600095acd9c5d3ee4a3</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">0e58739fc0a8016400e2e29c13e3798d</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-14 21:27:41</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>u_pagerduty_service</element><position>8</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-14 21:27:41</sys_created_on><sys_id>303fcf326f794600095acd9c5d3ee47e</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">0e58739fc0a8016400e2e29c13e3798d</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-14 21:27:41</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_section action="INSERT_OR_UPDATE"><caption/><header>false</header><name>sys_user_group</name><roles/><sys_created_by>admin</sys_created_by><sys_created_on>2005-02-14 00:50:40</sys_created_on><sys_domain>global</sys_domain><sys_id>0e58739fc0a8016400e2e29c13e3798d</sys_id><sys_mod_count>3</sys_mod_count><sys_overrides/><sys_updated_by>system</sys_updated_by><sys_updated_on>2015-08-12 21:51:43</sys_updated_on><sys_user/><title>true</title><view display_value="Default view" name="NULL">Default view</view><view_name/></sys_ui_section></sys_ui_section><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app display_value="Contextual Security">be4f81d26fb54600095acd9c5d3ee42f</sys_app><sys_code>!!2|A/</sys_code><sys_created_by>admin</sys_created_by><sys_created_on>2005-02-14 00:50:40</sys_created_on><sys_id>c32ec1526fb54600095acd9c5d3ee4b3</sys_id><sys_mod_count>1</sys_mod_count><sys_name>sys_user_group</sys_name><sys_parent display_value="Group">83bb855e6f754600095acd9c5d3ee4de</sys_parent><sys_path>!!0JG/!!2|A/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>0e58739fc0a8016400e2e29c13e3798d</sys_source_id><sys_source_table>sys_ui_section</sys_source_table><sys_type/><sys_update_name>sys_ui_section_0e58739fc0a8016400e2e29c13e3798d</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-14 21:27:41</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>3f36df7e6f524200095acd9c5d3ee4a4</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>sys_user_group</table>
<target_name>Group</target_name>
<type>Form Layout</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_app_module_fcedf8d59964310012e7cc520615844c</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_app_module"><sys_app_module action="INSERT_OR_UPDATE"><active>true</active><application display_value="Integration - PagerDuy">cf52bc159964310012e7cc52061584d2</application><assessment/><content_page/><device_type/><filter/><hint/><homepage/><image/><link_type>SEPARATOR</link_type><map_page/><mobile_title>Diagnostics</mobile_title><mobile_view_name>Mobile</mobile_view_name><name/><order>500</order><query/><report/><roles/><survey/><survey_overwrite>true</survey_overwrite><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 19:32:31</sys_created_on><sys_domain>global</sys_domain><sys_id>fcedf8d59964310012e7cc520615844c</sys_id><sys_mod_count>1</sys_mod_count><sys_overrides/><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:32:37</sys_updated_on><timeline_page/><title>Diagnostics</title><uncancelable>false</uncancelable><view_name/><window_name/></sys_app_module><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!:)~/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 19:32:31</sys_created_on><sys_id>64fdb8d59964310012e7cc520615843f</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Diagnostics</sys_name><sys_parent/><sys_path>!!:)~/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>fcedf8d59964310012e7cc520615844c</sys_source_id><sys_source_table>sys_app_module</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_app_module_fcedf8d59964310012e7cc520615844c</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:32:37</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>73365f7e6f524200095acd9c5d3ee44a</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table/>
<target_name>Diagnostics</target_name>
<type>Module</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_assigned_to_user</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_assigned_to_user" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_assigned_to_user</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Assigned To User</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_assigned_to_user</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>100</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>c23d5e4c4d176100c33a943ecf043ef4</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:39</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3Q;/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>479a30bd6f210600095acd9c5d3ee4ef</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Assigned To User</sys_name><sys_parent display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_parent><sys_path>!!3Q4/!!3Q;/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_assigned_to_user" name="u_pagerduty" sys_source_table="sys_dictionary">c23d5e4c4d176100c33a943ecf043ef4</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_assigned_to_user</sys_update_name><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:39</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>73365f7e6f524200095acd9c5d3ee44b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Assigned To User</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_resolved_by_user</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_resolved_by_user" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_resolved_by_user</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Resolved By User</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_resolved_by_user</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>100</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>d63d5a8c4d176100c33a943ecf043ed1</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:41</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QF/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>f77700606f428600095acd9c5d3ee4bc</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Resolved By User</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3QF/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_resolved_by_user" name="u_pagerduty" sys_source_table="sys_dictionary">d63d5a8c4d176100c33a943ecf043ed1</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_resolved_by_user</sys_update_name><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:41</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>73365f7e6f524200095acd9c5d3ee44c</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Resolved By User</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_documentation_incident_u_pagerduty_key_en</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_documentation element="u_pagerduty_key" label="PagerDuty Key" language="en" table="incident"><sys_documentation action="INSERT_OR_UPDATE"><element>u_pagerduty_key</element><help/><hint/><label>PagerDuty Key</label><language>en</language><name>incident</name><plural>PagerDuty Keys</plural><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:52:38</sys_created_on><sys_id>96abdca06f428600095acd9c5d3ee4bb</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:52:38</sys_updated_on><url/><url_target/></sys_documentation></sys_documentation><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3RZ/</sys_code><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:52:38</sys_created_on><sys_id>56abdca06f428600095acd9c5d3ee4bc</sys_id><sys_mod_count>1</sys_mod_count><sys_name>PagerDuty Key</sys_name><sys_parent display_value="PagerDuty Key">d2abdca06f428600095acd9c5d3ee4ba</sys_parent><sys_path>!!$A./!!3RY/!!3RZ/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_pagerduty_key" language="en" name="incident" sys_source_table="sys_documentation">96abdca06f428600095acd9c5d3ee4bb</sys_source_id><sys_source_table>sys_documentation</sys_source_table><sys_type/><sys_update_name>sys_documentation_incident_u_pagerduty_key_en</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:52:38</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>73365f7e6f524200095acd9c5d3ee44d</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>incident</table>
<target_name>Incident.PagerDuty Key</target_name>
<type>Field Label</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_headers_44212f6c4d9b6100c33a943ecf043eea</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn_headers"><sys_rest_message_fn_headers action="INSERT_OR_UPDATE"><name>Authorization</name><rest_message_function display_value="get">a3e06fac4d9b6100c33a943ecf043ed0</rest_message_function><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:12:23</sys_created_on><sys_id>44212f6c4d9b6100c33a943ecf043eea</sys_id><sys_mod_count>4</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:19:56</sys_updated_on><value>${token}</value></sys_rest_message_fn_headers><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9L]/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:12:23</sys_created_on><sys_id>2e0f12c3656b254033f3979d4c1e911c</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Authorization</sys_name><sys_parent display_value="get">220f12c3656b254033f3979d4c1e9117</sys_parent><sys_path>!!9LQ/!!9LT/!!9L]/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>44212f6c4d9b6100c33a943ecf043eea</sys_source_id><sys_source_table>sys_rest_message_fn_headers</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_headers_44212f6c4d9b6100c33a943ecf043eea</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:19:56</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>73365f7e6f524200095acd9c5d3ee44e</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>Authorization</target_name>
<type>REST Message Function Headers</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_script_cb4e60d04d976100c33a943ecf043e06</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update sys_domain="global" table="sys_script"&gt;&lt;sys_script action="INSERT_OR_UPDATE"&gt;&lt;abort_action&gt;false&lt;/abort_action&gt;&lt;action_delete&gt;false&lt;/action_delete&gt;&lt;action_insert&gt;true&lt;/action_insert&gt;&lt;action_label/&gt;&lt;action_name/&gt;&lt;action_query&gt;false&lt;/action_query&gt;&lt;action_run_at&gt;server&lt;/action_run_at&gt;&lt;action_update&gt;true&lt;/action_update&gt;&lt;active&gt;true&lt;/active&gt;&lt;add_message&gt;false&lt;/add_message&gt;&lt;advanced&gt;true&lt;/advanced&gt;&lt;application/&gt;&lt;client_callable&gt;false&lt;/client_callable&gt;&lt;collection&gt;incident&lt;/collection&gt;&lt;condition/&gt;&lt;description/&gt;&lt;filter_condition table="incident"&gt;u_pagerdutyISNOTEMPTY^stateCHANGESTO6^ORstateCHANGESTO7^NQu_pagerdutyISNOTEMPTY^state=-5^u_substateCHANGESTOengineering complete^ORu_substateCHANGESTOpending release^EQ&lt;item endquery="false" field="u_pagerduty" goto="false" newquery="false" operator="ISNOTEMPTY" or="false" value=""/&gt;&lt;item endquery="false" field="state" goto="false" newquery="false" operator="CHANGESTO" or="false" value="6"/&gt;&lt;item endquery="false" field="state" goto="false" newquery="false" operator="CHANGESTO" or="true" value="7"/&gt;&lt;item endquery="false" field="u_pagerduty" goto="false" newquery="true" operator="ISNOTEMPTY" or="false" value=""/&gt;&lt;item endquery="false" field="state" goto="false" newquery="false" operator="=" or="false" value="-5"/&gt;&lt;item endquery="false" field="u_substate" goto="false" newquery="false" operator="CHANGESTO" or="false" value="engineering complete"/&gt;&lt;item endquery="false" field="u_substate" goto="false" newquery="false" operator="CHANGESTO" or="true" value="pending release"/&gt;&lt;item endquery="true" field="" goto="false" newquery="false" operator="" or="false" value=""/&gt;&lt;/filter_condition&gt;&lt;message/&gt;&lt;name&gt;Resolve PagerDuty Incident&lt;/name&gt;&lt;onclick/&gt;&lt;order&gt;100&lt;/order&gt;&lt;priority&gt;100&lt;/priority&gt;&lt;read_access_action&gt;false&lt;/read_access_action&gt;&lt;role_conditions/&gt;&lt;script&gt;&lt;![CDATA[// ServiceNow incident escalation complete -- resolve PagerDuty incident
var debug = true;
if (debug) gs.log("Entered", "BR:Resolve PagerDuty Incident");

var pd = new PagerDuty_REST();

// Lookup service key
var key = current.assignment_group.u_pagerduty_service.toString();

// Construct JSON object
var newstate;
if (JSUtil.nil(current.u_substate)) {
	newstate = current.state.getDisplayValue();
} else {
	newstate = current.state.getDisplayValue() + "/" + current.u_substate.getDisplayValue();
}
var body = "This incident was moved to " + newstate + " by " + current.sys_updated_by + ". Closing PagerDuty incident (if incident is re-opened, a new PD alert will be created).";
var details = {AssignmentGroup: current.assignment_group.name.toString(),
			   ResolvedByUser: current.resolved_by.name.toString(),
			   Code: current.close_code.getDisplayValue(),
			   Note: current.close_notes.toString()};
if (debug) JSUtil.logObject(details, "BR:Resolve PagerDuty Incident");

//if (debug) JSUtil.logObject(details, "BR:Resolve PagerDuty Incident");

// Create PD incident
var resp_message = pd.resolveIncident(key, current.u_pagerduty.toString(), body, details);

if (!pd.hasError) {
	if (debug) gs.log("resp_message=" + resp_message, "BR:Resolve PagerDuty Incident");
	// Success: Clear PagerDuty field
	current.u_pagerduty = '';
	
} else {
	gs.addErrorMessage("PagerDuty integration error -- " + pd.errMsg + ". Re-escalate or contact the ServiceNow system administrators.");
	gs.logError("PagerDuty integration failed: incident=" + current.number + ", key=" + key, "BR:Trigger PagerDuty Incident");
	current.work_notes = "PagerDuty integration error -- " + pd.errMsg + ". Re-escalate or contact the ServiceNow system administrators.";
}

if (debug) gs.log("Exiting", "BR:Resolve PagerDuty Incident");]]&gt;&lt;/script&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-17 12:31:45&lt;/sys_created_on&gt;&lt;sys_domain&gt;global&lt;/sys_domain&gt;&lt;sys_id&gt;cb4e60d04d976100c33a943ecf043e06&lt;/sys_id&gt;&lt;sys_mod_count&gt;18&lt;/sys_mod_count&gt;&lt;sys_overrides/&gt;&lt;sys_updated_by&gt;jwilson&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2014-11-21 20:29:34&lt;/sys_updated_on&gt;&lt;template/&gt;&lt;when&gt;before&lt;/when&gt;&lt;/sys_script&gt;&lt;sys_app_file action="INSERT_OR_UPDATE"&gt;&lt;customer_update&gt;true&lt;/customer_update&gt;&lt;publish_override/&gt;&lt;replace_on_upgrade&gt;false&lt;/replace_on_upgrade&gt;&lt;restore/&gt;&lt;sys_app/&gt;&lt;sys_code&gt;!!9M*/&lt;/sys_code&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-17 12:31:45&lt;/sys_created_on&gt;&lt;sys_id&gt;b60f12c3656b254033f3979d4c1e9172&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;Resolve PagerDuty Incident&lt;/sys_name&gt;&lt;sys_parent display_value="Incident"&gt;42fdf901a440110056d5b5bdb2273fa2&lt;/sys_parent&gt;&lt;sys_path&gt;!!(WU/!!9M*/&lt;/sys_path&gt;&lt;sys_policy/&gt;&lt;sys_source_deleted&gt;false&lt;/sys_source_deleted&gt;&lt;sys_source_id&gt;cb4e60d04d976100c33a943ecf043e06&lt;/sys_source_id&gt;&lt;sys_source_table&gt;sys_script&lt;/sys_source_table&gt;&lt;sys_type&gt;code&lt;/sys_type&gt;&lt;sys_update_name&gt;sys_script_cb4e60d04d976100c33a943ecf043e06&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;jwilson&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2014-11-21 20:29:34&lt;/sys_updated_on&gt;&lt;/sys_app_file&gt;&lt;/record_update&gt;</payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>7336df7e6f524200095acd9c5d3ee4a4</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>incident</table>
<target_name>Resolve PagerDuty Incident</target_name>
<type>Business Rule</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_app_application_cf52bc159964310012e7cc52061584d2</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_app_application"><sys_app_application action="INSERT_OR_UPDATE"><active>true</active><category/><description/><device_type>browser</device_type><hint/><name>Integration - PagerDuty</name><order/><roles>admin</roles><sys_app_file display_value="PagerDuty">2b9b95166fb54600095acd9c5d3ee4cd</sys_app_file><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 18:41:54</sys_created_on><sys_domain>global</sys_domain><sys_id>cf52bc159964310012e7cc52061584d2</sys_id><sys_mod_count>1</sys_mod_count><sys_overrides/><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-18 17:57:28</sys_updated_on><title>PagerDuty</title><view_name/></sys_app_application><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3R+/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 18:41:54</sys_created_on><sys_id>2b9b95166fb54600095acd9c5d3ee4cd</sys_id><sys_mod_count>0</sys_mod_count><sys_name>PagerDuty</sys_name><sys_parent/><sys_path>!!3R+/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>cf52bc159964310012e7cc52061584d2</sys_source_id><sys_source_table>sys_app_application</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_app_application_cf52bc159964310012e7cc52061584d2</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-18 17:57:28</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>77365f7e6f524200095acd9c5d3ee449</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table/>
<target_name>PagerDuty</target_name>
<type>Application Menu</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_db_object_91d51a4c4d176100c33a943ecf043e7a</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_db_object"><sys_db_object action="INSERT_OR_UPDATE"><create_access_controls>false</create_access_controls><extension_model/><is_extendable>false</is_extendable><label>Pagerduty1</label><live_feed_enabled>false</live_feed_enabled><name>u_pagerduty</name><number_ref/><provider_class/><super_class display_value="Import Set Row" name="sys_import_set_row">6d7850bd6fedc200095acd9c5d3ee480</super_class><sys_app_file display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_app_file><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:25:37</sys_created_on><sys_id>91d51a4c4d176100c33a943ecf043e7a</sys_id><sys_mod_count>1</sys_mod_count><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-07-29 21:48:58</sys_updated_on><user_role/></sys_db_object><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3Q4/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:25:37</sys_created_on><sys_id>ee9a30bd6f210600095acd9c5d3ee4d3</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Pagerduty</sys_name><sys_parent/><sys_path>!!3Q4/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id name="u_pagerduty" sys_source_table="sys_db_object">91d51a4c4d176100c33a943ecf043e7a</sys_source_id><sys_source_table>sys_db_object</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_db_object_91d51a4c4d176100c33a943ecf043e7a</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-07-29 21:48:58</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>77365f7e6f524200095acd9c5d3ee44a</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1</target_name>
<type>Table</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_escalation_policy_id</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_escalation_policy_id" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_escalation_policy_id</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Escalation Policy Id</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_escalation_policy_id</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 21:08:38</sys_created_on><sys_id>8d97bb97fda36100c33aa767053a3500</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 21:08:38</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3Q?/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 21:08:38</sys_created_on><sys_id>5f9a30bd6f210600095acd9c5d3ee4f2</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Escalation Policy Id</sys_name><sys_parent display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_parent><sys_path>!!3Q4/!!3Q?/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_escalation_policy_id" name="u_pagerduty" sys_source_table="sys_dictionary">8d97bb97fda36100c33aa767053a3500</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_escalation_policy_id</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 21:08:38</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>77365f7e6f524200095acd9c5d3ee44b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Escalation Policy Id</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_service_name</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_service_name" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_service_name</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Service Name</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_service_name</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2015-07-31 17:31:00</sys_created_on><sys_id>ea8289bd6f210600095acd9c5d3ee460</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-07-31 17:31:00</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QH/</sys_code><sys_created_by>admin</sys_created_by><sys_created_on>2015-07-31 17:31:00</sys_created_on><sys_id>cc8700606f428600095acd9c5d3ee4bf</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Service Name</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3QH/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_service_name" name="u_pagerduty" sys_source_table="sys_dictionary">ea8289bd6f210600095acd9c5d3ee460</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_service_name</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-07-31 17:31:00</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>77365f7e6f524200095acd9c5d3ee44c</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Service Name</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_documentation_u_pagerduty__en</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_documentation element="" label="Pagerduty1" language="en" table="u_pagerduty"><sys_documentation action="INSERT_OR_UPDATE"><element/><help/><hint/><label>Pagerduty1</label><language>en</language><name>u_pagerduty</name><plural>Pagerduty1s</plural><sys_created_by>jschraith</sys_created_by><sys_created_on>2014-10-08 20:03:13</sys_created_on><sys_id>cd0fde83656b254033f3979d4c1e919b</sys_id><sys_mod_count>3</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:38:14</sys_updated_on><url/><url_target/></sys_documentation></sys_documentation><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9LA/</sys_code><sys_created_by>jschraith</sys_created_by><sys_created_on>2014-10-08 20:03:13</sys_created_on><sys_id>050fde83656b254033f3979d4c1e919c</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Pagerduty1</sys_name><sys_parent display_value="u_pagerduty">c10fde83656b254033f3979d4c1e9199</sys_parent><sys_path>!!9L4/!!9L@/!!9LA/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="NULL" language="en" name="u_pagerduty" sys_source_table="sys_documentation">cd0fde83656b254033f3979d4c1e919b</sys_source_id><sys_source_table>sys_documentation</sys_source_table><sys_type/><sys_update_name>sys_documentation_u_pagerduty__en</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:38:14</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>77365f7e6f524200095acd9c5d3ee44d</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1</target_name>
<type>Field Label</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_parameters_24100d544d976100c33a943ecf043e98</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn_parameters"><sys_rest_message_fn_parameters action="INSERT_OR_UPDATE"><name>payload</name><rest_message_function display_value="post">2dfdd2775576210012e79621ec424be5</rest_message_function><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 13:49:58</sys_created_on><sys_id>24100d544d976100c33a943ecf043e98</sys_id><sys_mod_count>1</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:28:25</sys_updated_on><type>xml</type><value>{"service_key": "key","event_type": "trigger","description": "payload", "client": "ServiceNow REST", "client_url": "", "details": {"assignment_group": "hello"}}</value></sys_rest_message_fn_parameters><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9L|/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 13:49:58</sys_created_on><sys_id>320f12c3656b254033f3979d4c1e9120</sys_id><sys_mod_count>0</sys_mod_count><sys_name>payload</sys_name><sys_parent display_value="post">e20f12c3656b254033f3979d4c1e9116</sys_parent><sys_path>!!9LP/!!9LS/!!9L|/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>24100d544d976100c33a943ecf043e98</sys_source_id><sys_source_table>sys_rest_message_fn_parameters</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_parameters_24100d544d976100c33a943ecf043e98</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:28:25</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>77365f7e6f524200095acd9c5d3ee44e</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>payload</target_name>
<type>REST Message Function Parameters</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_script_include_403468884dd36100c33a943ecf043e41</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_include"&gt;&lt;sys_script_include action="INSERT_OR_UPDATE"&gt;&lt;active&gt;true&lt;/active&gt;&lt;client_callable&gt;false&lt;/client_callable&gt;&lt;description&gt;Handles outbound communication to PagerDuty. Supports both Integration API and REST API.&lt;/description&gt;&lt;name&gt;PagerDuty_REST&lt;/name&gt;&lt;script&gt;&lt;![CDATA[var PagerDuty_REST = Class.create();
PagerDuty_REST.prototype = {
    initialize: function() {
        this.debug = true;
		
		// TODO: Add system properties to hold these values
		this.authToken = '&lt;PAGERDUTY API ACCESS KEY&gt;';
		this.baseEndpoint = 'https://&lt;PAGERDUTY INSTANCE NAME&gt;.pagerduty.com/api/v1/';

        this.hasError = false;
        this.errMsg = '';
        
    },
    
    
    getServiceKey: function(group) {
        var gr = new GlideRecord('sys_user_group');
        
        if (gr.get(group)) {
            return gr.u_pagerduty_service;
        }
        
    },

    
    triggerIncident: function(key, incident_id, number, description, details) {
        // Trigger incident in PagerDuty
        
        // Get instance and construct URL to incident
        var instance = gs.getProperty('instance_name');
        var url = 'https://' + instance + '.service-now.com/nav_to.do?uri=incident.do?sys_id=' + incident_id;

        // Create POST body
        var postBody = {client_url: url,
                service_key: key,
                description: description,
                client: 'ServiceNow',
                details: details,
                event_type: 'trigger' };
        
        
        // Issue command
        var response = this.post(postBody);

        // Return PD incident key if no error
        if (!this.hasError) {
            return response.incident_key;
        } 

    },

    resolveIncident: function(key, incident_key, description, details) {
        // Resolve incident in pagerduty
        
        // Create POST body
        var postBody = {service_key: key,
                event_type: 'resolve',
                incident_key: incident_key,
                description: description,
                details: details
                };
        
         // Issue command
        var response = this.post(postBody);
        
        // Return PD incident key if no error
        if (!this.hasError) {
            return response.message;
        } 
        
    },

    assignIncident: function(incident_id, assigned_email, requestor_email) {
        // Use PagerDuty's REST API to assign

        // Get user ids from PagerDuty (from email address)
        
        var assigned_id = this.getUserIdByEmail(assigned_email);
        var requester_id = this.getUserIdByEmail(requestor_email);

        // Construct endpoint
        var feature = 'incidents/' + incident_id + '/reassign';
        if (this.debug) gs.log('feature=' + feature, 'PagerDuty.assignIncident()');


        // Contstruct payload
        var body = {requester_id: requester_id, assigned_to_user: assigned_id};
        if (this.debug) JSUtil.logObject(body);

        // Make web request
        var response = this.putREST(feature, body);


    },

    delegateIncident: function(incident_id, group_policy_id, requestor_email) {
        // Use PagerDuty's REST API to assign

        // Get user ids from PagerDuty (from email address)
        var requester_id = this.getUserIdByEmail(requestor_email);

        // Construct endpoint
        var feature = 'incidents/' + incident_id + '/reassign';
        if (this.debug) gs.log('feature=' + feature, 'PagerDuty.delegateIncident()');


        // Contstruct payload
        var body = {requester_id: requester_id, escalation_policy: group_policy_id};
        if (this.debug) JSUtil.logObject(body);

        // Make web request
        var response = this.putREST(feature, body);


    },

    getUserIdByEmail: function(email) {
        // Ask PagerDuty for user id for 

        var feature = 'users?query=' + GlideStringUtil.urlEncode(email);
        if (this.debug) gs.log('feature=' + feature, 'PagerDuty.getUserIdByEmail()');

        var usrResponse = this.getREST(feature);
        

        if (!this.hasError) {
            var id = usrResponse.users[0].id;
            return id;
        }
        
        
    },
	
	getServiceKeyByID: function(id) {
        // Ask PagerDuty for service key for 

        var feature = 'services/' + id;
        if (this.debug) gs.log('feature=' + feature, 'PagerDuty.getServiceKeyByID()');

        var usrResponse = this.getREST(feature);
        

        if (!this.hasError) {
            var key = usrResponse.service.service_key;
            return key;
        }
        
        
    },

    putREST: function(feature, bodyIn) {
        // Send web request via PagerDuty's REST API

        // Configure REST message
        var rMsg = new RESTMessage('PagerDuty_REST_API', 'put');
        rMsg.setRestEndPoint(this.baseEndpoint + feature);
        rMsg.setStringParameter('token', 'Token token=' + this.authToken);

        var json = new JSON();
        var bodyJSON = json.encode(bodyIn);
        rMsg.setXMLParameter('payload', bodyJSON);

        // Execute
        var response = rMsg.execute();

        // Inspect returned status code
        var parser = new JSONParser();
        var body = parser.parse(response.getBody());
        var status = response.getStatusCode().toString();
        if (this.debug) gs.log('status=' + status, 'PagerDuty.putREST()');

        if (status != 200) {
            this.hasError = true;
            this.errMsg = body.error.message + " (code " + body.error.code + ")";
            gs.logError(response.getBody(), 'PagerDuty.putREST()');
                            
        } else {
            if (this.debug) JSUtil.logObject(body);

            return body;

        }
        
        if (this.debug) gs.log('Exiting status=' + status, 'PagerDuty.getRest()');
    },

    getREST: function(feature) {
        // Send web request via PagerDuty's REST API

        // Configure REST message
        var rMsg = new RESTMessage('PagerDuty_REST_API', 'get');
        rMsg.setRestEndPoint(this.baseEndpoint + feature);
        rMsg.setStringParameter('token', 'Token token=' + this.authToken);
        if (this.debug) gs.log('endpoint=' + rMsg.getEndpoint(), 'PagerDuty.getREST()');
        
        // Execute
        var response = rMsg.execute();

        // Inspect returned status code
        var parser = new JSONParser();
        var body = parser.parse(response.getBody());
        var status = response.getStatusCode().toString();
        if (this.debug) gs.log('status=' + status, 'PagerDuty.getREST()');

        if (status != 200) {
            this.hasError = true;
            this.errMsg = body.error.message + " (code " + body.error.code + ")";
            gs.logError(response.getBody(), 'PagerDuty.getRest()');
                            
        } else {
            if (this.debug) JSUtil.logObject(body);

            return body;

        }
        
        if (this.debug) gs.log('Exiting status=' + status, 'PagerDuty.getRest()');


    },
    
    post: function(body) {
        // Send web request via PagerDuty's Integration API

        if (this.debug) JSUtil.logObject(body, "PagerDuty_REST.post()");

        // Convert body (javascript object) to JSON
        var json = new JSON();
        var bodyJSON = json.encode(body);
        if (this.debug) gs.log("bodyJSON=" + bodyJSON,  "PagerDuty_REST.post()");

        // Construct message
        var r = new RESTMessage('PagerDuty', 'post');
        r.setXMLParameter('payload', bodyJSON);

        // Send request
        var response = r.execute();
        
        // Process response
        var status = response.getStatusCode();
        if (this.debug) gs.log("response status=" + status, "PagerDuty_REST.post()");
            
        var parser = new JSONParser();
        if (status == 200) {
            // Get response into JSON
            var respObj = parser.parse(response.getBody());
            /** "status": "success", "message": "Event processed", "incident_key": "26c2e798824442919e204fbac35c1b8b" **/
            // Return response as a javascript object
            return respObj;
            
        } else {
            this.hasError = true;
            var errObj = parser.parse(response.getBody());
            this.errMsg = errObj.message + " [" + errObj.errors.toString() + "]";
            
        }

    },
    
    type: 'PagerDuty_REST'
};]]&gt;&lt;/script&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-16 17:09:16&lt;/sys_created_on&gt;&lt;sys_id&gt;403468884dd36100c33a943ecf043e41&lt;/sys_id&gt;&lt;sys_mod_count&gt;90&lt;/sys_mod_count&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-08-19 18:40:59&lt;/sys_updated_on&gt;&lt;/sys_script_include&gt;&lt;sys_app_file action="INSERT_OR_UPDATE"&gt;&lt;customer_update&gt;true&lt;/customer_update&gt;&lt;publish_override/&gt;&lt;replace_on_upgrade&gt;false&lt;/replace_on_upgrade&gt;&lt;restore/&gt;&lt;sys_app/&gt;&lt;sys_code&gt;!!3RP/&lt;/sys_code&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-16 17:09:16&lt;/sys_created_on&gt;&lt;sys_id&gt;249740606f428600095acd9c5d3ee496&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;PagerDuty_REST&lt;/sys_name&gt;&lt;sys_parent/&gt;&lt;sys_path&gt;!!3RP/&lt;/sys_path&gt;&lt;sys_policy/&gt;&lt;sys_source_deleted&gt;false&lt;/sys_source_deleted&gt;&lt;sys_source_id&gt;403468884dd36100c33a943ecf043e41&lt;/sys_source_id&gt;&lt;sys_source_table&gt;sys_script_include&lt;/sys_source_table&gt;&lt;sys_type&gt;code&lt;/sys_type&gt;&lt;sys_update_name&gt;sys_script_include_403468884dd36100c33a943ecf043e41&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-08-19 18:40:59&lt;/sys_updated_on&gt;&lt;/sys_app_file&gt;&lt;/record_update&gt;</payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>7736df7e6f524200095acd9c5d3ee4a4</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>PagerDuty_REST</target_name>
<type>Script Include</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>DELETE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_app_module_622470559964310012e7cc520615847a</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_app_module"><sys_app_module action="DELETE"><active>true</active><application display_value="Integration - PagerDuy">cf52bc159964310012e7cc52061584d2</application><assessment/><content_page/><device_type/><filter table="cmdb_ci_web_service">nameLIKEPagerDuty^EQ<item endquery="false" field="name" goto="false" newquery="false" operator="LIKE" or="false" value="PagerDuty"/><item endquery="true" field="" goto="false" newquery="false" operator="" or="false" value=""/></filter><hint/><homepage/><image/><link_type>LIST</link_type><map_page/><mobile_title>Web Services</mobile_title><mobile_view_name>Mobile</mobile_view_name><name>cmdb_ci_web_service</name><order/><query/><report/><roles/><survey/><survey_overwrite>true</survey_overwrite><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 18:50:17</sys_created_on><sys_domain>global</sys_domain><sys_id>622470559964310012e7cc520615847a</sys_id><sys_mod_count>0</sys_mod_count><sys_overrides/><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 18:50:17</sys_updated_on><timeline_page/><title>Web Services</title><uncancelable>false</uncancelable><view_name/><window_name/></sys_app_module><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore display_value="sys_app_module_622470559964310012e7cc520615847a">b9447c559964310012e7cc520615842d</restore><sys_app/><sys_code>!!:){/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 18:50:17</sys_created_on><sys_id>b54430559964310012e7cc5206158434</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Web Services</sys_name><sys_parent/><sys_path>!!:){/</sys_path><sys_policy/><sys_source_deleted>true</sys_source_deleted><sys_source_id>622470559964310012e7cc520615847a</sys_source_id><sys_source_table>sys_app_module</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_app_module_622470559964310012e7cc520615847a</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 18:52:48</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>7b365f7e6f524200095acd9c5d3ee449</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>cmdb_ci_web_service</table>
<target_name>Web Services</target_name>
<type>Module</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action/>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_sys_user_group_u_level2</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary element="u_level2" table="sys_user_group"><active>true</active><array>false</array><attributes/><audit>false</audit><calculation/><choice/><choice_field/><choice_table/><column_label>Level 2</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_level2</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="">boolean</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>sys_user_group</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>lberthold</sys_created_by><sys_created_on>2014-09-08 15:24:18</sys_created_on><sys_id>877ff21d240b210012e7b8d269ce7d20</sys_id><sys_mod_count>3</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:09:16</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9&lt;B/</sys_code><sys_created_by>lberthold</sys_created_by><sys_created_on>2014-09-08 15:24:18</sys_created_on><sys_id>adafbd9865d3a50033f3979d4c1e915a</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Level 2</sys_name><sys_parent display_value="Group">080e7141a440110056d5b5bdb2273f2f</sys_parent><sys_path>!!(~K/!!9&lt;B/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_level2" name="sys_user_group" sys_source_table="sys_dictionary">877ff21d240b210012e7b8d269ce7d20</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_sys_user_group_u_level2</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:09:16</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>7b365f7e6f524200095acd9c5d3ee44a</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>sys_user_group</table>
<target_name>Group.Level 2</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_incident_key</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_incident_key" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_incident_key</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Incident Key</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_incident_key</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>da3d5a8c4d176100c33a943ecf043ed2</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:40</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QA/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>579a30bd6f210600095acd9c5d3ee4f6</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Incident Key</sys_name><sys_parent display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_parent><sys_path>!!3Q4/!!3QA/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_incident_key" name="u_pagerduty" sys_source_table="sys_dictionary">da3d5a8c4d176100c33a943ecf043ed2</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_incident_key</sys_update_name><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:40</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>7b365f7e6f524200095acd9c5d3ee44b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Incident Key</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_updated_by_name</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_updated_by_name" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_updated_by_name</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Updated By Name</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_updated_by_name</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:25</sys_created_on><sys_id>95303f57fda36100c33aa767053a353a</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:25</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QJ/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:25</sys_created_on><sys_id>c48700606f428600095acd9c5d3ee4c3</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Updated By Name</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3QJ/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_updated_by_name" name="u_pagerduty" sys_source_table="sys_dictionary">95303f57fda36100c33aa767053a353a</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_updated_by_name</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:25</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>7b365f7e6f524200095acd9c5d3ee44c</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Updated By Name</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_public_ef3730e86f387100e4cd8e112e3ee496</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_public"><sys_public action="INSERT_OR_UPDATE"><active>true</active><page>pagerduty2sn</page><sys_created_by>admin</sys_created_by><sys_created_on>2014-12-01 21:23:42</sys_created_on><sys_id>ef3730e86f387100e4cd8e112e3ee496</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>admin</sys_updated_by><sys_updated_on>2014-12-01 21:23:42</sys_updated_on></sys_public><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!4@P/</sys_code><sys_created_by>admin</sys_created_by><sys_created_on>2014-12-01 21:23:42</sys_created_on><sys_id>664730e86f387100e4cd8e112e3ee498</sys_id><sys_mod_count>1</sys_mod_count><sys_name>pagerduty2sn</sys_name><sys_parent/><sys_path>!!4@P/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>ef3730e86f387100e4cd8e112e3ee496</sys_source_id><sys_source_table>sys_public</sys_source_table><sys_type/><sys_update_name>sys_public_ef3730e86f387100e4cd8e112e3ee496</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2014-12-01 21:23:42</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>7b365f7e6f524200095acd9c5d3ee44d</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>pagerduty2sn</target_name>
<type>Public Pages</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_parameters_a5f063ec4d9b6100c33a943ecf043e3d</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn_parameters"><sys_rest_message_fn_parameters action="INSERT_OR_UPDATE"><name>feature</name><rest_message_function display_value="get">a3e06fac4d9b6100c33a943ecf043ed0</rest_message_function><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:10:59</sys_created_on><sys_id>a5f063ec4d9b6100c33a943ecf043e3d</sys_id><sys_mod_count>8</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:19:13</sys_updated_on><type>string</type><value/></sys_rest_message_fn_parameters><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9L~/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:10:59</sys_created_on><sys_id>360f12c3656b254033f3979d4c1e916c</sys_id><sys_mod_count>0</sys_mod_count><sys_name>feature</sys_name><sys_parent display_value="get">220f12c3656b254033f3979d4c1e9117</sys_parent><sys_path>!!9LQ/!!9LT/!!9L~/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>a5f063ec4d9b6100c33a943ecf043e3d</sys_source_id><sys_source_table>sys_rest_message_fn_parameters</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_parameters_a5f063ec4d9b6100c33a943ecf043e3d</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:19:13</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>7b365f7e6f524200095acd9c5d3ee44e</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>feature</target_name>
<type>REST Message Function Parameters</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category>customer</category>
<comments/>
<name>sys_transform_map_25d55a4c4d176100c33a943ecf043e78</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_transform_map"&gt;&lt;sys_transform_map action="INSERT_OR_UPDATE"&gt;&lt;active&gt;true&lt;/active&gt;&lt;copy_empty_fields&gt;false&lt;/copy_empty_fields&gt;&lt;enforce_mandatory_fields&gt;No&lt;/enforce_mandatory_fields&gt;&lt;name&gt;PagerDuty&lt;/name&gt;&lt;order&gt;100&lt;/order&gt;&lt;run_business_rules&gt;true&lt;/run_business_rules&gt;&lt;run_script&gt;true&lt;/run_script&gt;&lt;script&gt;&lt;![CDATA[var debug = true;

/***********************************************************************************************
Event: incident.trigger
Add work note re: trigger + URL, save Incident Id
Event: incident.acknowledge ==&gt; Update Assigned To on SN incident
Add work note, set Assigned to
Event: incident.unacknowledge -- timeout
Do nothing
Event: incident.resolve ==&gt; Mark incident = Resolved, retrieve PD Note
Mark incident resolved with generic Close Note/Code, Resolved by
Event: incident.assign -- manually re-assigned to another user in different escalation chain ==&gt; Work Note
Add work note, set Assigned to
Event: incident.escalate -- reassigned (in PD sense) to another person in escalation chain ==&gt; Work Note
Add work note
Do NOT set Assigned to since user did not ack
Event: incident.delegate -- reassigned to another group/service ==&gt; Work Note
Add work note, clear Assigned to, set Assignment Group (lookup group via ???)
 *************************************************************************************************/

var note;


if (action == "insert") {
	// Do not create an incident from the PagerDuty event
	//ignore = true;
	//if (debug) log.info("Ignore incident.trigger because ServiceNow incident was not found.");
	
	if (JSUtil.nil(source.u_servicenow_group)) {
		ignore = true;
		if (debug) log.info("Ignore inserting a new row because ServiceNow group wasn't specified in the URL query.");
	}
	
	if (source.u_message_type != "incident.trigger") {
		ignore = true;
		if (debug) log.info("Ignore inserting a new row because this isn't a trigger.");
	}
	
	var pd = new PagerDuty_REST();
	
	// Required fields
	target.u_pagerduty_key = pd.getServiceKeyByID(source.u_service_id); //We must set the PagerDuty Service Key for the integration to fully work on incidents created from PagerDuty via the webhook
	target.u_pagerduty_id = source.u_id;
	
	// Some fields that make sense to set
	target.assignment_group.setDisplayValue(source.u_servicenow_group);
	target.category = "request";
	target.short_description = "PagerDuty incident #" + Math.round(source.u_number) + " was opened on " + source.u_service_name;
	target.work_notes = "PagerDuty: URL: " + source.u_url + "; Assigning to group; " + source.u_servicenow_group;
	target.impact = 1;
	target.urgency = 1;
	target.priority = 1;
	
} else {
	if (source.u_message_type == "incident.trigger") {
		if (debug) log.info("In incident.trigger logic");
			
		// Document who currently is being notified PD incident
		note = "PagerDuty: Attempting to notify " + source.u_assigned_to_name + "\n";
		note = note + "Go to the URL to see the PagerDuty log -- " + source.u_url;
		
		// Set PagerDuty incident ID -- needed for SN re-assignments
		if (JSUtil.nil(target.u_pagerduty_id)) {
			target.u_pagerduty_id = source.u_id;
		}
		target.work_notes = note;
		
	} else if (source.u_message_type == "incident.acknowledge") {
		if (debug) log.info("In incident.acknowledge logic");
			
		note = "PagerDuty: Acknowledged by " + source.u_assigned_to_name;
		
		// Treat acknowledge as assignment
		var usr = getUser(source.u_assigned_to_user);
		if (JSUtil.notNil(usr)) {
			target.assigned_to = usr;
		} else {
			note = note + "\n\nERROR: Could not set Assigned to field -- unable to find user with email = " + source.u_assigned_to_user;
		}
		
		target.work_notes = note;
		
		
		
	} else if (source.u_message_type == "incident.unacknowledge") {
		ignore = true;
		if (debug) log.info("Ignore incident.unacknowledge -- there should not be an ACK timeout");
			
	} else if (source.u_message_type == "incident.resolve") {
		if (debug) log.info("In incident.resolve logic");
			
		if (target.state != 6 &amp;&amp; target.state != 7) {
			if (debug) log.info("Set closure fields");
				
			target.state = 6;
			target.u_close_notes = "The incident has been marked Resolved by an external system.";
			target.close_code = "solved";
			target.resolved_by = getUser(source.u_resolved_by_user);
			target.work_notes = "PagerDuty: Resolved by " + source.u_resolved_by_name;
			
			// If Assgined to is blank, set it
			if (JSUtil.nil(target.assigned_to)) {
				target.assigned_to = getUser(source.u_resolved_by_user);
			}
		} else {
			// SN incident is already resolved or closed, do not set closure fields
			target.work_notes = "PagerDuty: Ignore incident.resolve event because incident is already Resolved or Closed.";
		}
		
		// Always sever relationship between SN and PD
		target.u_pagerduty = '';
		
		
	} else if (source.u_message_type == "incident.assign") {
		if (debug) log.info("In incident.assign logic");
			
		note = "PagerDuty: Manually assigned to " + source.u_assigned_to_name;
		
		// Treat acknowledge as assignment
		var usr = getUser(source.u_assigned_to_user);
		if (JSUtil.notNil(usr)) {
			target.assigned_to = usr;
		} else {
			note = note + "\n\nERROR: Could not set Assigned to field -- unable to find user with email = " + source.u_assigned_to_user;
		}
		
		target.work_notes = note;
		
	} else if (source.u_message_type == "incident.escalate") {
		if (debug) log.info("In incident.escalate logic");
			
		// Document who currently is being notified PD incident
		target.work_notes = "PagerDuty: Escalated within the specified policy -- attempting to notify " + source.u_assigned_to_name;
		
	} else if (source.u_message_type == "incident.delegate") {
		if (debug) log.info("In incident.delegate logic");
			
		note = "PagerDuty: Delegated to " + source.u_escalation_policy + " -- attempting to notify  " + source.u_assigned_to_name;
		
		// Delegated to another group
		// Clear out Assigned to field
		target.assigned_to = '';
		
		// Get new group
		var grp = getGroup(source.u_escalation_policy_id);
		if (JSUtil.notNil(grp)) {
			target.assignment_group = grp;
		} else {
			note = note + "\n\nERROR: Could not set Assignment Group field -- unable to find group with escalation polciy = " + source.u_escalation_policy_id;
		}
		
		target.work_notes = note;
		
		
	}
}
	
	function getUser(email) {
		// Get user sys_id given email address
		
		var usr = new GlideRecord('sys_user');
		usr.addQuery('email', email);
		usr.query();
		if (usr.next()) {
			return usr.sys_id.toString();
		}  else {
			log.warn('Unable to find user that matched email=' + email,'Map:PagerDuty');
		}
		
	}
	
	function getGroup(policy) {
		// Get group sys_id given policy id
		
		var grp = new GlideRecord('sys_user_group');
		grp.addQuery('u_pagerduty_policy', policy);
		grp.query();
		if (grp.next()) {
			return grp.sys_id.toString();
		} else {
			log.warn('Unable to find Level 2 group that matched escalation policy id=' + policy,'Map:PagerDuty');
		}
	}]]&gt;&lt;/script&gt;&lt;source_table&gt;u_pagerduty&lt;/source_table&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-17 01:25:54&lt;/sys_created_on&gt;&lt;sys_id&gt;25d55a4c4d176100c33a943ecf043e78&lt;/sys_id&gt;&lt;sys_mod_count&gt;47&lt;/sys_mod_count&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-09-08 18:17:09&lt;/sys_updated_on&gt;&lt;target_table&gt;incident&lt;/target_table&gt;&lt;/sys_transform_map&gt;&lt;sys_app_file action="INSERT_OR_UPDATE"&gt;&lt;customer_update&gt;true&lt;/customer_update&gt;&lt;publish_override/&gt;&lt;replace_on_upgrade&gt;false&lt;/replace_on_upgrade&gt;&lt;restore/&gt;&lt;sys_app/&gt;&lt;sys_code&gt;!!3O|/&lt;/sys_code&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-17 01:25:54&lt;/sys_created_on&gt;&lt;sys_id&gt;c52ccf3e6f524200095acd9c5d3ee414&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;PagerDuty&lt;/sys_name&gt;&lt;sys_parent/&gt;&lt;sys_path&gt;!!3O|/&lt;/sys_path&gt;&lt;sys_policy/&gt;&lt;sys_source_deleted&gt;false&lt;/sys_source_deleted&gt;&lt;sys_source_id&gt;25d55a4c4d176100c33a943ecf043e78&lt;/sys_source_id&gt;&lt;sys_source_table&gt;sys_transform_map&lt;/sys_source_table&gt;&lt;sys_type/&gt;&lt;sys_update_name&gt;sys_transform_map_25d55a4c4d176100c33a943ecf043e78&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-09-08 18:17:09&lt;/sys_updated_on&gt;&lt;/sys_app_file&gt;&lt;/record_update&gt;</payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>7b36df7e6f524200095acd9c5d3ee4a4</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>PagerDuty</target_name>
<type>Table Transform Map</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_app_module_99f158106fce4600095acd9c5d3ee409</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_app_module"><sys_app_module action="INSERT_OR_UPDATE"><active>true</active><application display_value="PagerDuty">cf52bc159964310012e7cc52061584d2</application><assessment/><content_page/><device_type/><filter/><hint/><homepage/><image/><link_type>SEPARATOR</link_type><map_page/><mobile_title>Support</mobile_title><mobile_view_name>Mobile</mobile_view_name><name/><order>600</order><query/><report/><roles/><survey/><survey_overwrite>true</survey_overwrite><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-18 23:32:01</sys_created_on><sys_domain>global</sys_domain><sys_id>99f158106fce4600095acd9c5d3ee409</sys_id><sys_mod_count>1</sys_mod_count><sys_overrides/><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-18 23:32:39</sys_updated_on><timeline_page/><title>Support</title><uncancelable>false</uncancelable><view_name/><window_name/></sys_app_module><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3R`/</sys_code><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-18 23:32:01</sys_created_on><sys_id>190254106fce4600095acd9c5d3ee4cb</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Support</sys_name><sys_parent/><sys_path>!!3R`/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>99f158106fce4600095acd9c5d3ee409</sys_source_id><sys_source_table>sys_app_module</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_app_module_99f158106fce4600095acd9c5d3ee409</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-18 23:32:39</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>7f365f7e6f524200095acd9c5d3ee449</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table/>
<target_name>Support</target_name>
<type>Module</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_null</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="" table="u_pagerduty"><active>true</active><array>false</array><attributes/><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label/><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element/><element_reference>false</element_reference><foreign_database/><internal_type display_value="Collection">collection</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:25:38</sys_created_on><sys_id>59d51a4c4d176100c33a943ecf043e7a</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:45:08</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QR/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:25:38</sys_created_on><sys_id>1d8700606f428600095acd9c5d3ee4f3</sys_id><sys_mod_count>0</sys_mod_count><sys_name>u_pagerduty</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3QR/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="NULL" name="u_pagerduty" sys_source_table="sys_dictionary">59d51a4c4d176100c33a943ecf043e7a</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_null</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-09-17 01:25:38</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>7f365f7e6f524200095acd9c5d3ee44a</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_number</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_number" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_number</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Number</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_number</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:25</sys_created_on><sys_id>1d303f57fda36100c33aa767053a353b</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:25</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QC/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:25</sys_created_on><sys_id>6f9a30bd6f210600095acd9c5d3ee4f9</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Number</sys_name><sys_parent display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_parent><sys_path>!!3Q4/!!3QC/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_number" name="u_pagerduty" sys_source_table="sys_dictionary">1d303f57fda36100c33aa767053a353b</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_number</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:25</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>7f365f7e6f524200095acd9c5d3ee44b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Number</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_url</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_url" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_url</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Url</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_url</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>100</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 19:26:54</sys_created_on><sys_id>ba40e7d3fda36100c33aa767053a3579</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 19:26:54</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QI/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 19:26:54</sys_created_on><sys_id>779a70bd6f210600095acd9c5d3ee404</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Url</sys_name><sys_parent display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_parent><sys_path>!!3Q4/!!3QI/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_url" name="u_pagerduty" sys_source_table="sys_dictionary">ba40e7d3fda36100c33aa767053a3579</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_url</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 19:26:54</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>7f365f7e6f524200095acd9c5d3ee44c</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Url</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_a3e06fac4d9b6100c33a943ecf043ed0</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn"><sys_rest_message_fn action="INSERT_OR_UPDATE"><basic_auth_password/><basic_auth_user/><content/><function_name>get</function_name><lock>false</lock><rest_endpoint>https://${instance}.pagerduty.com/api/v1/${feature}</rest_endpoint><rest_message display_value="PagerDuty_REST_API">f7906fac4d9b6100c33a943ecf043eb0</rest_message><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:10:42</sys_created_on><sys_id>a3e06fac4d9b6100c33a943ecf043ed0</sys_id><sys_mod_count>1</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:20:40</sys_updated_on><use_basic_auth>false</use_basic_auth><use_mid_server/></sys_rest_message_fn><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9LT/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:10:42</sys_created_on><sys_id>220f12c3656b254033f3979d4c1e9117</sys_id><sys_mod_count>0</sys_mod_count><sys_name>get</sys_name><sys_parent display_value="PagerDuty_REST_API">ea0f12c3656b254033f3979d4c1e9114</sys_parent><sys_path>!!9LQ/!!9LT/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>a3e06fac4d9b6100c33a943ecf043ed0</sys_source_id><sys_source_table>sys_rest_message_fn</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_a3e06fac4d9b6100c33a943ecf043ed0</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:20:40</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>7f365f7e6f524200095acd9c5d3ee44d</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>get</target_name>
<type>REST Message Function</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_parameters_e85263ec4d9b6100c33a943ecf043ee5</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn_parameters"><sys_rest_message_fn_parameters action="INSERT_OR_UPDATE"><name>feature</name><rest_message_function display_value="put">a3e06fac4d9b6100c33a943ecf043ed1</rest_message_function><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:17:57</sys_created_on><sys_id>e85263ec4d9b6100c33a943ecf043ee5</sys_id><sys_mod_count>4</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:25:44</sys_updated_on><type>string</type><value/></sys_rest_message_fn_parameters><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9M&amp;/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:17:57</sys_created_on><sys_id>3a0f12c3656b254033f3979d4c1e916f</sys_id><sys_mod_count>0</sys_mod_count><sys_name>feature</sys_name><sys_parent display_value="put">6e0f12c3656b254033f3979d4c1e9117</sys_parent><sys_path>!!9LQ/!!9LU/!!9M&amp;/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>e85263ec4d9b6100c33a943ecf043ee5</sys_source_id><sys_source_table>sys_rest_message_fn_parameters</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_parameters_e85263ec4d9b6100c33a943ecf043ee5</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:25:44</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>7f36df7e6f524200095acd9c5d3ee4a3</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>feature</target_name>
<type>REST Message Function Parameters</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_ui_section_bf1d96e3c0a801640190725e63f8ac80</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_ui_section section_id="bf1d96e3c0a801640190725e63f8ac80" sys_domain="global" table="incident" version="2"><sys_ui_element action="INSERT_OR_UPDATE"><element>number</element><position>0</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>878210a06f428600095acd9c5d3ee43b</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>caller_id</element><position>1</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>c78210a06f428600095acd9c5d3ee43b</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>location</element><position>2</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>0b8210a06f428600095acd9c5d3ee43b</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>category</element><position>3</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>4b8210a06f428600095acd9c5d3ee43b</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>subcategory</element><position>4</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>8b8210a06f428600095acd9c5d3ee43b</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>cmdb_ci</element><position>5</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>cb8210a06f428600095acd9c5d3ee43b</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>impact</element><position>6</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>0f8210a06f428600095acd9c5d3ee43b</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>urgency</element><position>7</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>4f8210a06f428600095acd9c5d3ee43b</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>priority</element><position>8</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>8f8210a06f428600095acd9c5d3ee43b</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>.split</element><position>9</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>cf8210a06f428600095acd9c5d3ee43b</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type>.split</type></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>opened_at</element><position>10</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>038210a06f428600095acd9c5d3ee43c</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>opened_by</element><position>11</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>438210a06f428600095acd9c5d3ee43c</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>contact_type</element><position>12</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>838210a06f428600095acd9c5d3ee43c</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>state</element><position>13</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>c38210a06f428600095acd9c5d3ee43c</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>assignment_group</element><position>14</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>078210a06f428600095acd9c5d3ee43c</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>assigned_to</element><position>15</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>478210a06f428600095acd9c5d3ee43c</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>.end_split</element><position>16</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>878210a06f428600095acd9c5d3ee43c</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type>.end_split</type></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>short_description</element><position>17</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>c78210a06f428600095acd9c5d3ee43c</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>com.glideapp.questionset.DefaultQuestionEditor</element><position>18</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>0b8210a06f428600095acd9c5d3ee43c</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter display_value="Incident Variable Editor">710bb6ba0a0a0b0100ba712aa4b9f048</sys_ui_formatter><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type>component</type></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>u_pagerduty</element><position>19</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>4b8210a06f428600095acd9c5d3ee43c</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>u_pagerduty_id</element><position>20</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:12:48</sys_created_on><sys_id>8b8210a06f428600095acd9c5d3ee43c</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>u_pagerduty_key</element><position>21</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-19 18:52:37</sys_created_on><sys_id>5eabdca06f428600095acd9c5d3ee4ba</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">bf1d96e3c0a801640190725e63f8ac80</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:52:37</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_section action="INSERT_OR_UPDATE"><caption/><header>false</header><name>incident</name><roles/><sys_created_by>fred.luddy</sys_created_by><sys_created_on>2004-07-14 19:25:13</sys_created_on><sys_domain>global</sys_domain><sys_id>bf1d96e3c0a801640190725e63f8ac80</sys_id><sys_mod_count>0</sys_mod_count><sys_overrides/><sys_updated_by>system_bootstrap</sys_updated_by><sys_updated_on>2004-12-13 18:05:34</sys_updated_on><sys_user/><title>true</title><view display_value="Default view" name="NULL">Default view</view><view_name/></sys_ui_section></sys_ui_section><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app display_value="System (apps/system_ui)">1ad7a8106f028600095acd9c5d3ee40d</sys_app><sys_code>!!$2)/</sys_code><sys_created_by>fred.luddy</sys_created_by><sys_created_on>2004-07-14 19:25:13</sys_created_on><sys_id>621c5cd06fce4600095acd9c5d3ee4e7</sys_id><sys_mod_count>1</sys_mod_count><sys_name>incident</sys_name><sys_parent display_value="Incident">b73cdcd06fce4600095acd9c5d3ee4f2</sys_parent><sys_path>!!$A./!!$2)/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>bf1d96e3c0a801640190725e63f8ac80</sys_source_id><sys_source_table>sys_ui_section</sys_source_table><sys_type/><sys_update_name>sys_ui_section_bf1d96e3c0a801640190725e63f8ac80</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-19 18:12:48</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>7f36df7e6f524200095acd9c5d3ee4a4</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>incident</table>
<target_name>Incident</target_name>
<type>Form Layout</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_app_module_ff1e78d59964310012e7cc5206158466</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_app_module"><sys_app_module action="INSERT_OR_UPDATE"><active>true</active><application display_value="Integration - PagerDuy">cf52bc159964310012e7cc52061584d2</application><assessment/><content_page/><device_type/><filter table="syslog">sourceLIKEPagerDuty^EQ<item endquery="false" field="source" goto="false" newquery="false" operator="LIKE" or="false" value="PagerDuty"/><item endquery="true" field="" goto="false" newquery="false" operator="" or="false" value=""/></filter><hint/><homepage/><image/><link_type>LIST</link_type><map_page/><mobile_title>Output Log</mobile_title><mobile_view_name>Mobile</mobile_view_name><name>syslog</name><order>510</order><query/><report/><roles/><survey/><survey_overwrite>true</survey_overwrite><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 19:33:58</sys_created_on><sys_domain>global</sys_domain><sys_id>ff1e78d59964310012e7cc5206158466</sys_id><sys_mod_count>1</sys_mod_count><sys_overrides/><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:34:03</sys_updated_on><timeline_page/><title>Output Log</title><uncancelable>false</uncancelable><view_name/><window_name/></sys_app_module><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!:*!/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 19:33:58</sys_created_on><sys_id>fd4efc959964310012e7cc5206158471</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Output Log</sys_name><sys_parent/><sys_path>!!:*!/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>ff1e78d59964310012e7cc5206158466</sys_source_id><sys_source_table>sys_app_module</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_app_module_ff1e78d59964310012e7cc5206158466</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:34:03</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>b3365f7e6f524200095acd9c5d3ee44a</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>syslog</table>
<target_name>Output Log</target_name>
<type>Module</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_escalation_policy</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_escalation_policy" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_escalation_policy</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Escalation Policy</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_escalation_policy</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 21:08:38</sys_created_on><sys_id>0d977f97fda36100c33aa767053a3511</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 21:08:38</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3Q?/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 21:08:38</sys_created_on><sys_id>d37700606f428600095acd9c5d3ee4b0</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Escalation Policy</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3Q?/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_escalation_policy" name="u_pagerduty" sys_source_table="sys_dictionary">0d977f97fda36100c33aa767053a3511</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_escalation_policy</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 21:08:38</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>b3365f7e6f524200095acd9c5d3ee44b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Escalation Policy</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_servicenow_group</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_servicenow_group" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_servicenow_group</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>ServiceNow Group</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_servicenow_group</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>100</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2015-07-31 17:31:01</sys_created_on><sys_id>c4b1c9bd6f210600095acd9c5d3ee444</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-07-31 17:31:01</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3RM/</sys_code><sys_created_by>admin</sys_created_by><sys_created_on>2015-07-29 22:19:47</sys_created_on><sys_id>c8b1c9bd6f210600095acd9c5d3ee444</sys_id><sys_mod_count>0</sys_mod_count><sys_name>ServiceNow Group</sys_name><sys_parent display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_parent><sys_path>!!3Q4/!!3RM/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_servicenow_group" name="u_pagerduty" sys_source_table="sys_dictionary">c4b1c9bd6f210600095acd9c5d3ee444</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_servicenow_group</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-07-31 17:31:01</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>b3365f7e6f524200095acd9c5d3ee44c</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.ServiceNow Group</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_documentation_sys_user_group_u_level2_en</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_documentation element="u_level2" label="Level 2" language="en" table="sys_user_group"><sys_documentation action="INSERT_OR_UPDATE"><element>u_level2</element><help/><hint>Group provides escalated (Level 2) support services</hint><label>Level 2</label><language>en</language><name>sys_user_group</name><plural>Level 2s</plural><sys_created_by>lberthold</sys_created_by><sys_created_on>2014-09-08 15:24:18</sys_created_on><sys_id>b5afbd9865d3a50033f3979d4c1e915c</sys_id><sys_mod_count>2</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:07:29</sys_updated_on><url/><url_target/></sys_documentation></sys_documentation><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9&lt;C/</sys_code><sys_created_by>lberthold</sys_created_by><sys_created_on>2014-09-08 15:24:18</sys_created_on><sys_id>f9afbd9865d3a50033f3979d4c1e915c</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Level 2</sys_name><sys_parent display_value="Level 2">adafbd9865d3a50033f3979d4c1e915a</sys_parent><sys_path>!!(~K/!!9&lt;B/!!9&lt;C/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_level2" language="en" name="sys_user_group" sys_source_table="sys_documentation">b5afbd9865d3a50033f3979d4c1e915c</sys_source_id><sys_source_table>sys_documentation</sys_source_table><sys_type/><sys_update_name>sys_documentation_sys_user_group_u_level2_en</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:07:29</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>b3365f7e6f524200095acd9c5d3ee44d</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>sys_user_group</table>
<target_name>Group.Level 2</target_name>
<type>Field Label</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_headers_463b2f604ddb6100c33a943ecf043e05</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn_headers"><sys_rest_message_fn_headers action="INSERT_OR_UPDATE"><name>Content-Type</name><rest_message_function display_value="put">a3e06fac4d9b6100c33a943ecf043ed1</rest_message_function><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:56:15</sys_created_on><sys_id>463b2f604ddb6100c33a943ecf043e05</sys_id><sys_mod_count>2</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:11:34</sys_updated_on><value>application/json</value></sys_rest_message_fn_headers><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9L^/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:56:15</sys_created_on><sys_id>6a0f12c3656b254033f3979d4c1e911d</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Content-Type</sys_name><sys_parent display_value="put">6e0f12c3656b254033f3979d4c1e9117</sys_parent><sys_path>!!9LQ/!!9LU/!!9L^/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>463b2f604ddb6100c33a943ecf043e05</sys_source_id><sys_source_table>sys_rest_message_fn_headers</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_headers_463b2f604ddb6100c33a943ecf043e05</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:11:34</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>b3365f7e6f524200095acd9c5d3ee44e</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>Content-Type</target_name>
<type>REST Message Function Headers</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category>customer</category>
<comments/>
<name>sys_script_cb4e60d04d976100c33a943ecf043e06</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update sys_domain="global" table="sys_script"&gt;&lt;sys_script action="INSERT_OR_UPDATE"&gt;&lt;abort_action&gt;false&lt;/abort_action&gt;&lt;action_delete&gt;false&lt;/action_delete&gt;&lt;action_insert&gt;true&lt;/action_insert&gt;&lt;action_query&gt;false&lt;/action_query&gt;&lt;action_update&gt;true&lt;/action_update&gt;&lt;active&gt;true&lt;/active&gt;&lt;add_message&gt;false&lt;/add_message&gt;&lt;advanced&gt;true&lt;/advanced&gt;&lt;client_callable&gt;false&lt;/client_callable&gt;&lt;collection&gt;incident&lt;/collection&gt;&lt;condition/&gt;&lt;description/&gt;&lt;filter_condition table="incident"&gt;u_pagerdutyISNOTEMPTY^stateCHANGESTO6^ORstateCHANGESTO7^NQu_pagerdutyISNOTEMPTY^state=^EQ&lt;item endquery="false" field="u_pagerduty" goto="false" newquery="false" operator="ISNOTEMPTY" or="false" value=""/&gt;&lt;item endquery="false" field="state" goto="false" newquery="false" operator="CHANGESTO" or="false" value="6"/&gt;&lt;item endquery="false" field="state" goto="false" newquery="false" operator="CHANGESTO" or="true" value="7"/&gt;&lt;item endquery="false" field="u_pagerduty" goto="false" newquery="true" operator="ISNOTEMPTY" or="false" value=""/&gt;&lt;item endquery="false" field="state" goto="false" newquery="false" operator="=" or="false" value=""/&gt;&lt;item endquery="true" field="" goto="false" newquery="false" operator="" or="false" value=""/&gt;&lt;/filter_condition&gt;&lt;message/&gt;&lt;name&gt;Resolve PagerDuty Incident&lt;/name&gt;&lt;order&gt;100&lt;/order&gt;&lt;priority&gt;100&lt;/priority&gt;&lt;role_conditions/&gt;&lt;script&gt;&lt;![CDATA[// ServiceNow incident escalation complete -- resolve PagerDuty incident
var debug = true;
if (debug) gs.log("Entered", "BR:Resolve PagerDuty Incident");

var pd = new PagerDuty_REST();

// Lookup service key
var key = current.assignment_group.u_pagerduty_service.toString();

if (JSUtil.notNil(current.u_pagerduty_key)) {
	key = current.u_pagerduty_key.toString(); // If there is a key set for the incident, use it.
}

// Construct JSON object
var newstate;
if (JSUtil.nil(current.u_substate)) {
	newstate = current.state.getDisplayValue();
} else {
	newstate = current.state.getDisplayValue() + "/" + current.u_substate.getDisplayValue();
}
var body = "This incident was moved to " + newstate + " by " + current.sys_updated_by + ". Closing PagerDuty incident (if incident is re-opened, a new PD alert will be created).";
var details = {AssignmentGroup: current.assignment_group.name.toString(),
			   ResolvedByUser: current.resolved_by.name.toString(),
			   Code: current.close_code.getDisplayValue(),
			   Note: current.close_notes.toString()};
if (debug) JSUtil.logObject(details, "BR:Resolve PagerDuty Incident");

//if (debug) JSUtil.logObject(details, "BR:Resolve PagerDuty Incident");

// Create PD incident
var resp_message = pd.resolveIncident(key, current.u_pagerduty.toString(), body, details);

if (!pd.hasError) {
	if (debug) gs.log("resp_message=" + resp_message, "BR:Resolve PagerDuty Incident");
	// Success: Clear PagerDuty field
	current.u_pagerduty = '';
	
} else {
	gs.addErrorMessage("PagerDuty integration error -- " + pd.errMsg + ". Re-escalate or contact the ServiceNow system administrators.");
	gs.logError("PagerDuty integration failed: incident=" + current.number + ", key=" + key, "BR:Trigger PagerDuty Incident");
	current.work_notes = "PagerDuty integration error -- " + pd.errMsg + ". Re-escalate or contact the ServiceNow system administrators.";
}

if (debug) gs.log("Exiting", "BR:Resolve PagerDuty Incident");]]&gt;&lt;/script&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-17 12:31:45&lt;/sys_created_on&gt;&lt;sys_domain&gt;global&lt;/sys_domain&gt;&lt;sys_id&gt;cb4e60d04d976100c33a943ecf043e06&lt;/sys_id&gt;&lt;sys_mod_count&gt;19&lt;/sys_mod_count&gt;&lt;sys_overrides/&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-09-08 18:20:26&lt;/sys_updated_on&gt;&lt;template/&gt;&lt;when&gt;before&lt;/when&gt;&lt;/sys_script&gt;&lt;sys_app_file action="INSERT_OR_UPDATE"&gt;&lt;customer_update&gt;true&lt;/customer_update&gt;&lt;publish_override/&gt;&lt;replace_on_upgrade&gt;false&lt;/replace_on_upgrade&gt;&lt;restore/&gt;&lt;sys_app/&gt;&lt;sys_code&gt;!!3O]/&lt;/sys_code&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-17 12:31:45&lt;/sys_created_on&gt;&lt;sys_id&gt;342ccf3e6f524200095acd9c5d3ee410&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;Resolve PagerDuty Incident&lt;/sys_name&gt;&lt;sys_parent display_value="Incident"&gt;d9b3f3616f1e0200095acd9c5d3ee443&lt;/sys_parent&gt;&lt;sys_path&gt;!!$&amp;amp;[/!!3O]/&lt;/sys_path&gt;&lt;sys_policy/&gt;&lt;sys_source_deleted&gt;false&lt;/sys_source_deleted&gt;&lt;sys_source_id&gt;cb4e60d04d976100c33a943ecf043e06&lt;/sys_source_id&gt;&lt;sys_source_table&gt;sys_script&lt;/sys_source_table&gt;&lt;sys_type&gt;code&lt;/sys_type&gt;&lt;sys_update_name&gt;sys_script_cb4e60d04d976100c33a943ecf043e06&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-09-08 18:20:26&lt;/sys_updated_on&gt;&lt;/sys_app_file&gt;&lt;/record_update&gt;</payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>b336df7e6f524200095acd9c5d3ee4a4</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>incident</table>
<target_name>Resolve PagerDuty Incident</target_name>
<type>Business Rule</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_app_module_27e374559964310012e7cc520615849b</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_app_module"><sys_app_module action="INSERT_OR_UPDATE"><active>true</active><application display_value="Integration - PagerDuy">cf52bc159964310012e7cc52061584d2</application><assessment/><content_page/><device_type/><filter table="sys_rest_message">nameLIKEPagerDuty^EQ<item endquery="false" field="name" goto="false" newquery="false" operator="LIKE" or="false" value="PagerDuty"/><item endquery="true" field="" goto="false" newquery="false" operator="" or="false" value=""/></filter><hint/><homepage/><image/><link_type>LIST</link_type><map_page/><mobile_title>REST Messages</mobile_title><mobile_view_name>Mobile</mobile_view_name><name>sys_rest_message</name><order>130</order><query/><report/><roles/><survey/><survey_overwrite>true</survey_overwrite><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 18:49:42</sys_created_on><sys_domain>global</sys_domain><sys_id>27e374559964310012e7cc520615849b</sys_id><sys_mod_count>2</sys_mod_count><sys_overrides/><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:31:16</sys_updated_on><timeline_page/><title>REST Messages</title><uncancelable>false</uncancelable><view_name/><window_name/></sys_app_module><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!:)`/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 18:49:42</sys_created_on><sys_id>1d2474559964310012e7cc52061584e1</sys_id><sys_mod_count>0</sys_mod_count><sys_name>REST Messages</sys_name><sys_parent/><sys_path>!!:)`/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>27e374559964310012e7cc520615849b</sys_source_id><sys_source_table>sys_app_module</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_app_module_27e374559964310012e7cc520615849b</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:31:16</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>b7365f7e6f524200095acd9c5d3ee449</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>sys_rest_message</table>
<target_name>REST Messages</target_name>
<type>Module</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action/>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_incident_u_pagerduty</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary element="u_pagerduty" table="incident"><active>true</active><array>false</array><attributes/><audit>false</audit><calculation/><choice/><choice_field/><choice_table/><column_label>PagerDuty</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_pagerduty</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>incident</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-16 22:02:14</sys_created_on><sys_id>964765cc2457a10012e7b8d269ce7d83</sys_id><sys_mod_count>2</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:08:09</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9L5/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-16 22:02:14</sys_created_on><sys_id>dfee9e83656b254033f3979d4c1e91e3</sys_id><sys_mod_count>0</sys_mod_count><sys_name>PagerDuty</sys_name><sys_parent display_value="Incident">42fdf901a440110056d5b5bdb2273fa2</sys_parent><sys_path>!!(WU/!!9L5/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_pagerduty" name="incident" sys_source_table="sys_dictionary">964765cc2457a10012e7b8d269ce7d83</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_incident_u_pagerduty</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:08:09</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>b7365f7e6f524200095acd9c5d3ee44a</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>incident</table>
<target_name>Incident.PagerDuty</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_id</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_id" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_id</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Id</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_id</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:26</sys_created_on><sys_id>2d303f57fda36100c33aa767053a3540</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:26</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3Q@/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:26</sys_created_on><sys_id>5b9a30bd6f210600095acd9c5d3ee4f4</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Id</sys_name><sys_parent display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_parent><sys_path>!!3Q4/!!3Q@/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_id" name="u_pagerduty" sys_source_table="sys_dictionary">2d303f57fda36100c33aa767053a3540</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_id</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:26</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>b7365f7e6f524200095acd9c5d3ee44b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Id</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_service_name</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_service_name" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_service_name</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Service Name</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_service_name</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2015-07-31 17:31:00</sys_created_on><sys_id>ea8289bd6f210600095acd9c5d3ee460</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-07-31 17:31:00</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3RO/</sys_code><sys_created_by>admin</sys_created_by><sys_created_on>2015-07-29 22:23:30</sys_created_on><sys_id>ee8289bd6f210600095acd9c5d3ee460</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Service Name</sys_name><sys_parent display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_parent><sys_path>!!3Q4/!!3RO/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_service_name" name="u_pagerduty" sys_source_table="sys_dictionary">ea8289bd6f210600095acd9c5d3ee460</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_service_name</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-07-31 17:31:00</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>b7365f7e6f524200095acd9c5d3ee44c</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Service Name</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_processor_5c994695240b210012e7b8d269ce7dc6</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_processor"&gt;&lt;sys_processor action="INSERT_OR_UPDATE"&gt;&lt;active&gt;true&lt;/active&gt;&lt;class_name/&gt;&lt;description&gt;Inbound processor that can consume PagerDuty webhook payload.  Writes message data to the PagerDuty inbound web service.&amp;#13;
&amp;#13;
Webhook API: http://developer.pagerduty.com/documentation/rest/webhooks&lt;/description&gt;&lt;name&gt;Inbound PagerDuty Processor&lt;/name&gt;&lt;parameters/&gt;&lt;path&gt;pagerduty2sn&lt;/path&gt;&lt;roles/&gt;&lt;script&gt;&lt;![CDATA[/*
 * We could create logic around what to do if this request is
 * a GET, PUT, POST, or DELETE request.  To get that HTTP Method,
 * we use the getMethod() function on the request.
 * In this example, we just log it to a string variable.ssss
 */
var debug = true;
if (debug) gs.log("Entered Inbound PagerDuty Processor", "Processor:Inbound PagerDuty");
    
// Need array functions later
var arrayUtil = new ArrayUtil();
// List of webhook message types handled -- currently ALL types handled
var EVENTS = ["incident.trigger", "incident.acknowledge", "incident.unacknowledge", "incident.resolve", "incident.assign", "incident.escalate", "incident.delegate"];


var methodMsg = "Method string: "+g_request.getMethod()+"\n";

/*
 * We could iterate through all of the headers to make
 * intelligent decisions about how to handle this request,
 * but in this example, we will just write each header
 * and its value to a logging string
 */
var headerList = g_request.getHeaderNames();
var headerMsg = ""; //we're going to log header info here
while(headerList.hasMoreElements()){
    var header = headerList.nextElement();
    var value = g_request.getHeader(header);
    headerMsg += ("Header: ["+header+"] has a value of: "+value+"\n");
}

/*
 * We could iterate through all of the URL parameters to make
 * intelligent decisions about how to handle this request,
 * but in this example, we will just write each URL parameter
 * and its value to a logging string
 */
var urlParamList = g_request.getParameterNames();
var paramMsg = ""; //we're going to log parameter info here
while(urlParamList.hasMoreElements()){
    var param = urlParamList.nextElement();
    var value = g_request.getParameter(param);
    paramMsg += ("Parameter: ["+param+"] has a value of: "+value+"\n");
}

/*
 * Now we would normally process the request given the data posted to
 * us.  However, for this example, we are going to simply build out
 * a text response that is tailored to the information given to us
 */
var returnMessage = "";
returnMessage += "We received a Request from you with the following information:\n";
returnMessage += methodMsg;
returnMessage += "\nWITH INCOMING HEADERS\n";
returnMessage += headerMsg;
returnMessage += "\nWITH URL PARAMETERS OF\n";
returnMessage += paramMsg;
returnMessage += "\n\n";

//if (debug) gs.log("OTHER DATA: " + returnMessage, "Processor: Inbound PagerDuty");
    


/*** Get payload and put into a JSON object ***/
var is = g_request.getInputStream();
var sb = GlideStringUtil.getStringFromStream(is);
if (debug) gs.log(sb, "Processor: Inbound PagerDuty");
    
var parser = new JSONParser();
var parsed = parser.parse(sb);
//if (debug) JSUtil.logObject(parsed);
    

// PagerDuty body is an array of 'messages'
if (debug) gs.log("Number of messages: " + parsed.messages.length, "Processor: Inbound PagerDuty");

// Process each message
for (var i=0; i &lt; parsed.messages.length; i++) {
// Each item in array is a JSON object
// Get message type
var message_type = parsed.messages[i].type;
if (debug) gs.log("type="+message_type,  "Processor: Inbound PagerDuty");

// PROCESS incident.acknowledge, incident.assign, incident.delegate, incident.resolve, incident.unacknowledge
// IGNORE incident.trigger
if (arrayUtil.contains(EVENTS, message_type)) {
    var pd = new GlideRecord("u_pagerduty");
    pd.initialize();

    // Which ServiceNow group did we pass along via the query string?
    pd.u_servicenow_group = g_request.getParameter("group");
	
	// PD Service Name
    pd.u_service_name = parsed.messages[i].data.incident.service.name;
	
	// Assigned To User
    if (parsed.messages[i].data.incident.assigned_to_user) {
        pd.u_assigned_to_user = parsed.messages[i].data.incident.assigned_to_user.email;
        pd.u_assigned_to_name = parsed.messages[i].data.incident.assigned_to_user.name;
    }
    
    // Incident Key
    pd.u_incident_key = parsed.messages[i].data.incident.incident_key;
    
    // Message Type
    pd.u_message_type = message_type;
    
    // Resolved By User
    if (parsed.messages[i].data.incident.resolved_by_user) {
        pd.u_resolved_by_user = parsed.messages[i].data.incident.resolved_by_user.email;
        pd.u_resolved_by_name = parsed.messages[i].data.incident.resolved_by_user.name;
    }
    
    // Status
    pd.u_status = parsed.messages[i].data.incident.status;

    // URL
    pd.u_url = parsed.messages[i].data.incident.html_url;

    // PD Incident Id (not the key, not the number)
    pd.u_id = parsed.messages[i].data.incident.id;

    // PD Incident #
    pd.u_number = parsed.messages[i].data.incident.incident_number;
    
    // Last status changed By User
    if (parsed.messages[i].data.incident.last_status_change_by) {
        pd.u_updated_by_user = parsed.messages[i].data.incident.last_status_change_by.email;
        pd.u_updated_by_name = parsed.messages[i].data.incident.last_status_change_by.name;
    }

    // Escalation policy
    if (parsed.messages[i].data.incident.escalation_policy) {
        pd.u_escalation_policy = parsed.messages[i].data.incident.escalation_policy.name;
        pd.u_escalation_policy_id = parsed.messages[i].data.incident.escalation_policy.id;
    }
    
    pd.insert();
    
} else {
    if (debug) gs.log("Skip creating u_pagerduty record", "Processor: Inbound PagerDuty");

}
    
    
}]]&gt;&lt;/script&gt;&lt;sys_created_by&gt;admin.jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-08 11:28:44&lt;/sys_created_on&gt;&lt;sys_id&gt;5c994695240b210012e7b8d269ce7dc6&lt;/sys_id&gt;&lt;sys_mod_count&gt;37&lt;/sys_mod_count&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-07-31 17:31:25&lt;/sys_updated_on&gt;&lt;type&gt;script&lt;/type&gt;&lt;/sys_processor&gt;&lt;sys_app_file action="INSERT_OR_UPDATE"&gt;&lt;customer_update&gt;true&lt;/customer_update&gt;&lt;publish_override/&gt;&lt;replace_on_upgrade&gt;false&lt;/replace_on_upgrade&gt;&lt;restore/&gt;&lt;sys_app/&gt;&lt;sys_code&gt;!!3R,/&lt;/sys_code&gt;&lt;sys_created_by&gt;admin.jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-08 11:28:44&lt;/sys_created_on&gt;&lt;sys_id&gt;8baa70bd6f210600095acd9c5d3ee480&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;Inbound PagerDuty Processor&lt;/sys_name&gt;&lt;sys_parent/&gt;&lt;sys_path&gt;!!3R,/&lt;/sys_path&gt;&lt;sys_policy/&gt;&lt;sys_source_deleted&gt;false&lt;/sys_source_deleted&gt;&lt;sys_source_id&gt;5c994695240b210012e7b8d269ce7dc6&lt;/sys_source_id&gt;&lt;sys_source_table&gt;sys_processor&lt;/sys_source_table&gt;&lt;sys_type&gt;code&lt;/sys_type&gt;&lt;sys_update_name&gt;sys_processor_5c994695240b210012e7b8d269ce7dc6&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-07-31 17:31:25&lt;/sys_updated_on&gt;&lt;/sys_app_file&gt;&lt;/record_update&gt;</payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>b7365f7e6f524200095acd9c5d3ee44d</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>Inbound PagerDuty Processor</target_name>
<type>Processor</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_parameters_3a7110bffd276100c33aa767053a35b7</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn_parameters"><sys_rest_message_fn_parameters action="INSERT_OR_UPDATE"><name>payload</name><rest_message_function display_value="put">a3e06fac4d9b6100c33a943ecf043ed1</rest_message_function><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-10 17:40:23</sys_created_on><sys_id>3a7110bffd276100c33aa767053a35b7</sys_id><sys_mod_count>5</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:26:00</sys_updated_on><type>string</type><value/></sys_rest_message_fn_parameters><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9OL/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-10 17:40:23</sys_created_on><sys_id>b40e529d65bb294033f3979d4c1e91a6</sys_id><sys_mod_count>0</sys_mod_count><sys_name>payload</sys_name><sys_parent display_value="put">6e0f12c3656b254033f3979d4c1e9117</sys_parent><sys_path>!!9LQ/!!9LU/!!9OL/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>3a7110bffd276100c33aa767053a35b7</sys_source_id><sys_source_table>sys_rest_message_fn_parameters</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_parameters_3a7110bffd276100c33aa767053a35b7</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:26:00</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>b7365f7e6f524200095acd9c5d3ee44e</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>payload</target_name>
<type>REST Message Function Parameters</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_script_include_403468884dd36100c33a943ecf043e41</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_include"&gt;&lt;sys_script_include action="INSERT_OR_UPDATE"&gt;&lt;active&gt;true&lt;/active&gt;&lt;client_callable&gt;false&lt;/client_callable&gt;&lt;description&gt;Handles outbound communication to PagerDuty. Supports both Integration API and REST API.&lt;/description&gt;&lt;name&gt;PagerDuty_REST&lt;/name&gt;&lt;script&gt;&lt;![CDATA[var PagerDuty_REST = Class.create();
PagerDuty_REST.prototype = {
    initialize: function() {
        this.debug = true;
		
		// TODO: Add system properties to hold these values
		this.authToken = '&lt;PAGERDUTY API ACCESS KEY&gt;';
		this.baseEndpoint = 'https://&lt;PAGERDUTY INSTANCE NAME&gt;.pagerduty.com/api/v1/';

        this.hasError = false;
        this.errMsg = '';
        
    },
    
    
    getServiceKey: function(group) {
        var gr = new GlideRecord('sys_user_group');
        
        if (gr.get(group)) {
            return gr.u_pagerduty_service;
        }
        
    },

    
    triggerIncident: function(key, incident_id, number, description, details) {
        // Trigger incident in PagerDuty
        
        // Get instance and construct URL to incident
        var instance = gs.getProperty('instance_name');
        var url = 'https://' + instance + '.service-now.com/nav_to.do?uri=incident.do?sys_id=' + incident_id;

        // Create POST body
        var postBody = {client_url: url,
                service_key: key,
                description: description,
                client: 'ServiceNow',
                details: details,
                event_type: 'trigger' };
        
        
        // Issue command
        var response = this.post(postBody);

        // Return PD incident key if no error
        if (!this.hasError) {
            return response.incident_key;
        } 

    },

    resolveIncident: function(key, incident_key, description, details) {
        // Resolve incident in pagerduty
        
        // Create POST body
        var postBody = {service_key: key,
                event_type: 'resolve',
                incident_key: incident_key,
                description: description,
                details: details
                };
        
         // Issue command
        var response = this.post(postBody);
        
        // Return PD incident key if no error
        if (!this.hasError) {
            return response.message;
        } 
        
    },

    assignIncident: function(incident_id, assigned_email, requestor_email) {
        // Use PagerDuty's REST API to assign

        // Get user ids from PagerDuty (from email address)
        
        var assigned_id = this.getUserIdByEmail(assigned_email);
        var requester_id = this.getUserIdByEmail(requestor_email);

        // Construct endpoint
        var feature = 'incidents/' + incident_id + '/reassign';
        if (this.debug) gs.log('feature=' + feature, 'PagerDuty.assignIncident()');


        // Contstruct payload
        var body = {requester_id: requester_id, assigned_to_user: assigned_id};
        if (this.debug) JSUtil.logObject(body);

        // Make web request
        var response = this.putREST(feature, body);


    },

    delegateIncident: function(incident_id, group_policy_id, requestor_email) {
        // Use PagerDuty's REST API to assign

        // Get user ids from PagerDuty (from email address)
        var requester_id = this.getUserIdByEmail(requestor_email);

        // Construct endpoint
        var feature = 'incidents/' + incident_id + '/reassign';
        if (this.debug) gs.log('feature=' + feature, 'PagerDuty.delegateIncident()');


        // Contstruct payload
        var body = {requester_id: requester_id, escalation_policy: group_policy_id};
        if (this.debug) JSUtil.logObject(body);

        // Make web request
        var response = this.putREST(feature, body);


    },

    getUserIdByEmail: function(email) {
        // Ask PagerDuty for user id for 

        var feature = 'users?query=' + GlideStringUtil.urlEncode(email);
        if (this.debug) gs.log('feature=' + feature, 'PagerDuty.getUserIdByEmail()');

        var usrResponse = this.getREST(feature);
        

        if (!this.hasError) {
            var id = usrResponse.users[0].id;
            return id;
        }
        
        
    },

    putREST: function(feature, bodyIn) {
        // Send web request via PagerDuty's REST API

        // Configure REST message
        var rMsg = new RESTMessage('PagerDuty_REST_API', 'put');
        rMsg.setRestEndPoint(this.baseEndpoint + feature);
        rMsg.setStringParameter('token', 'Token token=' + this.authToken);

        var json = new JSON();
        var bodyJSON = json.encode(bodyIn);
        rMsg.setXMLParameter('payload', bodyJSON);

        // Execute
        var response = rMsg.execute();

        // Inspect returned status code
        var parser = new JSONParser();
        var body = parser.parse(response.getBody());
        var status = response.getStatusCode().toString();
        if (this.debug) gs.log('status=' + status, 'PagerDuty.putREST()');

        if (status != 200) {
            this.hasError = true;
            this.errMsg = body.error.message + " (code " + body.error.code + ")";
            gs.logError(response.getBody(), 'PagerDuty.putREST()');
                            
        } else {
            if (this.debug) JSUtil.logObject(body);

            return body;

        }
        
        if (this.debug) gs.log('Exiting status=' + status, 'PagerDuty.getRest()');
    },

    getREST: function(feature) {
        // Send web request via PagerDuty's REST API

        // Configure REST message
        var rMsg = new RESTMessage('PagerDuty_REST_API', 'get');
        rMsg.setRestEndPoint(this.baseEndpoint + feature);
        rMsg.setStringParameter('token', 'Token token=' + this.authToken);
        if (this.debug) gs.log('endpoint=' + rMsg.getEndpoint(), 'PagerDuty.getREST()');
        
        // Execute
        var response = rMsg.execute();

        // Inspect returned status code
        var parser = new JSONParser();
        var body = parser.parse(response.getBody());
        var status = response.getStatusCode().toString();
        if (this.debug) gs.log('status=' + status, 'PagerDuty.getREST()');

        if (status != 200) {
            this.hasError = true;
            this.errMsg = body.error.message + " (code " + body.error.code + ")";
            gs.logError(response.getBody(), 'PagerDuty.getRest()');
                            
        } else {
            if (this.debug) JSUtil.logObject(body);

            return body;

        }
        
        if (this.debug) gs.log('Exiting status=' + status, 'PagerDuty.getRest()');


    },
    
    post: function(body) {
        // Send web request via PagerDuty's Integration API

        if (this.debug) JSUtil.logObject(body, "PagerDuty_REST.post()");

        // Convert body (javascript object) to JSON
        var json = new JSON();
        var bodyJSON = json.encode(body);
        if (this.debug) gs.log("bodyJSON=" + bodyJSON,  "PagerDuty_REST.post()");

        // Construct message
        var r = new RESTMessage('PagerDuty', 'post');
        r.setXMLParameter('payload', bodyJSON);

        // Send request
        var response = r.execute();
        
        // Process response
        var status = response.getStatusCode();
        if (this.debug) gs.log("response status=" + status, "PagerDuty_REST.post()");
            
        var parser = new JSONParser();
        if (status == 200) {
            // Get response into JSON
            var respObj = parser.parse(response.getBody());
            /** "status": "success", "message": "Event processed", "incident_key": "26c2e798824442919e204fbac35c1b8b" **/
            // Return response as a javascript object
            return respObj;
            
        } else {
            this.hasError = true;
            var errObj = parser.parse(response.getBody());
            this.errMsg = errObj.message + " [" + errObj.errors.toString() + "]";
            
        }

    },
    
    type: 'PagerDuty_REST'
};]]&gt;&lt;/script&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-16 17:09:16&lt;/sys_created_on&gt;&lt;sys_id&gt;403468884dd36100c33a943ecf043e41&lt;/sys_id&gt;&lt;sys_mod_count&gt;87&lt;/sys_mod_count&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2014-12-01 21:53:29&lt;/sys_updated_on&gt;&lt;/sys_script_include&gt;&lt;sys_app_file action="INSERT_OR_UPDATE"&gt;&lt;customer_update&gt;true&lt;/customer_update&gt;&lt;publish_override/&gt;&lt;replace_on_upgrade&gt;false&lt;/replace_on_upgrade&gt;&lt;restore/&gt;&lt;sys_app/&gt;&lt;sys_code&gt;!!4@L/&lt;/sys_code&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-16 17:09:16&lt;/sys_created_on&gt;&lt;sys_id&gt;38dd2c286f387100e4cd8e112e3ee41b&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;PagerDuty_REST&lt;/sys_name&gt;&lt;sys_parent/&gt;&lt;sys_path&gt;!!4@L/&lt;/sys_path&gt;&lt;sys_policy/&gt;&lt;sys_source_deleted&gt;false&lt;/sys_source_deleted&gt;&lt;sys_source_id&gt;403468884dd36100c33a943ecf043e41&lt;/sys_source_id&gt;&lt;sys_source_table&gt;sys_script_include&lt;/sys_source_table&gt;&lt;sys_type&gt;code&lt;/sys_type&gt;&lt;sys_update_name&gt;sys_script_include_403468884dd36100c33a943ecf043e41&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2014-12-01 21:53:29&lt;/sys_updated_on&gt;&lt;/sys_app_file&gt;&lt;/record_update&gt;</payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>b736df7e6f524200095acd9c5d3ee4a4</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>PagerDuty_REST</target_name>
<type>Script Include</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_app_module_7deef8959964310012e7cc5206158403</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_app_module"><sys_app_module action="INSERT_OR_UPDATE"><active>true</active><application display_value="Integration - PagerDuy">cf52bc159964310012e7cc52061584d2</application><assessment/><content_page/><device_type/><filter table="sys_user_group">u_pagerduty_serviceISNOTEMPTY^EQ<item endquery="false" field="u_pagerduty_service" goto="false" newquery="false" operator="ISNOTEMPTY" or="false" value=""/><item endquery="true" field="" goto="false" newquery="false" operator="" or="false" value=""/></filter><hint/><homepage/><image/><link_type>LIST</link_type><map_page/><mobile_title>Groups</mobile_title><mobile_view_name>Mobile</mobile_view_name><name>sys_user_group</name><order>20</order><query/><report/><roles/><survey/><survey_overwrite>true</survey_overwrite><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 19:37:30</sys_created_on><sys_domain>global</sys_domain><sys_id>7deef8959964310012e7cc5206158403</sys_id><sys_mod_count>7</sys_mod_count><sys_overrides/><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:45:53</sys_updated_on><timeline_page/><title>PD Assignment Groups</title><uncancelable>false</uncancelable><view_name/><window_name/></sys_app_module><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!:*$/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 19:37:30</sys_created_on><sys_id>611f7cd59964310012e7cc5206158495</sys_id><sys_mod_count>0</sys_mod_count><sys_name>PD Assignment Groups</sys_name><sys_parent/><sys_path>!!:*$/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>7deef8959964310012e7cc5206158403</sys_source_id><sys_source_table>sys_app_module</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_app_module_7deef8959964310012e7cc5206158403</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:45:53</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>bb365f7e6f524200095acd9c5d3ee449</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>sys_user_group</table>
<target_name>PD Assignment Groups</target_name>
<type>Module</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action/>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_sys_user_group_u_pagerduty_policy</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary element="u_pagerduty_policy" table="sys_user_group"><active>true</active><array>false</array><attributes/><audit>false</audit><calculation/><choice/><choice_field/><choice_table/><column_label>PagerDuty Policy</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_pagerduty_policy</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>sys_user_group</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 21:15:47</sys_created_on><sys_id>ce39f3d7fda36100c33aa767053a35b6</sys_id><sys_mod_count>2</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:10:41</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9O2/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 21:15:47</sys_created_on><sys_id>19ed129d65bb294033f3979d4c1e91b9</sys_id><sys_mod_count>0</sys_mod_count><sys_name>PagerDuty Policy</sys_name><sys_parent display_value="Group">080e7141a440110056d5b5bdb2273f2f</sys_parent><sys_path>!!(~K/!!9O2/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_pagerduty_policy" name="sys_user_group" sys_source_table="sys_dictionary">ce39f3d7fda36100c33aa767053a35b6</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_sys_user_group_u_pagerduty_policy</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:10:41</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>bb365f7e6f524200095acd9c5d3ee44a</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>sys_user_group</table>
<target_name>Group.PagerDuty Policy</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_message_type</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_message_type" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_message_type</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Message Type</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_message_type</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>ce3d5e4c4d176100c33a943ecf043ef2</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:40</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QC/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>e37700606f428600095acd9c5d3ee4b7</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Message Type</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3QC/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_message_type" name="u_pagerduty" sys_source_table="sys_dictionary">ce3d5e4c4d176100c33a943ecf043ef2</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_message_type</sys_update_name><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:40</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>bb365f7e6f524200095acd9c5d3ee44b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Message Type</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_updated_by_name</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_updated_by_name" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_updated_by_name</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Updated By Name</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_updated_by_name</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:25</sys_created_on><sys_id>95303f57fda36100c33aa767053a353a</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:25</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QG/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:25</sys_created_on><sys_id>7f9a70bd6f210600095acd9c5d3ee400</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Updated By Name</sys_name><sys_parent display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_parent><sys_path>!!3Q4/!!3QG/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_updated_by_name" name="u_pagerduty" sys_source_table="sys_dictionary">95303f57fda36100c33aa767053a353a</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_updated_by_name</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:25</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>bb365f7e6f524200095acd9c5d3ee44c</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Updated By Name</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_08eddab75576210012e79621ec424b62</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message"><sys_rest_message action="INSERT_OR_UPDATE"><basic_auth_password/><basic_auth_user/><description>PagerDuty Integration API&#13;
https://developer.pagerduty.com/documentation/integration/events</description><name>PagerDuty</name><rest_endpoint>https://events.pagerduty.com/generic/2010-04-15/create_event.json</rest_endpoint><sys_created_by>admin.jwilson</sys_created_by><sys_created_on>2014-09-03 21:06:57</sys_created_on><sys_id>08eddab75576210012e79621ec424b62</sys_id><sys_mod_count>2</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:40:38</sys_updated_on><use_basic_auth>false</use_basic_auth></sys_rest_message><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9LP/</sys_code><sys_created_by>admin.jwilson</sys_created_by><sys_created_on>2014-09-03 21:06:57</sys_created_on><sys_id>aa0fde83656b254033f3979d4c1e91ee</sys_id><sys_mod_count>0</sys_mod_count><sys_name>PagerDuty</sys_name><sys_parent/><sys_path>!!9LP/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>08eddab75576210012e79621ec424b62</sys_source_id><sys_source_table>sys_rest_message</sys_source_table><sys_type/><sys_update_name>sys_rest_message_08eddab75576210012e79621ec424b62</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:40:38</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>bb365f7e6f524200095acd9c5d3ee44d</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>PagerDuty</target_name>
<type>REST Message</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_parameters_aa8c10a0547c7100c33a40b7789e630c</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn_parameters"><sys_rest_message_fn_parameters action="INSERT_OR_UPDATE"><name>instance</name><rest_message_function display_value="put">a3e06fac4d9b6100c33a943ecf043ed1</rest_message_function><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-12-01 19:26:56</sys_created_on><sys_id>aa8c10a0547c7100c33a40b7789e630c</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:26:56</sys_updated_on><type>string</type><value/></sys_rest_message_fn_parameters><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!:*A/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-12-01 19:26:56</sys_created_on><sys_id>449cd860547c7100c33a40b7789e635b</sys_id><sys_mod_count>1</sys_mod_count><sys_name>instance</sys_name><sys_parent display_value="put">6e0f12c3656b254033f3979d4c1e9117</sys_parent><sys_path>!!9LQ/!!9LU/!!:*A/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>aa8c10a0547c7100c33a40b7789e630c</sys_source_id><sys_source_table>sys_rest_message_fn_parameters</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_parameters_aa8c10a0547c7100c33a40b7789e630c</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:26:56</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>bb365f7e6f524200095acd9c5d3ee44e</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>instance</target_name>
<type>REST Message Function Parameters</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_transform_map_25d55a4c4d176100c33a943ecf043e78</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_transform_map"&gt;&lt;sys_transform_map action="INSERT_OR_UPDATE"&gt;&lt;active&gt;true&lt;/active&gt;&lt;copy_empty_fields&gt;false&lt;/copy_empty_fields&gt;&lt;enforce_mandatory_fields&gt;No&lt;/enforce_mandatory_fields&gt;&lt;name&gt;PagerDuty&lt;/name&gt;&lt;order&gt;100&lt;/order&gt;&lt;run_business_rules&gt;true&lt;/run_business_rules&gt;&lt;run_script&gt;true&lt;/run_script&gt;&lt;script&gt;&lt;![CDATA[var debug = true;

/***********************************************************************************************
Event: incident.trigger
Add work note re: trigger + URL, save Incident Id
Event: incident.acknowledge ==&gt; Update Assigned To on SN incident
Add work note, set Assigned to
Event: incident.unacknowledge -- timeout
Do nothing
Event: incident.resolve ==&gt; Mark incident = Resolved, retrieve PD Note
Mark incident resolved with generic Close Note/Code, Resolved by
Event: incident.assign -- manually re-assigned to another user in different escalation chain ==&gt; Work Note
Add work note, set Assigned to
Event: incident.escalate -- reassigned (in PD sense) to another person in escalation chain ==&gt; Work Note
Add work note
Do NOT set Assigned to since user did not ack
Event: incident.delegate -- reassigned to another group/service ==&gt; Work Note
Add work note, clear Assigned to, set Assignment Group (lookup group via ???)
 *************************************************************************************************/

var note;


if (action == "insert") {
	// Do not create an incident from the PagerDuty event
	//ignore = true;
	//if (debug) log.info("Ignore incident.trigger because ServiceNow incident was not found.");
	
	if (JSUtil.nil(source.u_servicenow_group)) {
		ignore = true;
		if (debug) log.info("Ignore inserting a new row because ServiceNow group wasn't specified in the URL query.");
	}
	
	if (source.u_message_type != "incident.trigger") {
		ignore = true;
		if (debug) log.info("Ignore inserting a new row because this isn't a trigger.");
	}
	
	var pd = new PagerDuty_REST();
	
	// Required fields to set for the integration to fully work regardless of incident fields needed
	target.u_pagerduty_key = pd.getServiceKeyByID(source.u_service_id);
	
	// Here we need to set all the various fields to some value that makes sense. Depending on the requirements, more fields may need to be set.
	target.impact = 1;
	target.urgency = 1;
	target.priority = 1;
	target.assignment_group.setDisplayValue(source.u_servicenow_group);
	target.u_pagerduty_id = source.u_id;
	target.category = "request";
	target.short_description = "PagerDuty incident #" + Math.round(source.u_number) + " was opened on " + source.u_service_name;
	note = "PagerDuty: Attempting to notify " + source.u_assigned_to_name + "\n";
	note = note + "Go to the URL to see the PagerDuty log -- " + source.u_url;
	note = note + "Assigning to group -- " + source.u_servicenow_group;
	target.work_notes = note;
	
} else {
	if (source.u_message_type == "incident.trigger") {
		if (debug) log.info("In incident.trigger logic");
			
		// Document who currently is being notified PD incident
		note = "PagerDuty: Attempting to notify " + source.u_assigned_to_name + "\n";
		note = note + "Go to the URL to see the PagerDuty log -- " + source.u_url;
		
		// Set PagerDuty incident ID -- needed for SN re-assignments
		if (JSUtil.nil(target.u_pagerduty_id)) {
			target.u_pagerduty_id = source.u_id;
		}
		target.work_notes = note;
		
	} else if (source.u_message_type == "incident.acknowledge") {
		if (debug) log.info("In incident.acknowledge logic");
			
		note = "PagerDuty: Acknowledged by " + source.u_assigned_to_name;
		
		// Treat acknowledge as assignment
		var usr = getUser(source.u_assigned_to_user);
		if (JSUtil.notNil(usr)) {
			target.assigned_to = usr;
		} else {
			note = note + "\n\nERROR: Could not set Assigned to field -- unable to find user with email = " + source.u_assigned_to_user;
		}
		
		target.work_notes = note;
		
		
		
	} else if (source.u_message_type == "incident.unacknowledge") {
		ignore = true;
		if (debug) log.info("Ignore incident.unacknowledge -- there should not be an ACK timeout");
			
	} else if (source.u_message_type == "incident.resolve") {
		if (debug) log.info("In incident.resolve logic");
			
		if (target.state != 6 &amp;&amp; target.state != 7) {
			if (debug) log.info("Set closure fields");
				
			target.state = 6;
			target.u_close_notes = "The incident has been marked Resolved by an external system.";
			target.close_code = "solved";
			target.resolved_by = getUser(source.u_resolved_by_user);
			target.work_notes = "PagerDuty: Resolved by " + source.u_resolved_by_name;
			
			// If Assgined to is blank, set it
			if (JSUtil.nil(target.assigned_to)) {
				target.assigned_to = getUser(source.u_resolved_by_user);
			}
		} else {
			// SN incident is already resolved or closed, do not set closure fields
			target.work_notes = "PagerDuty: Ignore incident.resolve event because incident is already Resolved or Closed.";
		}
		
		// Always sever relationship between SN and PD
		target.u_pagerduty = '';
		
		
	} else if (source.u_message_type == "incident.assign") {
		if (debug) log.info("In incident.assign logic");
			
		note = "PagerDuty: Manually assigned to " + source.u_assigned_to_name;
		
		// Treat acknowledge as assignment
		var usr = getUser(source.u_assigned_to_user);
		if (JSUtil.notNil(usr)) {
			target.assigned_to = usr;
		} else {
			note = note + "\n\nERROR: Could not set Assigned to field -- unable to find user with email = " + source.u_assigned_to_user;
		}
		
		target.work_notes = note;
		
	} else if (source.u_message_type == "incident.escalate") {
		if (debug) log.info("In incident.escalate logic");
			
		// Document who currently is being notified PD incident
		target.work_notes = "PagerDuty: Escalated within the specified policy -- attempting to notify " + source.u_assigned_to_name;
		
	} else if (source.u_message_type == "incident.delegate") {
		if (debug) log.info("In incident.delegate logic");
			
		note = "PagerDuty: Delegated to " + source.u_escalation_policy + " -- attempting to notify  " + source.u_assigned_to_name;
		
		// Delegated to another group
		// Clear out Assigned to field
		target.assigned_to = '';
		
		// Get new group
		var grp = getGroup(source.u_escalation_policy_id);
		if (JSUtil.notNil(grp)) {
			target.assignment_group = grp;
		} else {
			note = note + "\n\nERROR: Could not set Assignment Group field -- unable to find group with escalation polciy = " + source.u_escalation_policy_id;
		}
		
		target.work_notes = note;
		
		
	}
}
	
	function getUser(email) {
		// Get user sys_id given email address
		
		var usr = new GlideRecord('sys_user');
		usr.addQuery('email', email);
		usr.query();
		if (usr.next()) {
			return usr.sys_id.toString();
		}  else {
			log.warn('Unable to find user that matched email=' + email,'Map:PagerDuty');
		}
		
	}
	
	function getGroup(policy) {
		// Get group sys_id given policy id
		
		var grp = new GlideRecord('sys_user_group');
		grp.addQuery('u_pagerduty_policy', policy);
		grp.query();
		if (grp.next()) {
			return grp.sys_id.toString();
		} else {
			log.warn('Unable to find Level 2 group that matched escalation policy id=' + policy,'Map:PagerDuty');
		}
	}]]&gt;&lt;/script&gt;&lt;source_table&gt;u_pagerduty&lt;/source_table&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-17 01:25:54&lt;/sys_created_on&gt;&lt;sys_id&gt;25d55a4c4d176100c33a943ecf043e78&lt;/sys_id&gt;&lt;sys_mod_count&gt;47&lt;/sys_mod_count&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-08-19 18:55:59&lt;/sys_updated_on&gt;&lt;target_table&gt;incident&lt;/target_table&gt;&lt;/sys_transform_map&gt;&lt;sys_app_file action="INSERT_OR_UPDATE"&gt;&lt;customer_update&gt;true&lt;/customer_update&gt;&lt;publish_override/&gt;&lt;replace_on_upgrade&gt;false&lt;/replace_on_upgrade&gt;&lt;restore/&gt;&lt;sys_app/&gt;&lt;sys_code&gt;!!3RR/&lt;/sys_code&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-17 01:25:54&lt;/sys_created_on&gt;&lt;sys_id&gt;609740606f428600095acd9c5d3ee498&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;PagerDuty&lt;/sys_name&gt;&lt;sys_parent/&gt;&lt;sys_path&gt;!!3RR/&lt;/sys_path&gt;&lt;sys_policy/&gt;&lt;sys_source_deleted&gt;false&lt;/sys_source_deleted&gt;&lt;sys_source_id&gt;25d55a4c4d176100c33a943ecf043e78&lt;/sys_source_id&gt;&lt;sys_source_table&gt;sys_transform_map&lt;/sys_source_table&gt;&lt;sys_type/&gt;&lt;sys_update_name&gt;sys_transform_map_25d55a4c4d176100c33a943ecf043e78&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-08-19 18:55:59&lt;/sys_updated_on&gt;&lt;/sys_app_file&gt;&lt;/record_update&gt;</payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>bb36df7e6f524200095acd9c5d3ee4a4</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>PagerDuty</target_name>
<type>Table Transform Map</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_app_module_b16334559964310012e7cc5206158495</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_app_module"><sys_app_module action="INSERT_OR_UPDATE"><active>true</active><application display_value="Integration - PagerDuy">cf52bc159964310012e7cc52061584d2</application><assessment/><content_page/><device_type/><filter table="sys_script_include">nameLIKEPagerDuty^EQ<item endquery="false" field="name" goto="false" newquery="false" operator="LIKE" or="false" value="PagerDuty"/><item endquery="true" field="" goto="false" newquery="false" operator="" or="false" value=""/></filter><hint/><homepage/><image/><link_type>DIRECT</link_type><map_page/><mobile_title>Script Include</mobile_title><mobile_view_name>Mobile</mobile_view_name><name>sys_script_include</name><order>110</order><query>/sys_script_include.do?sysparm_query=name=PagerDuty_REST</query><report/><roles/><survey/><survey_overwrite>true</survey_overwrite><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 18:47:05</sys_created_on><sys_domain>global</sys_domain><sys_id>b16334559964310012e7cc5206158495</sys_id><sys_mod_count>4</sys_mod_count><sys_overrides/><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:31:31</sys_updated_on><timeline_page/><title>Script Include</title><uncancelable>false</uncancelable><view_name/><window_name/></sys_app_module><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!:)[/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 18:47:05</sys_created_on><sys_id>4783bc159964310012e7cc5206158498</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Script Include</sys_name><sys_parent/><sys_path>!!:)[/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>b16334559964310012e7cc5206158495</sys_source_id><sys_source_table>sys_app_module</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_app_module_b16334559964310012e7cc5206158495</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:31:31</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>bf365f7e6f524200095acd9c5d3ee449</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>sys_script_include</table>
<target_name>Script Include</target_name>
<type>Module</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_assigned_to_name</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_assigned_to_name" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_assigned_to_name</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Assigned To Name</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_assigned_to_name</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:26</sys_created_on><sys_id>15303f57fda36100c33aa767053a353e</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:26</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3Q:/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:26</sys_created_on><sys_id>4b9a30bd6f210600095acd9c5d3ee4ed</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Assigned To Name</sys_name><sys_parent display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_parent><sys_path>!!3Q4/!!3Q:/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_assigned_to_name" name="u_pagerduty" sys_source_table="sys_dictionary">15303f57fda36100c33aa767053a353e</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_assigned_to_name</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:26</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>bf365f7e6f524200095acd9c5d3ee44a</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Assigned To Name</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_resolved_by_name</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_resolved_by_name" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_resolved_by_name</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Resolved By Name</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_resolved_by_name</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:26</sys_created_on><sys_id>19303f57fda36100c33aa767053a353f</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:26</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QD/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:26</sys_created_on><sys_id>6b9a30bd6f210600095acd9c5d3ee4fb</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Resolved By Name</sys_name><sys_parent display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_parent><sys_path>!!3Q4/!!3QD/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_resolved_by_name" name="u_pagerduty" sys_source_table="sys_dictionary">19303f57fda36100c33aa767053a353f</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_resolved_by_name</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:26</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>bf365f7e6f524200095acd9c5d3ee44b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Resolved By Name</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_url</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_url" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_url</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Url</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_url</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>100</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 19:26:54</sys_created_on><sys_id>ba40e7d3fda36100c33aa767053a3579</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 19:26:54</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QL/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 19:26:54</sys_created_on><sys_id>5c8700606f428600095acd9c5d3ee4df</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Url</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3QL/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_url" name="u_pagerduty" sys_source_table="sys_dictionary">ba40e7d3fda36100c33aa767053a3579</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_url</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 19:26:54</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>bf365f7e6f524200095acd9c5d3ee44c</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Url</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_a3e06fac4d9b6100c33a943ecf043ed1</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn"><sys_rest_message_fn action="INSERT_OR_UPDATE"><basic_auth_password/><basic_auth_user/><content>${payload}</content><function_name>put</function_name><lock>false</lock><rest_endpoint>https://${instance}.pagerduty.com/api/v1/${feature}</rest_endpoint><rest_message display_value="PagerDuty_REST_API">f7906fac4d9b6100c33a943ecf043eb0</rest_message><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:10:42</sys_created_on><sys_id>a3e06fac4d9b6100c33a943ecf043ed1</sys_id><sys_mod_count>5</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:26:46</sys_updated_on><use_basic_auth>false</use_basic_auth><use_mid_server/></sys_rest_message_fn><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9LU/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:10:42</sys_created_on><sys_id>6e0f12c3656b254033f3979d4c1e9117</sys_id><sys_mod_count>0</sys_mod_count><sys_name>put</sys_name><sys_parent display_value="PagerDuty_REST_API">ea0f12c3656b254033f3979d4c1e9114</sys_parent><sys_path>!!9LQ/!!9LU/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>a3e06fac4d9b6100c33a943ecf043ed1</sys_source_id><sys_source_table>sys_rest_message_fn</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_a3e06fac4d9b6100c33a943ecf043ed1</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:26:46</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>bf365f7e6f524200095acd9c5d3ee44d</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>put</target_name>
<type>REST Message Function</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_script_23182473fd676100c33aa767053a3548</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update sys_domain="global" table="sys_script"&gt;&lt;sys_script action="INSERT_OR_UPDATE"&gt;&lt;abort_action&gt;false&lt;/abort_action&gt;&lt;action_delete&gt;false&lt;/action_delete&gt;&lt;action_insert&gt;true&lt;/action_insert&gt;&lt;action_label/&gt;&lt;action_name/&gt;&lt;action_query&gt;false&lt;/action_query&gt;&lt;action_run_at&gt;server&lt;/action_run_at&gt;&lt;action_update&gt;true&lt;/action_update&gt;&lt;active&gt;true&lt;/active&gt;&lt;add_message&gt;false&lt;/add_message&gt;&lt;advanced&gt;true&lt;/advanced&gt;&lt;application/&gt;&lt;client_callable&gt;false&lt;/client_callable&gt;&lt;collection&gt;incident&lt;/collection&gt;&lt;condition/&gt;&lt;description/&gt;&lt;filter_condition table="incident"&gt;u_pagerdutyISNOTEMPTY^assignment_groupVALCHANGES^assignment_groupISNOTEMPTY^assignment_group.u_level2=true^u_pagerduty_idISNOTEMPTY^EQ&lt;item endquery="false" field="u_pagerduty" goto="false" newquery="false" operator="ISNOTEMPTY" or="false" value=""/&gt;&lt;item endquery="false" field="assignment_group" goto="false" newquery="false" operator="VALCHANGES" or="false" value=""/&gt;&lt;item endquery="false" field="assignment_group" goto="false" newquery="false" operator="ISNOTEMPTY" or="false" value=""/&gt;&lt;item endquery="false" field="assignment_group.u_level2" goto="false" newquery="false" operator="=" or="false" value="true"/&gt;&lt;item endquery="false" field="u_pagerduty_id" goto="false" newquery="false" operator="ISNOTEMPTY" or="false" value=""/&gt;&lt;item endquery="true" field="" goto="false" newquery="false" operator="" or="false" value=""/&gt;&lt;/filter_condition&gt;&lt;message/&gt;&lt;name&gt;Assign Group PagerDuty Incident&lt;/name&gt;&lt;onclick/&gt;&lt;order&gt;100&lt;/order&gt;&lt;priority&gt;100&lt;/priority&gt;&lt;read_access_action&gt;false&lt;/read_access_action&gt;&lt;role_conditions/&gt;&lt;script&gt;&lt;![CDATA[// Notify new group of incident assignment via PagerDuty - new group means delegate to new service
var debug = true;
if (debug) gs.log("Entered", "BR:Assign Group PagerDuty Incident");

var pd = new PagerDuty_REST();

// Assign PD incident
var resp_message = pd.delegateIncident(current.u_pagerduty_id.toString(), current.assignment_group.u_pagerduty_policy.toString(), gs.getUser().getEmail().toString());

if (!pd.hasError) {
	if (debug) gs.log("resp_message=" + resp_message, "BR:Assign Group PagerDuty Incident");
	
	
} else {
	gs.addErrorMessage("PagerDuty integration error -- " + pd.errMsg + ". PagerDuty did not find the Assigned Group's escalation policy; check to see if user is configured properly in PagerDuty then re-escalate.");
	gs.logError("PagerDuty integration failed: incident=" + current.number + ", message=" + pd.errMsg, "BR:Assign Group PagerDuty Incident");
	current.work_notes = "PagerDuty integration error -- " + pd.errMsg + ". PagerDuty did not find the Assigned Group's escalation policy; check to see if user is configured properly in PagerDuty then re-escalate.";
	current.update();
}

if (debug) gs.log("Exiting", "BR:Assign Group PagerDuty Incident");]]&gt;&lt;/script&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-10-10 19:19:11&lt;/sys_created_on&gt;&lt;sys_domain&gt;global&lt;/sys_domain&gt;&lt;sys_id&gt;23182473fd676100c33aa767053a3548&lt;/sys_id&gt;&lt;sys_mod_count&gt;11&lt;/sys_mod_count&gt;&lt;sys_overrides/&gt;&lt;sys_updated_by&gt;jwilson&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2014-11-21 20:32:26&lt;/sys_updated_on&gt;&lt;template/&gt;&lt;when&gt;after&lt;/when&gt;&lt;/sys_script&gt;&lt;sys_app_file action="INSERT_OR_UPDATE"&gt;&lt;customer_update&gt;true&lt;/customer_update&gt;&lt;publish_override/&gt;&lt;replace_on_upgrade&gt;false&lt;/replace_on_upgrade&gt;&lt;restore/&gt;&lt;sys_app/&gt;&lt;sys_code&gt;!!9OO/&lt;/sys_code&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-10-10 19:19:11&lt;/sys_created_on&gt;&lt;sys_id&gt;d50e529d65bb294033f3979d4c1e91aa&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;Assign Group PagerDuty Incident&lt;/sys_name&gt;&lt;sys_parent display_value="Incident"&gt;42fdf901a440110056d5b5bdb2273fa2&lt;/sys_parent&gt;&lt;sys_path&gt;!!(WU/!!9OO/&lt;/sys_path&gt;&lt;sys_policy/&gt;&lt;sys_source_deleted&gt;false&lt;/sys_source_deleted&gt;&lt;sys_source_id&gt;23182473fd676100c33aa767053a3548&lt;/sys_source_id&gt;&lt;sys_source_table&gt;sys_script&lt;/sys_source_table&gt;&lt;sys_type&gt;code&lt;/sys_type&gt;&lt;sys_update_name&gt;sys_script_23182473fd676100c33aa767053a3548&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;jwilson&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2014-11-21 20:32:26&lt;/sys_updated_on&gt;&lt;/sys_app_file&gt;&lt;/record_update&gt;</payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>bf36df7e6f524200095acd9c5d3ee4a3</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>incident</table>
<target_name>Assign Group PagerDuty Incident</target_name>
<type>Business Rule</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_ui_section_c63e27aac61122860001d65226b409e8</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_ui_section section_id="c63e27aac61122860001d65226b409e8" sys_domain="global" table="sys_app_module" version="2"><sys_ui_annotation action="INSERT_OR_UPDATE"><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-18 23:32:30</sys_created_on><sys_id>142258106fce4600095acd9c5d3ee4ed</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-18 23:32:30</sys_updated_on><text>Application Module Form Description</text><type display_value="Section Details">19756e5ec3313000bac1addbdfba8f18</type></sys_ui_annotation><sys_ui_element action="INSERT_OR_UPDATE"><element>142258106fce4600095acd9c5d3ee4ed</element><position>0</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-18 23:32:30</sys_created_on><sys_id>542258106fce4600095acd9c5d3ee4ed</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">c63e27aac61122860001d65226b409e8</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-18 23:32:30</sys_updated_on><sys_user/><type>annotation</type></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>.begin_split</element><position>1</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-18 23:32:30</sys_created_on><sys_id>942258106fce4600095acd9c5d3ee4ed</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">c63e27aac61122860001d65226b409e8</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-18 23:32:30</sys_updated_on><sys_user/><type>.begin_split</type></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>title</element><position>2</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-18 23:32:30</sys_created_on><sys_id>d42258106fce4600095acd9c5d3ee4ed</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">c63e27aac61122860001d65226b409e8</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-18 23:32:30</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>application</element><position>3</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-18 23:32:30</sys_created_on><sys_id>182258106fce4600095acd9c5d3ee4ed</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">c63e27aac61122860001d65226b409e8</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-18 23:32:30</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>.split</element><position>4</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-18 23:32:30</sys_created_on><sys_id>582258106fce4600095acd9c5d3ee4ed</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">c63e27aac61122860001d65226b409e8</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-18 23:32:30</sys_updated_on><sys_user/><type>.split</type></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>image</element><position>5</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-18 23:32:30</sys_created_on><sys_id>982258106fce4600095acd9c5d3ee4ed</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">c63e27aac61122860001d65226b409e8</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-18 23:32:30</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>hint</element><position>6</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-18 23:32:30</sys_created_on><sys_id>d82258106fce4600095acd9c5d3ee4ed</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">c63e27aac61122860001d65226b409e8</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-18 23:32:30</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>.end_split</element><position>7</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-18 23:32:30</sys_created_on><sys_id>1c2258106fce4600095acd9c5d3ee4ed</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">c63e27aac61122860001d65226b409e8</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-18 23:32:30</sys_updated_on><sys_user/><type>.end_split</type></sys_ui_element><sys_ui_element action="INSERT_OR_UPDATE"><element>order</element><position>8</position><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-18 23:32:30</sys_created_on><sys_id>5c2258106fce4600095acd9c5d3ee4ed</sys_id><sys_mod_count>0</sys_mod_count><sys_ui_formatter/><sys_ui_section display_value="">c63e27aac61122860001d65226b409e8</sys_ui_section><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-18 23:32:30</sys_updated_on><sys_user/><type/></sys_ui_element><sys_ui_section action="INSERT_OR_UPDATE"><caption/><header>false</header><name>sys_app_module</name><roles/><sys_created_by>GUEST</sys_created_by><sys_created_on>2004-04-05 00:00:00</sys_created_on><sys_domain>global</sys_domain><sys_id>c63e27aac61122860001d65226b409e8</sys_id><sys_mod_count>1</sys_mod_count><sys_overrides/><sys_updated_by>glide.maint</sys_updated_by><sys_updated_on>2007-05-18 22:19:46</sys_updated_on><sys_user/><title>true</title><view display_value="Default view" name="NULL">Default view</view><view_name/></sys_ui_section></sys_ui_section><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app display_value="System (apps/system_ui)">a64f41d26fb54600095acd9c5d3ee478</sys_app><sys_code>!!##{/</sys_code><sys_created_by>GUEST</sys_created_by><sys_created_on>2004-04-05 00:00:00</sys_created_on><sys_id>d872c1566f754600095acd9c5d3ee4c3</sys_id><sys_mod_count>1</sys_mod_count><sys_name>sys_app_module</sys_name><sys_parent display_value="Module">26bb855e6f754600095acd9c5d3ee4d5</sys_parent><sys_path>!!0I:/!!##{/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>c63e27aac61122860001d65226b409e8</sys_source_id><sys_source_table>sys_ui_section</sys_source_table><sys_type/><sys_update_name>sys_ui_section_c63e27aac61122860001d65226b409e8</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-18 23:32:30</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>bf36df7e6f524200095acd9c5d3ee4a4</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>sys_app_module</table>
<target_name>Module</target_name>
<type>Form Layout</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_app_module_ff2258106fce4600095acd9c5d3ee4f9</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_app_module"><sys_app_module action="INSERT_OR_UPDATE"><active>true</active><application display_value="PagerDuty">cf52bc159964310012e7cc52061584d2</application><assessment/><content_page/><device_type/><filter/><hint/><homepage/><image/><link_type>DIRECT</link_type><map_page/><mobile_title>Contact Support</mobile_title><mobile_view_name>Mobile</mobile_view_name><name/><order>610</order><query>https://support.pagerduty.com/hc/en-us</query><report/><roles/><survey/><survey_overwrite>true</survey_overwrite><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-18 23:33:50</sys_created_on><sys_domain>global</sys_domain><sys_id>ff2258106fce4600095acd9c5d3ee4f9</sys_id><sys_mod_count>1</sys_mod_count><sys_overrides/><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-18 23:35:42</sys_updated_on><timeline_page/><title>Contact Support</title><uncancelable>false</uncancelable><view_name/><window_name>_blank</window_name></sys_app_module><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3R{/</sys_code><sys_created_by>admin</sys_created_by><sys_created_on>2015-08-18 23:33:50</sys_created_on><sys_id>7f6210dc6f8e4600095acd9c5d3ee4e8</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Contact Support</sys_name><sys_parent/><sys_path>!!3R{/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>ff2258106fce4600095acd9c5d3ee4f9</sys_source_id><sys_source_table>sys_app_module</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_app_module_ff2258106fce4600095acd9c5d3ee4f9</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-08-18 23:35:42</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>f3365f7e6f524200095acd9c5d3ee44a</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table/>
<target_name>Contact Support</target_name>
<type>Module</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_escalation_policy</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_escalation_policy" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_escalation_policy</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Escalation Policy</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_escalation_policy</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 21:08:38</sys_created_on><sys_id>0d977f97fda36100c33aa767053a3511</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 21:08:38</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3Q&lt;/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 21:08:38</sys_created_on><sys_id>439a30bd6f210600095acd9c5d3ee4f1</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Escalation Policy</sys_name><sys_parent display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_parent><sys_path>!!3Q4/!!3Q&lt;/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_escalation_policy" name="u_pagerduty" sys_source_table="sys_dictionary">0d977f97fda36100c33aa767053a3511</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_escalation_policy</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 21:08:38</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>f3365f7e6f524200095acd9c5d3ee44b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Escalation Policy</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_servicenow_group</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_servicenow_group" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_servicenow_group</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>ServiceNow Group</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_servicenow_group</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>100</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2015-07-31 17:31:01</sys_created_on><sys_id>c4b1c9bd6f210600095acd9c5d3ee444</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-07-31 17:31:01</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QG/</sys_code><sys_created_by>admin</sys_created_by><sys_created_on>2015-07-31 17:31:01</sys_created_on><sys_id>f37700606f428600095acd9c5d3ee4be</sys_id><sys_mod_count>0</sys_mod_count><sys_name>ServiceNow Group</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3QG/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_servicenow_group" name="u_pagerduty" sys_source_table="sys_dictionary">c4b1c9bd6f210600095acd9c5d3ee444</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_servicenow_group</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2015-07-31 17:31:01</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>f3365f7e6f524200095acd9c5d3ee44c</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.ServiceNow Group</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_documentation_sys_user_group_u_pagerduty_policy_en</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_documentation element="u_pagerduty_policy" label="PagerDuty Policy" language="en" table="sys_user_group"><sys_documentation action="INSERT_OR_UPDATE"><element>u_pagerduty_policy</element><help/><hint>Unique identifier to a PagerDuty escalation policy</hint><label>PagerDuty Policy</label><language>en</language><name>sys_user_group</name><plural>PagerDuty Policies</plural><sys_created_by>jschraith</sys_created_by><sys_created_on>2014-10-15 19:45:05</sys_created_on><sys_id>b7fd129d65bb294033f3979d4c1e91f4</sys_id><sys_mod_count>1</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:13:48</sys_updated_on><url/><url_target/></sys_documentation></sys_documentation><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9O@/</sys_code><sys_created_by>jschraith</sys_created_by><sys_created_on>2014-10-15 19:45:05</sys_created_on><sys_id>fbfd129d65bb294033f3979d4c1e91f4</sys_id><sys_mod_count>1</sys_mod_count><sys_name>PagerDuty Policy</sys_name><sys_parent display_value="PagerDuty Policy">19ed129d65bb294033f3979d4c1e91b9</sys_parent><sys_path>!!(~K/!!9O2/!!9O@/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_pagerduty_policy" language="en" name="sys_user_group" sys_source_table="sys_documentation">b7fd129d65bb294033f3979d4c1e91f4</sys_source_id><sys_source_table>sys_documentation</sys_source_table><sys_type/><sys_update_name>sys_documentation_sys_user_group_u_pagerduty_policy_en</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:13:48</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>f3365f7e6f524200095acd9c5d3ee44d</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>sys_user_group</table>
<target_name>Group.PagerDuty Policy</target_name>
<type>Field Label</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_parameters_0627e8884dd36100c33a943ecf043e3b</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn_parameters"><sys_rest_message_fn_parameters action="INSERT_OR_UPDATE"><name>client_url</name><rest_message_function display_value="post">2dfdd2775576210012e79621ec424be5</rest_message_function><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-16 17:22:15</sys_created_on><sys_id>0627e8884dd36100c33a943ecf043e3b</sys_id><sys_mod_count>2</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:44:19</sys_updated_on><type>string</type><value/></sys_rest_message_fn_parameters><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9L`/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-16 17:22:15</sys_created_on><sys_id>b60f12c3656b254033f3979d4c1e911e</sys_id><sys_mod_count>0</sys_mod_count><sys_name>client_url</sys_name><sys_parent display_value="post">e20f12c3656b254033f3979d4c1e9116</sys_parent><sys_path>!!9LP/!!9LS/!!9L`/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>0627e8884dd36100c33a943ecf043e3b</sys_source_id><sys_source_table>sys_rest_message_fn_parameters</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_parameters_0627e8884dd36100c33a943ecf043e3b</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:44:19</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>f3365f7e6f524200095acd9c5d3ee44e</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>client_url</target_name>
<type>REST Message Function Parameters</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_script_cb4e60d04d976100c33a943ecf043e06</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update sys_domain="global" table="sys_script"&gt;&lt;sys_script action="INSERT_OR_UPDATE"&gt;&lt;abort_action&gt;false&lt;/abort_action&gt;&lt;action_delete&gt;false&lt;/action_delete&gt;&lt;action_insert&gt;true&lt;/action_insert&gt;&lt;action_query&gt;false&lt;/action_query&gt;&lt;action_update&gt;true&lt;/action_update&gt;&lt;active&gt;true&lt;/active&gt;&lt;add_message&gt;false&lt;/add_message&gt;&lt;advanced&gt;true&lt;/advanced&gt;&lt;client_callable&gt;false&lt;/client_callable&gt;&lt;collection&gt;incident&lt;/collection&gt;&lt;condition/&gt;&lt;description/&gt;&lt;filter_condition table="incident"&gt;u_pagerdutyISNOTEMPTY^stateCHANGESTO6^ORstateCHANGESTO7^NQu_pagerdutyISNOTEMPTY^state=^EQ&lt;item endquery="false" field="u_pagerduty" goto="false" newquery="false" operator="ISNOTEMPTY" or="false" value=""/&gt;&lt;item endquery="false" field="state" goto="false" newquery="false" operator="CHANGESTO" or="false" value="6"/&gt;&lt;item endquery="false" field="state" goto="false" newquery="false" operator="CHANGESTO" or="true" value="7"/&gt;&lt;item endquery="false" field="u_pagerduty" goto="false" newquery="true" operator="ISNOTEMPTY" or="false" value=""/&gt;&lt;item endquery="false" field="state" goto="false" newquery="false" operator="=" or="false" value=""/&gt;&lt;item endquery="true" field="" goto="false" newquery="false" operator="" or="false" value=""/&gt;&lt;/filter_condition&gt;&lt;message/&gt;&lt;name&gt;Resolve PagerDuty Incident&lt;/name&gt;&lt;order&gt;100&lt;/order&gt;&lt;priority&gt;100&lt;/priority&gt;&lt;role_conditions/&gt;&lt;script&gt;&lt;![CDATA[// ServiceNow incident escalation complete -- resolve PagerDuty incident
var debug = true;
if (debug) gs.log("Entered", "BR:Resolve PagerDuty Incident");

var pd = new PagerDuty_REST();

// Lookup service key
if (JSUtil.notNil(current.u_pagerduty_key)) {
	var key = current.u_pagerduty_key.toString();
} else {
	var key = current.assignment_group.u_pagerduty_service.toString();
}

// Construct JSON object
var newstate;
if (JSUtil.nil(current.u_substate)) {
	newstate = current.state.getDisplayValue();
} else {
	newstate = current.state.getDisplayValue() + "/" + current.u_substate.getDisplayValue();
}
var body = "This incident was moved to " + newstate + " by " + current.sys_updated_by + ". Closing PagerDuty incident (if incident is re-opened, a new PD alert will be created).";
var details = {AssignmentGroup: current.assignment_group.name.toString(),
			   ResolvedByUser: current.resolved_by.name.toString(),
			   Code: current.close_code.getDisplayValue(),
			   Note: current.close_notes.toString()};
if (debug) JSUtil.logObject(details, "BR:Resolve PagerDuty Incident");

//if (debug) JSUtil.logObject(details, "BR:Resolve PagerDuty Incident");

// Create PD incident
var resp_message = pd.resolveIncident(key, current.u_pagerduty.toString(), body, details);

if (!pd.hasError) {
	if (debug) gs.log("resp_message=" + resp_message, "BR:Resolve PagerDuty Incident");
	// Success: Clear PagerDuty fields
	current.u_pagerduty = '';
	current.u_pagerduty_id = '';
	current.u_pagerduty_key = '';
	
} else {
	gs.addErrorMessage("PagerDuty integration error -- " + pd.errMsg + ". Re-escalate or contact the ServiceNow system administrators.");
	gs.logError("PagerDuty integration failed: incident=" + current.number + ", key=" + key, "BR:Trigger PagerDuty Incident");
	current.work_notes = "PagerDuty integration error -- " + pd.errMsg + ". Re-escalate or contact the ServiceNow system administrators.";
}

if (debug) gs.log("Exiting", "BR:Resolve PagerDuty Incident");]]&gt;&lt;/script&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-17 12:31:45&lt;/sys_created_on&gt;&lt;sys_domain&gt;global&lt;/sys_domain&gt;&lt;sys_id&gt;cb4e60d04d976100c33a943ecf043e06&lt;/sys_id&gt;&lt;sys_mod_count&gt;20&lt;/sys_mod_count&gt;&lt;sys_overrides/&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-08-19 19:42:38&lt;/sys_updated_on&gt;&lt;template/&gt;&lt;when&gt;before&lt;/when&gt;&lt;/sys_script&gt;&lt;sys_app_file action="INSERT_OR_UPDATE"&gt;&lt;customer_update&gt;true&lt;/customer_update&gt;&lt;publish_override/&gt;&lt;replace_on_upgrade&gt;false&lt;/replace_on_upgrade&gt;&lt;restore/&gt;&lt;sys_app/&gt;&lt;sys_code&gt;!!3RN/&lt;/sys_code&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-17 12:31:45&lt;/sys_created_on&gt;&lt;sys_id&gt;249740606f428600095acd9c5d3ee494&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;Resolve PagerDuty Incident&lt;/sys_name&gt;&lt;sys_parent display_value="Incident"&gt;b73cdcd06fce4600095acd9c5d3ee4f2&lt;/sys_parent&gt;&lt;sys_path&gt;!!$A./!!3RN/&lt;/sys_path&gt;&lt;sys_policy/&gt;&lt;sys_source_deleted&gt;false&lt;/sys_source_deleted&gt;&lt;sys_source_id&gt;cb4e60d04d976100c33a943ecf043e06&lt;/sys_source_id&gt;&lt;sys_source_table&gt;sys_script&lt;/sys_source_table&gt;&lt;sys_type&gt;code&lt;/sys_type&gt;&lt;sys_update_name&gt;sys_script_cb4e60d04d976100c33a943ecf043e06&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-08-19 19:42:38&lt;/sys_updated_on&gt;&lt;/sys_app_file&gt;&lt;/record_update&gt;</payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>f336df7e6f524200095acd9c5d3ee4a4</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>incident</table>
<target_name>Resolve PagerDuty Incident</target_name>
<type>Business Rule</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_app_module_5aa334559964310012e7cc5206158435</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_app_module"><sys_app_module action="INSERT_OR_UPDATE"><active>true</active><application display_value="Integration - PagerDuy">cf52bc159964310012e7cc52061584d2</application><assessment/><content_page/><device_type/><filter table="sys_script">nameLIKEPagerDuty^EQ<item endquery="false" field="name" goto="false" newquery="false" operator="LIKE" or="false" value="PagerDuty"/><item endquery="true" field="" goto="false" newquery="false" operator="" or="false" value=""/></filter><hint/><homepage/><image/><link_type>LIST</link_type><map_page/><mobile_title>Business Rules</mobile_title><mobile_view_name>Mobile</mobile_view_name><name>sys_script</name><order>120</order><query/><report/><roles/><survey/><survey_overwrite>true</survey_overwrite><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 18:48:00</sys_created_on><sys_domain>global</sys_domain><sys_id>5aa334559964310012e7cc5206158435</sys_id><sys_mod_count>2</sys_mod_count><sys_overrides/><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:31:08</sys_updated_on><timeline_page/><title>Business Rules</title><uncancelable>false</uncancelable><view_name/><window_name/></sys_app_module><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!:)]/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 18:48:00</sys_created_on><sys_id>64c330559964310012e7cc5206158423</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Business Rules</sys_name><sys_parent/><sys_path>!!:)]/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>5aa334559964310012e7cc5206158435</sys_source_id><sys_source_table>sys_app_module</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_app_module_5aa334559964310012e7cc5206158435</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:31:08</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>f7365f7e6f524200095acd9c5d3ee449</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>sys_script</table>
<target_name>Business Rules</target_name>
<type>Module</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action/>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_incident_u_pagerduty_id</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary element="u_pagerduty_id" table="incident"><active>true</active><array>false</array><attributes/><audit>false</audit><calculation/><choice/><choice_field/><choice_table/><column_label>PagerDuty ID</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_pagerduty_id</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>incident</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-10 17:14:48</sys_created_on><sys_id>a1abccfb4da7610012e7d1c191560a63</sys_id><sys_mod_count>3</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:07:35</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9O0/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-10 17:14:48</sys_created_on><sys_id>5ded129d65bb294033f3979d4c1e91b6</sys_id><sys_mod_count>0</sys_mod_count><sys_name>PagerDuty ID</sys_name><sys_parent display_value="Incident">42fdf901a440110056d5b5bdb2273fa2</sys_parent><sys_path>!!(WU/!!9O0/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_pagerduty_id" name="incident" sys_source_table="sys_dictionary">a1abccfb4da7610012e7d1c191560a63</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_incident_u_pagerduty_id</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:07:35</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>f7365f7e6f524200095acd9c5d3ee44a</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>incident</table>
<target_name>Incident.PagerDuty ID</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_id</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_id" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_id</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Id</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_id</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:26</sys_created_on><sys_id>2d303f57fda36100c33aa767053a3540</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:26</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QA/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:26</sys_created_on><sys_id>db7700606f428600095acd9c5d3ee4b3</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Id</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3QA/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_id" name="u_pagerduty" sys_source_table="sys_dictionary">2d303f57fda36100c33aa767053a3540</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_id</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:26</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>f7365f7e6f524200095acd9c5d3ee44b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Id</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_status</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_status" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_status</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Status</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_status</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>c23d5a8c4d176100c33a943ecf043ed0</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:41</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QI/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>c88700606f428600095acd9c5d3ee4c1</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Status</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3QI/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_status" name="u_pagerduty" sys_source_table="sys_dictionary">c23d5a8c4d176100c33a943ecf043ed0</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_status</sys_update_name><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:41</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>f7365f7e6f524200095acd9c5d3ee44c</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Status</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_processor_5c994695240b210012e7b8d269ce7dc6</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_processor"&gt;&lt;sys_processor action="INSERT_OR_UPDATE"&gt;&lt;active&gt;true&lt;/active&gt;&lt;class_name/&gt;&lt;description&gt;Inbound processor that can consume PagerDuty webhook payload.  Writes message data to the PagerDuty inbound web service.&amp;#13;
&amp;#13;
Webhook API: http://developer.pagerduty.com/documentation/rest/webhooks&lt;/description&gt;&lt;name&gt;Inbound PagerDuty Processor&lt;/name&gt;&lt;parameters/&gt;&lt;path&gt;pagerduty2sn&lt;/path&gt;&lt;roles/&gt;&lt;script&gt;&lt;![CDATA[/*
 * We could create logic around what to do if this request is
 * a GET, PUT, POST, or DELETE request.  To get that HTTP Method,
 * we use the getMethod() function on the request.
 * In this example, we just log it to a string variable.ssss
 */
var debug = true;
if (debug) gs.log("Entered Inbound PagerDuty Processor", "Processor:Inbound PagerDuty");
    
// Need array functions later
var arrayUtil = new ArrayUtil();
// List of webhook message types handled -- currently ALL types handled
var EVENTS = ["incident.trigger", "incident.acknowledge", "incident.unacknowledge", "incident.resolve", "incident.assign", "incident.escalate", "incident.delegate"];


var methodMsg = "Method string: "+g_request.getMethod()+"\n";

/*
 * We could iterate through all of the headers to make
 * intelligent decisions about how to handle this request,
 * but in this example, we will just write each header
 * and its value to a logging string
 */
var headerList = g_request.getHeaderNames();
var headerMsg = ""; //we're going to log header info here
while(headerList.hasMoreElements()){
    var header = headerList.nextElement();
    var value = g_request.getHeader(header);
    headerMsg += ("Header: ["+header+"] has a value of: "+value+"\n");
}

/*
 * We could iterate through all of the URL parameters to make
 * intelligent decisions about how to handle this request,
 * but in this example, we will just write each URL parameter
 * and its value to a logging string
 */
var urlParamList = g_request.getParameterNames();
var paramMsg = ""; //we're going to log parameter info here
while(urlParamList.hasMoreElements()){
    var param = urlParamList.nextElement();
    var value = g_request.getParameter(param);
    paramMsg += ("Parameter: ["+param+"] has a value of: "+value+"\n");
}

/*
 * Now we would normally process the request given the data posted to
 * us.  However, for this example, we are going to simply build out
 * a text response that is tailored to the information given to us
 */
var returnMessage = "";
returnMessage += "We received a Request from you with the following information:\n";
returnMessage += methodMsg;
returnMessage += "\nWITH INCOMING HEADERS\n";
returnMessage += headerMsg;
returnMessage += "\nWITH URL PARAMETERS OF\n";
returnMessage += paramMsg;
returnMessage += "\n\n";

//if (debug) gs.log("OTHER DATA: " + returnMessage, "Processor: Inbound PagerDuty");
    


/*** Get payload and put into a JSON object ***/
var is = g_request.getInputStream();
var sb = GlideStringUtil.getStringFromStream(is);
if (debug) gs.log(sb, "Processor: Inbound PagerDuty");
    
var parser = new JSONParser();
var parsed = parser.parse(sb);
//if (debug) JSUtil.logObject(parsed);
    

// PagerDuty body is an array of 'messages'
if (debug) gs.log("Number of messages: " + parsed.messages.length, "Processor: Inbound PagerDuty");

// Process each message
for (var i=0; i &lt; parsed.messages.length; i++) {
// Each item in array is a JSON object
// Get message type
var message_type = parsed.messages[i].type;
if (debug) gs.log("type="+message_type,  "Processor: Inbound PagerDuty");

// PROCESS incident.acknowledge, incident.assign, incident.delegate, incident.resolve, incident.unacknowledge
// IGNORE incident.trigger
if (arrayUtil.contains(EVENTS, message_type)) {
    var pd = new GlideRecord("u_pagerduty");
    pd.initialize();

    // Which ServiceNow group did we pass along via the query string?
    pd.u_servicenow_group = g_request.getParameter("group");
	
	// PD Service Name
    pd.u_service_name = parsed.messages[i].data.incident.service.name;
	pd.u_service_id = parsed.messages[i].data.incident.service.id;
	
	// Assigned To User
    if (parsed.messages[i].data.incident.assigned_to_user) {
        pd.u_assigned_to_user = parsed.messages[i].data.incident.assigned_to_user.email;
        pd.u_assigned_to_name = parsed.messages[i].data.incident.assigned_to_user.name;
    }
    
    // Incident Key
    pd.u_incident_key = parsed.messages[i].data.incident.incident_key;
    
    // Message Type
    pd.u_message_type = message_type;
    
    // Resolved By User
    if (parsed.messages[i].data.incident.resolved_by_user) {
        pd.u_resolved_by_user = parsed.messages[i].data.incident.resolved_by_user.email;
        pd.u_resolved_by_name = parsed.messages[i].data.incident.resolved_by_user.name;
    }
    
    // Status
    pd.u_status = parsed.messages[i].data.incident.status;

    // URL
    pd.u_url = parsed.messages[i].data.incident.html_url;

    // PD Incident Id (not the key, not the number)
    pd.u_id = parsed.messages[i].data.incident.id;

    // PD Incident #
    pd.u_number = parsed.messages[i].data.incident.incident_number;
    
    // Last status changed By User
    if (parsed.messages[i].data.incident.last_status_change_by) {
        pd.u_updated_by_user = parsed.messages[i].data.incident.last_status_change_by.email;
        pd.u_updated_by_name = parsed.messages[i].data.incident.last_status_change_by.name;
    }

    // Escalation policy
    if (parsed.messages[i].data.incident.escalation_policy) {
        pd.u_escalation_policy = parsed.messages[i].data.incident.escalation_policy.name;
        pd.u_escalation_policy_id = parsed.messages[i].data.incident.escalation_policy.id;
    }
    
    pd.insert();
    
} else {
    if (debug) gs.log("Skip creating u_pagerduty record", "Processor: Inbound PagerDuty");

}
    
    
}]]&gt;&lt;/script&gt;&lt;sys_created_by&gt;admin.jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-08 11:28:44&lt;/sys_created_on&gt;&lt;sys_id&gt;5c994695240b210012e7b8d269ce7dc6&lt;/sys_id&gt;&lt;sys_mod_count&gt;38&lt;/sys_mod_count&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-08-19 18:45:01&lt;/sys_updated_on&gt;&lt;type&gt;script&lt;/type&gt;&lt;/sys_processor&gt;&lt;sys_app_file action="INSERT_OR_UPDATE"&gt;&lt;customer_update&gt;true&lt;/customer_update&gt;&lt;publish_override/&gt;&lt;replace_on_upgrade&gt;false&lt;/replace_on_upgrade&gt;&lt;restore/&gt;&lt;sys_app/&gt;&lt;sys_code&gt;!!3R4/&lt;/sys_code&gt;&lt;sys_created_by&gt;admin.jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-08 11:28:44&lt;/sys_created_on&gt;&lt;sys_id&gt;809740606f428600095acd9c5d3ee480&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;Inbound PagerDuty Processor&lt;/sys_name&gt;&lt;sys_parent/&gt;&lt;sys_path&gt;!!3R4/&lt;/sys_path&gt;&lt;sys_policy/&gt;&lt;sys_source_deleted&gt;false&lt;/sys_source_deleted&gt;&lt;sys_source_id&gt;5c994695240b210012e7b8d269ce7dc6&lt;/sys_source_id&gt;&lt;sys_source_table&gt;sys_processor&lt;/sys_source_table&gt;&lt;sys_type&gt;code&lt;/sys_type&gt;&lt;sys_update_name&gt;sys_processor_5c994695240b210012e7b8d269ce7dc6&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-08-19 18:45:01&lt;/sys_updated_on&gt;&lt;/sys_app_file&gt;&lt;/record_update&gt;</payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>f7365f7e6f524200095acd9c5d3ee44d</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>Inbound PagerDuty Processor</target_name>
<type>Processor</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_parameters_695163ec4d9b6100c33a943ecf043edf</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn_parameters"><sys_rest_message_fn_parameters action="INSERT_OR_UPDATE"><name>token</name><rest_message_function display_value="get">a3e06fac4d9b6100c33a943ecf043ed0</rest_message_function><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:12:55</sys_created_on><sys_id>695163ec4d9b6100c33a943ecf043edf</sys_id><sys_mod_count>3</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:19:25</sys_updated_on><type>string</type><value/></sys_rest_message_fn_parameters><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9L}/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:12:55</sys_created_on><sys_id>f60f12c3656b254033f3979d4c1e916b</sys_id><sys_mod_count>0</sys_mod_count><sys_name>token</sys_name><sys_parent display_value="get">220f12c3656b254033f3979d4c1e9117</sys_parent><sys_path>!!9LQ/!!9LT/!!9L}/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>695163ec4d9b6100c33a943ecf043edf</sys_source_id><sys_source_table>sys_rest_message_fn_parameters</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_parameters_695163ec4d9b6100c33a943ecf043edf</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:19:25</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>f7365f7e6f524200095acd9c5d3ee44e</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>token</target_name>
<type>REST Message Function Parameters</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_transform_entry_1d832ecc4d176100c33a943ecf043e7a</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_transform_entry"><sys_transform_entry action="INSERT_OR_UPDATE"><choice_action>create</choice_action><coalesce>true</coalesce><coalesce_case_sensitive>false</coalesce_case_sensitive><coalesce_empty_fields>false</coalesce_empty_fields><date_format>yyyy-MM-dd hh:mm:ss</date_format><map display_value="PagerDuty">25d55a4c4d176100c33a943ecf043e78</map><reference_value_field/><source_field>u_incident_key</source_field><source_script/><source_table>u_pagerduty</source_table><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 02:25:43</sys_created_on><sys_id>1d832ecc4d176100c33a943ecf043e7a</sys_id><sys_mod_count>2</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2015-01-09 22:29:54</sys_updated_on><target_field>u_pagerduty</target_field><target_table>incident</target_table><use_source_script>false</use_source_script></sys_transform_entry><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9M&lt;/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 02:25:43</sys_created_on><sys_id>570f12c3656b254033f3979d4c1e9184</sys_id><sys_mod_count>0</sys_mod_count><sys_name>u_incident_key</sys_name><sys_parent/><sys_path>!!9M&lt;/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>1d832ecc4d176100c33a943ecf043e7a</sys_source_id><sys_source_table>sys_transform_entry</sys_source_table><sys_type/><sys_update_name>sys_transform_entry_1d832ecc4d176100c33a943ecf043e7a</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2015-01-09 22:29:54</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>f736df7e6f524200095acd9c5d3ee4a4</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>u_incident_key</target_name>
<type>Field Map</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_app_module_7ec334559964310012e7cc5206158498</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_app_module"><sys_app_module action="INSERT_OR_UPDATE"><active>true</active><application display_value="Integration - PagerDuy">cf52bc159964310012e7cc52061584d2</application><assessment/><content_page/><device_type/><filter table="sys_processor">nameLIKEPagerDuty^EQ<item endquery="false" field="name" goto="false" newquery="false" operator="LIKE" or="false" value="PagerDuty"/><item endquery="true" field="" goto="false" newquery="false" operator="" or="false" value=""/></filter><hint/><homepage/><image/><link_type>DIRECT</link_type><map_page/><mobile_title>Processor</mobile_title><mobile_view_name>Mobile</mobile_view_name><name>sys_processor</name><order>140</order><query>/sys_processor.do?sys_id=5c994695240b210012e7b8d269ce7dc6</query><report/><roles/><survey/><survey_overwrite>true</survey_overwrite><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 18:48:32</sys_created_on><sys_domain>global</sys_domain><sys_id>7ec334559964310012e7cc5206158498</sys_id><sys_mod_count>4</sys_mod_count><sys_overrides/><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:31:22</sys_updated_on><timeline_page/><title>Processor</title><uncancelable>false</uncancelable><view_name/><window_name/></sys_app_module><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!:)^/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 18:48:32</sys_created_on><sys_id>94e334559964310012e7cc520615849b</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Processor</sys_name><sys_parent/><sys_path>!!:)^/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>7ec334559964310012e7cc5206158498</sys_source_id><sys_source_table>sys_app_module</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_app_module_7ec334559964310012e7cc5206158498</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:31:22</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>fb365f7e6f524200095acd9c5d3ee449</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>sys_processor</table>
<target_name>Processor</target_name>
<type>Module</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action/>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_sys_user_group_u_pagerduty_service</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary element="u_pagerduty_service" table="sys_user_group"><active>true</active><array>false</array><attributes/><audit>false</audit><calculation/><choice/><choice_field/><choice_table/><column_label>PagerDuty Service</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_pagerduty_service</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>sys_user_group</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 21:11:38</sys_created_on><sys_id>0948ff97fda36100c33aa767053a3565</sys_id><sys_mod_count>2</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:08:37</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9O3/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 21:11:38</sys_created_on><sys_id>91ed129d65bb294033f3979d4c1e91bb</sys_id><sys_mod_count>0</sys_mod_count><sys_name>PagerDuty Service</sys_name><sys_parent display_value="Group">080e7141a440110056d5b5bdb2273f2f</sys_parent><sys_path>!!(~K/!!9O3/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_pagerduty_service" name="sys_user_group" sys_source_table="sys_dictionary">0948ff97fda36100c33aa767053a3565</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_sys_user_group_u_pagerduty_service</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:08:37</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>fb365f7e6f524200095acd9c5d3ee44a</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>sys_user_group</table>
<target_name>Group.PagerDuty Service</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_message_type</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_message_type" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_message_type</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Message Type</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_message_type</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>ce3d5e4c4d176100c33a943ecf043ef2</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:40</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QB/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-17 01:57:54</sys_created_on><sys_id>539a30bd6f210600095acd9c5d3ee4f8</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Message Type</sys_name><sys_parent display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_parent><sys_path>!!3Q4/!!3QB/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_message_type" name="u_pagerduty" sys_source_table="sys_dictionary">ce3d5e4c4d176100c33a943ecf043ef2</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_message_type</sys_update_name><sys_updated_by>jschraith</sys_updated_by><sys_updated_on>2014-10-15 19:44:40</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>fb365f7e6f524200095acd9c5d3ee44b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Message Type</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_updated_by_user</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_updated_by_user" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_updated_by_user</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Updated By User</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_updated_by_user</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:26</sys_created_on><sys_id>11303f57fda36100c33aa767053a353d</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:26</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QH/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:26</sys_created_on><sys_id>7b9a70bd6f210600095acd9c5d3ee402</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Updated By User</sys_name><sys_parent display_value="Pagerduty">ee9a30bd6f210600095acd9c5d3ee4d3</sys_parent><sys_path>!!3Q4/!!3QH/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_updated_by_user" name="u_pagerduty" sys_source_table="sys_dictionary">11303f57fda36100c33aa767053a353d</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_updated_by_user</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:26</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>fb365f7e6f524200095acd9c5d3ee44c</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Updated By User</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_f7906fac4d9b6100c33a943ecf043eb0</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message"><sys_rest_message action="INSERT_OR_UPDATE"><basic_auth_password/><basic_auth_user/><description>PagerDuty REST API&#13;
https://developer.pagerduty.com/documentation/rest</description><name>PagerDuty_REST_API</name><rest_endpoint>https://${instance}.pagerduty.com/api/v1/${feature}</rest_endpoint><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:10:42</sys_created_on><sys_id>f7906fac4d9b6100c33a943ecf043eb0</sys_id><sys_mod_count>2</sys_mod_count><sys_updated_by>admin</sys_updated_by><sys_updated_on>2014-12-01 21:28:54</sys_updated_on><use_basic_auth>false</use_basic_auth></sys_rest_message><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!4@3/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:10:42</sys_created_on><sys_id>c4dde8286f387100e4cd8e112e3ee4e2</sys_id><sys_mod_count>0</sys_mod_count><sys_name>PagerDuty_REST_API</sys_name><sys_parent/><sys_path>!!4@3/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>f7906fac4d9b6100c33a943ecf043eb0</sys_source_id><sys_source_table>sys_rest_message</sys_source_table><sys_type/><sys_update_name>sys_rest_message_f7906fac4d9b6100c33a943ecf043eb0</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2014-12-01 21:28:54</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>fb365f7e6f524200095acd9c5d3ee44d</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>PagerDuty_REST_API</target_name>
<type>REST Message</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_parameters_b145ce55240b210012e7b8d269ce7d30</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn_parameters"><sys_rest_message_fn_parameters action="INSERT_OR_UPDATE"><name>description</name><rest_message_function display_value="post">2dfdd2775576210012e79621ec424be5</rest_message_function><sys_created_by>admin.jwilson</sys_created_by><sys_created_on>2014-09-08 11:10:19</sys_created_on><sys_id>b145ce55240b210012e7b8d269ce7d30</sys_id><sys_mod_count>3</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:44:32</sys_updated_on><type>string</type><value>Test from ServiceNOW REST</value></sys_rest_message_fn_parameters><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9M!/</sys_code><sys_created_by>admin.jwilson</sys_created_by><sys_created_on>2014-09-08 11:10:19</sys_created_on><sys_id>720f12c3656b254033f3979d4c1e916d</sys_id><sys_mod_count>0</sys_mod_count><sys_name>description</sys_name><sys_parent display_value="post">e20f12c3656b254033f3979d4c1e9116</sys_parent><sys_path>!!9LP/!!9LS/!!9M!/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>b145ce55240b210012e7b8d269ce7d30</sys_source_id><sys_source_table>sys_rest_message_fn_parameters</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_parameters_b145ce55240b210012e7b8d269ce7d30</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 20:44:32</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>fb365f7e6f524200095acd9c5d3ee44e</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>description</target_name>
<type>REST Message Function Parameters</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_transform_script_f297febc4d1f6100c33a943ecf043e6f</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_transform_script"&gt;&lt;sys_transform_script action="INSERT_OR_UPDATE"&gt;&lt;active&gt;false&lt;/active&gt;&lt;map display_value="PagerDuty"&gt;25d55a4c4d176100c33a943ecf043e78&lt;/map&gt;&lt;order&gt;100&lt;/order&gt;&lt;script&gt;&lt;![CDATA[var debug = true;


//Possible events: "incident.trigger", "incident.acknowledge", "incident.unacknowledge", "incident.resolve", "incident.assign", "incident.escalate", "incident.delegate"
if (debug) log.info("type=" + source.u_message_type);



if ((source.u_status == 'acknowledged' || source.u_status == 'assigned' || source.u_status == 'triggered') &amp;&amp; JSUtil.notNil(target.assigned_to)) {
	ignore = true;
	if (debug) log.info("Incident already assigned, skip what PD is telling us");
	
} else if (source.u_status == 'resolved' &amp;&amp; target.state == 6) {
	ignore = true;
	if (debug) log.info("Incident already in resolved state");
	
} ]]&gt;&lt;/script&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-19 11:49:30&lt;/sys_created_on&gt;&lt;sys_id&gt;f297febc4d1f6100c33a943ecf043e6f&lt;/sys_id&gt;&lt;sys_mod_count&gt;9&lt;/sys_mod_count&gt;&lt;sys_updated_by&gt;jwilson&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-01-09 22:30:12&lt;/sys_updated_on&gt;&lt;when&gt;onBefore&lt;/when&gt;&lt;/sys_transform_script&gt;&lt;sys_app_file action="INSERT_OR_UPDATE"&gt;&lt;customer_update&gt;true&lt;/customer_update&gt;&lt;publish_override/&gt;&lt;replace_on_upgrade&gt;false&lt;/replace_on_upgrade&gt;&lt;restore/&gt;&lt;sys_app/&gt;&lt;sys_code&gt;!!9MD/&lt;/sys_code&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-09-19 11:49:30&lt;/sys_created_on&gt;&lt;sys_id&gt;570f12c3656b254033f3979d4c1e9189&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;onBefore&lt;/sys_name&gt;&lt;sys_parent display_value="PagerDuty"&gt;d70f12c3656b254033f3979d4c1e9188&lt;/sys_parent&gt;&lt;sys_path&gt;!!9MC/!!9MD/&lt;/sys_path&gt;&lt;sys_policy/&gt;&lt;sys_source_deleted&gt;false&lt;/sys_source_deleted&gt;&lt;sys_source_id&gt;f297febc4d1f6100c33a943ecf043e6f&lt;/sys_source_id&gt;&lt;sys_source_table&gt;sys_transform_script&lt;/sys_source_table&gt;&lt;sys_type/&gt;&lt;sys_update_name&gt;sys_transform_script_f297febc4d1f6100c33a943ecf043e6f&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;jwilson&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-01-09 22:30:12&lt;/sys_updated_on&gt;&lt;/sys_app_file&gt;&lt;/record_update&gt;</payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>fb36df7e6f524200095acd9c5d3ee4a4</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>onBefore</target_name>
<type>Transform Script</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_app_module_b32574959964310012e7cc520615846a</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_app_module"><sys_app_module action="INSERT_OR_UPDATE"><active>true</active><application display_value="Integration - PagerDuy">cf52bc159964310012e7cc52061584d2</application><assessment/><content_page/><device_type/><filter/><hint/><homepage/><image/><link_type>SEPARATOR</link_type><map_page/><mobile_title>Source Code and Scripts</mobile_title><mobile_view_name>Mobile</mobile_view_name><name/><order>100</order><query/><report/><roles/><survey/><survey_overwrite>true</survey_overwrite><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 18:54:24</sys_created_on><sys_domain>global</sys_domain><sys_id>b32574959964310012e7cc520615846a</sys_id><sys_mod_count>3</sys_mod_count><sys_overrides/><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:32:00</sys_updated_on><timeline_page/><title>Source Code and Scripts</title><uncancelable>false</uncancelable><view_name/><window_name/></sys_app_module><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!:)}/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-11-21 18:54:24</sys_created_on><sys_id>9a35b8559964310012e7cc5206158401</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Source Code and Scripts</sys_name><sys_parent/><sys_path>!!:)}/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>b32574959964310012e7cc520615846a</sys_source_id><sys_source_table>sys_app_module</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_app_module_b32574959964310012e7cc520615846a</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:32:00</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>ff365f7e6f524200095acd9c5d3ee449</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table/>
<target_name>Source Code and Scripts</target_name>
<type>Module</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_assigned_to_name</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_assigned_to_name" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_assigned_to_name</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Assigned To Name</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_assigned_to_name</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:26</sys_created_on><sys_id>15303f57fda36100c33aa767053a353e</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:26</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3Q;/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:26</sys_created_on><sys_id>cb7700606f428600095acd9c5d3ee4ac</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Assigned To Name</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3Q;/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_assigned_to_name" name="u_pagerduty" sys_source_table="sys_dictionary">15303f57fda36100c33aa767053a353e</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_assigned_to_name</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:26</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>ff365f7e6f524200095acd9c5d3ee44a</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Assigned To Name</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_dictionary_u_pagerduty_u_resolved_by_name</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_dictionary action="INSERT" element="u_resolved_by_name" table="u_pagerduty"><active>true</active><array>false</array><attributes>import_attribute_name=u_resolved_by_name</attributes><audit>false</audit><calculation/><choice>0</choice><choice_field/><choice_table/><column_label>Resolved By Name</column_label><comments/><create_roles/><default_value/><defaultsort/><delete_roles/><dependent/><dependent_on_field/><display>false</display><dynamic_creation>false</dynamic_creation><dynamic_creation_script/><dynamic_default_value/><dynamic_ref_qual/><element>u_resolved_by_name</element><element_reference>false</element_reference><foreign_database/><internal_type display_value="String">string</internal_type><mandatory>false</mandatory><max_length>40</max_length><name>u_pagerduty</name><next_element/><primary>false</primary><read_only>false</read_only><read_roles/><reference/><reference_cascade_rule/><reference_floats>false</reference_floats><reference_key/><reference_qual/><reference_qual_condition/><reference_type/><sizeclass/><spell_check>false</spell_check><sys_class_name>sys_dictionary</sys_class_name><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:26</sys_created_on><sys_id>19303f57fda36100c33aa767053a353f</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:26</sys_updated_on><table_reference>false</table_reference><text_index>false</text_index><unique>false</unique><use_dependent_field>false</use_dependent_field><use_dynamic_default>false</use_dynamic_default><use_reference_qualifier>simple</use_reference_qualifier><virtual>false</virtual><widget/><write_roles/><xml_view>false</xml_view></sys_dictionary><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!3QE/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-10-09 20:36:26</sys_created_on><sys_id>fb7700606f428600095acd9c5d3ee4ba</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Resolved By Name</sys_name><sys_parent display_value="Pagerduty">2a7700606f428600095acd9c5d3ee49f</sys_parent><sys_path>!!3Q5/!!3QE/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_resolved_by_name" name="u_pagerduty" sys_source_table="sys_dictionary">19303f57fda36100c33aa767053a353f</sys_source_id><sys_source_table>sys_dictionary</sys_source_table><sys_type>code</sys_type><sys_update_name>sys_dictionary_u_pagerduty_u_resolved_by_name</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-10-09 20:36:26</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:51</sys_created_on>
<sys_id>ff365f7e6f524200095acd9c5d3ee44b</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:51</sys_updated_on>
<table>u_pagerduty</table>
<target_name>Pagerduty1.Resolved By Name</target_name>
<type>Dictionary</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_documentation_incident_u_pagerduty_en</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update><sys_documentation element="u_pagerduty" label="PagerDuty" language="en" table="incident"><sys_documentation action="INSERT_OR_UPDATE"><element>u_pagerduty</element><help/><hint>Unique incident_key used by the PagerDuty Integration API</hint><label>PagerDuty</label><language>en</language><name>incident</name><plural>PagerDuties</plural><sys_created_by>jschraith</sys_created_by><sys_created_on>2014-10-08 20:02:51</sys_created_on><sys_id>b3ee9e83656b254033f3979d4c1e91fd</sys_id><sys_mod_count>1</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:52:01</sys_updated_on><url/><url_target/></sys_documentation></sys_documentation><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9L?/</sys_code><sys_created_by>jschraith</sys_created_by><sys_created_on>2014-10-08 20:02:51</sys_created_on><sys_id>f3ee9e83656b254033f3979d4c1e91fe</sys_id><sys_mod_count>1</sys_mod_count><sys_name>PagerDuty</sys_name><sys_parent display_value="PagerDuty">dfee9e83656b254033f3979d4c1e91e3</sys_parent><sys_path>!!(WU/!!9L5/!!9L?/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id element="u_pagerduty" language="en" name="incident" sys_source_table="sys_documentation">b3ee9e83656b254033f3979d4c1e91fd</sys_source_id><sys_source_table>sys_documentation</sys_source_table><sys_type/><sys_update_name>sys_documentation_incident_u_pagerduty_en</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-11-21 19:52:01</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>ff365f7e6f524200095acd9c5d3ee44c</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>incident</table>
<target_name>Incident.PagerDuty</target_name>
<type>Field Label</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_rest_message_fn_headers_121163ec4d9b6100c33a943ecf043e61</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_rest_message_fn_headers"><sys_rest_message_fn_headers action="INSERT_OR_UPDATE"><name>Content-Type</name><rest_message_function display_value="get">a3e06fac4d9b6100c33a943ecf043ed0</rest_message_function><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:12:23</sys_created_on><sys_id>121163ec4d9b6100c33a943ecf043e61</sys_id><sys_mod_count>4</sys_mod_count><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:19:40</sys_updated_on><value>applicatiion/json</value></sys_rest_message_fn_headers><sys_app_file action="INSERT_OR_UPDATE"><customer_update>true</customer_update><publish_override/><replace_on_upgrade>false</replace_on_upgrade><restore/><sys_app/><sys_code>!!9LZ/</sys_code><sys_created_by>jwilson</sys_created_by><sys_created_on>2014-09-18 20:12:23</sys_created_on><sys_id>a20f12c3656b254033f3979d4c1e911b</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Content-Type</sys_name><sys_parent display_value="get">220f12c3656b254033f3979d4c1e9117</sys_parent><sys_path>!!9LQ/!!9LT/!!9LZ/</sys_path><sys_policy/><sys_source_deleted>false</sys_source_deleted><sys_source_id>121163ec4d9b6100c33a943ecf043e61</sys_source_id><sys_source_table>sys_rest_message_fn_headers</sys_source_table><sys_type/><sys_update_name>sys_rest_message_fn_headers_121163ec4d9b6100c33a943ecf043e61</sys_update_name><sys_updated_by>jwilson</sys_updated_by><sys_updated_on>2014-12-01 19:19:40</sys_updated_on></sys_app_file></record_update>]]></payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>ff365f7e6f524200095acd9c5d3ee44d</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table/>
<target_name>Content-Type</target_name>
<type>REST Message Function Headers</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value=""/>
<category/>
<comments/>
<name>sys_script_23182473fd676100c33aa767053a3548</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update sys_domain="global" table="sys_script"&gt;&lt;sys_script action="INSERT_OR_UPDATE"&gt;&lt;abort_action&gt;false&lt;/abort_action&gt;&lt;action_delete&gt;false&lt;/action_delete&gt;&lt;action_insert&gt;true&lt;/action_insert&gt;&lt;action_query&gt;false&lt;/action_query&gt;&lt;action_update&gt;true&lt;/action_update&gt;&lt;active&gt;true&lt;/active&gt;&lt;add_message&gt;false&lt;/add_message&gt;&lt;advanced&gt;true&lt;/advanced&gt;&lt;client_callable&gt;false&lt;/client_callable&gt;&lt;collection&gt;incident&lt;/collection&gt;&lt;condition/&gt;&lt;description/&gt;&lt;filter_condition table="incident"&gt;u_pagerdutyISNOTEMPTY^assignment_groupVALCHANGES^assignment_groupISNOTEMPTY^u_pagerduty_idISNOTEMPTY^EQ&lt;item endquery="false" field="u_pagerduty" goto="false" newquery="false" operator="ISNOTEMPTY" or="false" value=""/&gt;&lt;item endquery="false" field="assignment_group" goto="false" newquery="false" operator="VALCHANGES" or="false" value=""/&gt;&lt;item endquery="false" field="assignment_group" goto="false" newquery="false" operator="ISNOTEMPTY" or="false" value=""/&gt;&lt;item endquery="false" field="u_pagerduty_id" goto="false" newquery="false" operator="ISNOTEMPTY" or="false" value=""/&gt;&lt;item endquery="true" field="" goto="false" newquery="false" operator="" or="false" value=""/&gt;&lt;/filter_condition&gt;&lt;message/&gt;&lt;name&gt;Assign Group PagerDuty Incident&lt;/name&gt;&lt;order&gt;100&lt;/order&gt;&lt;priority&gt;100&lt;/priority&gt;&lt;role_conditions/&gt;&lt;script&gt;&lt;![CDATA[// Notify new group of incident assignment via PagerDuty - new group means delegate to new service
var debug = true;
if (debug) gs.log("Entered", "BR:Assign Group PagerDuty Incident");

var pd = new PagerDuty_REST();

// Assign PD incident
var resp_message = pd.delegateIncident(current.u_pagerduty_id.toString(), current.assignment_group.u_pagerduty_policy.toString(), gs.getUser().getEmail().toString());

if (!pd.hasError) {
	if (debug) gs.log("resp_message=" + resp_message, "BR:Assign Group PagerDuty Incident");
	
	
} else {
	gs.addErrorMessage("PagerDuty integration error -- " + pd.errMsg + ". PagerDuty did not find the Assigned Group's escalation policy; check to see if user is configured properly in PagerDuty then re-escalate.");
	gs.logError("PagerDuty integration failed: incident=" + current.number + ", message=" + pd.errMsg, "BR:Assign Group PagerDuty Incident");
	current.work_notes = "PagerDuty integration error -- " + pd.errMsg + ". PagerDuty did not find the Assigned Group's escalation policy; check to see if user is configured properly in PagerDuty then re-escalate.";
	current.update();
}

if (debug) gs.log("Exiting", "BR:Assign Group PagerDuty Incident");]]&gt;&lt;/script&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-10-10 19:19:11&lt;/sys_created_on&gt;&lt;sys_domain&gt;global&lt;/sys_domain&gt;&lt;sys_id&gt;23182473fd676100c33aa767053a3548&lt;/sys_id&gt;&lt;sys_mod_count&gt;12&lt;/sys_mod_count&gt;&lt;sys_overrides/&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-08-19 18:22:36&lt;/sys_updated_on&gt;&lt;template/&gt;&lt;when&gt;after&lt;/when&gt;&lt;/sys_script&gt;&lt;sys_app_file action="INSERT_OR_UPDATE"&gt;&lt;customer_update&gt;true&lt;/customer_update&gt;&lt;publish_override/&gt;&lt;replace_on_upgrade&gt;false&lt;/replace_on_upgrade&gt;&lt;restore/&gt;&lt;sys_app/&gt;&lt;sys_code&gt;!!3RL/&lt;/sys_code&gt;&lt;sys_created_by&gt;jwilson&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2014-10-10 19:19:11&lt;/sys_created_on&gt;&lt;sys_id&gt;a09740606f428600095acd9c5d3ee492&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;Assign Group PagerDuty Incident&lt;/sys_name&gt;&lt;sys_parent display_value="Incident"&gt;b73cdcd06fce4600095acd9c5d3ee4f2&lt;/sys_parent&gt;&lt;sys_path&gt;!!$A./!!3RL/&lt;/sys_path&gt;&lt;sys_policy/&gt;&lt;sys_source_deleted&gt;false&lt;/sys_source_deleted&gt;&lt;sys_source_id&gt;23182473fd676100c33aa767053a3548&lt;/sys_source_id&gt;&lt;sys_source_table&gt;sys_script&lt;/sys_source_table&gt;&lt;sys_type&gt;code&lt;/sys_type&gt;&lt;sys_update_name&gt;sys_script_23182473fd676100c33aa767053a3548&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2015-08-19 18:22:36&lt;/sys_updated_on&gt;&lt;/sys_app_file&gt;&lt;/record_update&gt;</payload>
<remote_update_set display_value="PagerDuty-ng">37365f7e6f524200095acd9c5d3ee449</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2015-09-08 18:29:52</sys_created_on>
<sys_id>ff36df7e6f524200095acd9c5d3ee4a3</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2015-09-08 18:29:52</sys_updated_on>
<table>incident</table>
<target_name>Assign Group PagerDuty Incident</target_name>
<type>Business Rule</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
</unload>
